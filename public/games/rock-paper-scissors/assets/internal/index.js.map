{"version":3,"sources":["../file:/Applications/Cocos/Creator/3.8.6/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/Applications/Cocos/Creator/3.8.6/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline-settings.ts","../file:/Applications/Cocos/Creator/3.8.6/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/Applications/Cocos/Creator/3.8.6/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline-types.ts","../file:/Applications/Cocos/Creator/3.8.6/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/Applications/Cocos/Creator/3.8.6/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline.ts"],"names":["ccclass","_decorator","disallowMultiple","executeInEditMode","menu","property","requireComponent","type","_dec","_dec2","_dec3","Camera","_dec4","CCBoolean","_dec5","displayName","_dec6","group","id","name","_dec7","style","CCInteger","range","_dec8","_dec9","tooltip","CCFloat","slide","_dec10","_dec11","Material","_dec12","_dec13","_dec14","min","_dec15","_dec16","_dec17","_dec18","Texture2D","_dec19","_dec20","_dec21","_dec22","_dec23","_dec24","_class","_descriptor","_applyDecoratedDescriptor","_class2","_Component","BuiltinPipelineSettings","_this","_len","arguments","length","args","Array","_key","call","apply","concat","_initializerDefineProperty","_assertThisInitialized","_descriptor2","_inheritsLoose","_proto","prototype","getPipelineSettings","this","_settings","onEnable","fillRequiredPipelineSettings","getComponent","camera","pipelineSettings","onDisable","_tryEnableEditorPreview","undefined","rendering","_editorPreview","setEditorPipelineSettings","_disableEditorPreview","getEditorPipelineSettings","_createClass","key","get","set","v","msaa","enabled","value","sampleCount","Math","pow","ceil","log2","max","enableShadingScale","shadingScale","bloom","material","enableAlphaMask","iterations","threshold","intensity","colorGrading","contribute","colorGradingMap","val","fxaa","fsr","sharpness","toneMapping","Component","configurable","enumerable","writable","initializer","makePipelineSettings","Object","getOwnPropertyDescriptor","_RF","pop","radiusScale","angleBiasDegree","blurSharpness","aoSaturation","needBlur","fillRequiredMSAA","makeMSAA","fillRequiredBloom","fillRequiredToneMapping","fillRequiredColorGrading","fillRequiredFSR","fillRequiredFXAA","SampleCount","gfx","X4","makeBloom","makeColorGrading","makeFSR","makeFXAA","makeToneMapping","AABB","geometry","Sphere","intersect","ClearFlagBit","Color","Format","FormatFeatureBit","LoadOp","StoreOp","TextureType","Viewport","scene","renderer","CameraUsage","CSMLevel","LightType","forwardNeedClearColor","clearFlag","COLOR","STENCIL","getCsmMainLightViewport","light","w","h","level","vp","screenSpaceSignY","shadowFixedArea","csmLevel","LEVEL_1","left","top","width","trunc","height","floor","PipelineConfigs","isWeb","isWebGL1","isWebGPU","isMobile","isHDR","useFloatOutput","toneMappingType","shadowEnabled","shadowMapFormat","R32F","shadowMapSize","Vec2","usePlanarShadow","supportDepthSample","mobileMaxSpotLightShadowMaps","platform","Vec4","setupPipelineConfigs","ppl","configs","sampleFeature","SAMPLED_TEXTURE","LINEAR_FILTER","device","sys","isNative","gfxAPI","API","WEBGL","WEBGPU","pipelineSceneData","getMacroBool","postSettings","shadowInfo","shadows","pipeline","supportsR32FloatTexture","RGBA8","size","ShadowType","Planar","capabilities","getFormatFeatures","DEPTH_STENCIL","x","clipSpaceSignY","defaultSettings","CameraConfigs","settings","isMainGameWindow","renderWindowId","colorName","depthStencilName","enableFullPipeline","enableProfiler","remainingPasses","nativeWidth","nativeHeight","enableHDR","radianceFormat","copyAndTonemapMaterial","enableStoreSceneDepth","sClearColorTransparentBlack","addCopyToScreenPass","pplConfigs","cameraConfigs","input","assert","pass","addRenderPass","addRenderTarget","CLEAR","STORE","addTexture","setVec4","addQueue","QueueHint","OPAQUE","addFullscreenQuad","getPingPongRenderTarget","prevName","prefix","startsWith","Number","charAt","ForwardLighting","lights","shadowEnabledSpotLights","_sphere","create","_boundingBox","_rangedDirLightBoundingBox","cullLights","frustum","cameraPos","_step","_iterator","_createForOfIteratorHelperLoose","spotLights","done","baked","position","y","z","sphereFrustum","push","_step2","_iterator2","sphereLights","_step3","_iterator3","pointLights","_step4","_iterator4","rangedDirLights","transform","node","getWorldMatrix","aabbFrustum","sort","lhs","rhs","Vec3","squaredDistance","_addLightQueues","_step5","_iterator5","queue","BLEND","SPHERE","SPOT","POINT","RANGED_DIRECTIONAL","addScene","SceneFlags","addSpotlightShadowPasses","maxNumShadowMaps","_step6","i","_iterator6","shadowPass","addDepthStencil","DISCARD","NONE","MASK","SHADOW_CASTER","useLightFrustum","addLightQueues","_step7","_iterator7","addLightPasses","depthStencilStoreOp","viewport","_step8","count","_iterator8","storeOp","setViewport","LOAD","isMultipleLightPassesNeeded","BuiltinForwardPassBuilder","forwardLighting","_viewport","_clearColor","_reflectionProbeClearColor","_proto2","getConfigOrder","ConfigOrder","getRenderOrder","RenderOrder","configCamera","pipelineConfigs","enableMainLightShadowMap","mainLight","enableMainLightPlanarShadowMap","enablePlanarReflectionProbe","cameraUsage","SCENE_VIEW","GAME_VIEW","enableMSAA","enableSingleForwardPass","windowResize","window","ResourceFlags","ResourceResidency","TEX2D","COLOR_ATTACHMENT","MEMORYLESS","DEPTH_STENCIL_ATTACHMENT","setup","context","_addCascadedShadowMapPass","_tryAddReflectionProbePasses","_addForwardRadiancePasses","shadowSize","csmSupported","reflectionProbeManager","cclegacy","internal","_step9","probes","getProbes","probeID","_iterator9","probe","needRender","area","renderArea","probeType","ProbeType","PLANAR","realtimePlanarTexture","addRenderWindow","probePass","_buildReflectionProbePass","colorStoreOp","clearColor","packRGBE","clearDepth","clearStencil","REFLECTION_PROBE","disableMSAA","round","_addForwardSingleRadiancePass","_addForwardMultipleRadiancePasses","_addPlanarShadowQueue","sceneFlags","geometryRenderer","GEOMETRY","msaaRadianceName","msaaDepthStencilName","msPass","addMultisampleRenderPass","_buildForwardMainLightPass","resolveRenderTarget","firstStoreOp","PLANAR_SHADOW","BuiltinBloomPassBuilder","_clearColorTransparentBlack","_bloomParams","_bloomTexSize","_bloomWidths","_bloomHeights","_bloomTexNames","_proto3","enableBloom","bloomWidth","bloomHeight","prevRenderPass","_addKawaseDualFilterBloomPasses","bloomMaterial","radianceName","sizeCount","prefilterPass","downPass","upPass","combinePass","BuiltinToneMappingPassBuilder","_colorGradingTexSize","_proto4","enableColorGrading","enableToneMapping","setProperty","_addCopyAndTonemapPass","ldrColorPrefix","ldrColorName","lutTex","isSquareMap","setVec2","setFloat","BuiltinFXAAPassBuilder","_fxaaParams","_proto5","enableFXAA","_addFxaaPass","inputColorName","fxaaMaterial","BuiltinFsrPassBuilder","_fsrParams","_fsrTexSize","_proto6","enableFSR","outputColorName","_addFsrPass","fsrMaterial","clamp","fsrColorName","easuPass","rcasPass","BuiltinUiPassBuilder","_proto7","flags","UI","PROFILER","showStatistics","BuiltinPipelineBuilder","_pipelineEvent","director","root","pipelineEvent","_forwardPass","_bloomPass","_toneMappingPass","_fxaaPass","_fsrPass","_uiPass","_configs","_cameraConfigs","_copyAndTonemapMaterial","_initialized","_passBuilders","_proto8","_setupPipelinePreview","PREVIEW","editorSettings","_preparePipelinePasses","passBuilders","_passes","_step10","_iterator10","_setupBuiltinCameraConfigs","GAME","swapchain","visibility","Layers","Enum","DEFAULT","DEBUG","RGBA16F","_setupCameraConfigs","a","b","_step11","_iterator11","builder","_step12","_iterator12","cameras","_initMaterials","_step13","_iterator13","emit","PipelineEventType","RENDER_CAMERA_BEGIN","_buildForwardPipeline","_buildSimplePipeline","RENDER_CAMERA_END","sortPipelinePassBuildersByRenderOrder","_step14","lastPass","_iterator14","_uuid","initialize","effectName","effectAsset","setCustomPipeline"],"mappings":"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","file":"all.js","sourcesContent":["/*\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights to\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n of the Software, and to permit persons to whom the Software is furnished to do so,\n subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport {\n    _decorator, Camera, CCBoolean, CCFloat, CCInteger, Component,\n    Material, rendering, Texture2D,\n} from 'cc';\n\nimport { EDITOR } from 'cc/env';\n\nimport {\n    fillRequiredPipelineSettings, makePipelineSettings, PipelineSettings,\n} from './builtin-pipeline-types';\n\nconst { ccclass, disallowMultiple, executeInEditMode, menu, property, requireComponent, type } = _decorator;\n\n@ccclass('BuiltinPipelineSettings')\n@menu('Rendering/BuiltinPipelineSettings')\n@requireComponent(Camera)\n@disallowMultiple\n@executeInEditMode\nexport class BuiltinPipelineSettings extends Component {\n    @property\n    private readonly _settings: PipelineSettings = makePipelineSettings();\n\n    getPipelineSettings(): PipelineSettings {\n        return this._settings;\n    }\n\n    // Enable/Disable\n    onEnable(): void {\n        fillRequiredPipelineSettings(this._settings);\n        const cameraComponent = this.getComponent(Camera)!;\n        const camera = cameraComponent.camera;\n        camera.pipelineSettings = this._settings;\n\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    onDisable(): void {\n        const cameraComponent = this.getComponent(Camera)!;\n        const camera = cameraComponent.camera;\n        camera.pipelineSettings = null;\n\n        if (EDITOR) {\n            this._disableEditorPreview();\n        }\n    }\n\n    // Editor Preview\n    @property(CCBoolean)\n    protected _editorPreview = false;\n\n    @property({\n        displayName: 'Editor Preview (Experimental)',\n        type: CCBoolean,\n    })\n    get editorPreview(): boolean {\n        return this._editorPreview;\n    }\n    set editorPreview(v: boolean) {\n        this._editorPreview = v;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    public _tryEnableEditorPreview(): void {\n        if (rendering === undefined) {\n            return;\n        }\n        if (this._editorPreview) {\n            rendering.setEditorPipelineSettings(this._settings);\n        } else {\n            this._disableEditorPreview();\n        }\n    }\n    public _disableEditorPreview(): void {\n        if (rendering === undefined) {\n            return;\n        }\n        const current = rendering.getEditorPipelineSettings() as PipelineSettings | null;\n        if (current === this._settings) {\n            rendering.setEditorPipelineSettings(null);\n        }\n    }\n\n    // MSAA\n    @property({\n        group: { id: 'MSAA', name: 'Multisample Anti-Aliasing' },\n        type: CCBoolean,\n    })\n    get MsaaEnable(): boolean {\n        return this._settings.msaa.enabled;\n    }\n    set MsaaEnable(value: boolean) {\n        this._settings.msaa.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n\n    @property({\n        group: { id: 'MSAA', name: 'Multisample Anti-Aliasing', style: 'section' },\n        type: CCInteger,\n        range: [2, 4, 2],\n    })\n    set msaaSampleCount(value: number) {\n        value = 2 ** Math.ceil(Math.log2(Math.max(value, 2)));\n        value = Math.min(value, 4);\n        this._settings.msaa.sampleCount = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get msaaSampleCount(): number {\n        return this._settings.msaa.sampleCount;\n    }\n\n    // Shading Scale\n    @property({\n        group: { id: 'ShadingScale', name: 'ShadingScale', style: 'section' },\n        type: CCBoolean,\n    })\n    set shadingScaleEnable(value: boolean) {\n        this._settings.enableShadingScale = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get shadingScaleEnable(): boolean {\n        return this._settings.enableShadingScale;\n    }\n\n    @property({\n        tooltip: 'i18n:postprocess.shadingScale',\n        group: { id: 'ShadingScale', name: 'ShadingScale' },\n        type: CCFloat,\n        range: [0.01, 4, 0.01],\n        slide: true,\n    })\n    set shadingScale(value: number) {\n        this._settings.shadingScale = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get shadingScale(): number {\n        return this._settings.shadingScale;\n    }\n\n    // Bloom\n    @property({\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set bloomEnable(value: boolean) {\n        this._settings.bloom.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomEnable(): boolean {\n        return this._settings.bloom.enabled;\n    }\n\n    @property({\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: Material,\n    })\n    set bloomMaterial(value: Material) {\n        if (this._settings.bloom.material === value) {\n            return;\n        }\n        this._settings.bloom.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomMaterial(): Material {\n        return this._settings.bloom.material!;\n    }\n\n    @property({\n        tooltip: 'i18n:bloom.enableAlphaMask',\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set bloomEnableAlphaMask(value: boolean) {\n        this._settings.bloom.enableAlphaMask = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomEnableAlphaMask(): boolean {\n        return this._settings.bloom.enableAlphaMask;\n    }\n\n    @property({\n        tooltip: 'i18n:bloom.iterations',\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCInteger,\n        range: [1, 6, 1],\n        slide: true,\n    })\n    set bloomIterations(value: number) {\n        this._settings.bloom.iterations = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomIterations(): number {\n        return this._settings.bloom.iterations;\n    }\n\n    @property({\n        tooltip: 'i18n:bloom.threshold',\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCFloat,\n        min: 0,\n    })\n    set bloomThreshold(value: number) {\n        this._settings.bloom.threshold = value;\n    }\n    get bloomThreshold(): number {\n        return this._settings.bloom.threshold;\n    }\n\n    set bloomIntensity(value: number) {\n        this._settings.bloom.intensity = value;\n    }\n    get bloomIntensity(): number {\n        return this._settings.bloom.intensity;\n    }\n\n    // Color Grading (LDR)\n    @property({\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set colorGradingEnable(value: boolean) {\n        this._settings.colorGrading.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get colorGradingEnable(): boolean {\n        return this._settings.colorGrading.enabled;\n    }\n\n    @property({\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: Material,\n    })\n    set colorGradingMaterial(value: Material) {\n        if (this._settings.colorGrading.material === value) {\n            return;\n        }\n        this._settings.colorGrading.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get colorGradingMaterial(): Material {\n        return this._settings.colorGrading.material!;\n    }\n\n    @property({\n        tooltip: 'i18n:color_grading.contribute',\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: CCFloat,\n        range: [0, 1, 0.01],\n        slide: true,\n    })\n    set colorGradingContribute(value: number) {\n        this._settings.colorGrading.contribute = value;\n    }\n    get colorGradingContribute(): number {\n        return this._settings.colorGrading.contribute;\n    }\n\n    @property({\n        tooltip: 'i18n:color_grading.originalMap',\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: Texture2D,\n    })\n    set colorGradingMap(val: Texture2D) {\n        this._settings.colorGrading.colorGradingMap = val;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get colorGradingMap(): Texture2D {\n        return this._settings.colorGrading.colorGradingMap!;\n    }\n\n    // FXAA\n    @property({\n        group: { id: 'FXAA', name: 'Fast Approximate Anti-Aliasing (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set fxaaEnable(value: boolean) {\n        this._settings.fxaa.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fxaaEnable(): boolean {\n        return this._settings.fxaa.enabled;\n    }\n\n    @property({\n        group: { id: 'FXAA', name: 'Fast Approximate Anti-Aliasing (PostProcessing)', style: 'section' },\n        type: Material,\n    })\n    set fxaaMaterial(value: Material) {\n        if (this._settings.fxaa.material === value) {\n            return;\n        }\n        this._settings.fxaa.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fxaaMaterial(): Material {\n        return this._settings.fxaa.material!;\n    }\n\n    // FSR\n    @property({\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\n        type: CCBoolean,\n    })\n    set fsrEnable(value: boolean) {\n        this._settings.fsr.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fsrEnable(): boolean {\n        return this._settings.fsr.enabled;\n    }\n\n    @property({\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\n        type: Material,\n    })\n    set fsrMaterial(value: Material) {\n        if (this._settings.fsr.material === value) {\n            return;\n        }\n        this._settings.fsr.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fsrMaterial(): Material {\n        return this._settings.fsr.material!;\n    }\n\n    @property({\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\n        type: CCFloat,\n        range: [0, 1, 0.01],\n        slide: true,\n    })\n    set fsrSharpness(value: number) {\n        this._settings.fsr.sharpness = value;\n    }\n    get fsrSharpness(): number {\n        return this._settings.fsr.sharpness;\n    }\n\n    @property({\n        group: { id: 'ToneMapping', name: 'ToneMapping', style: 'section' },\n        type: Material,\n    })\n    set toneMappingMaterial(value: Material) {\n        if (this._settings.toneMapping.material === value) {\n            return;\n        }\n        this._settings.toneMapping.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get toneMappingMaterial(): Material {\n        return this._settings.toneMapping.material!;\n    }\n}\n","/*\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights to\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n of the Software, and to permit persons to whom the Software is furnished to do so,\n subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/**\n * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\n * The following section is auto-generated.\n * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\n */\n/* eslint-disable max-len */\nimport { Material, Texture2D, gfx } from 'cc';\n\nconst { SampleCount } = gfx;\n\nexport interface MSAA {\n    enabled: boolean; /* false */\n    sampleCount: gfx.SampleCount; /* SampleCount.X4 */\n    [name: string]: unknown;\n}\n\nexport function makeMSAA(): MSAA {\n    return {\n        enabled: false,\n        sampleCount: SampleCount.X4,\n    };\n}\n\nexport function fillRequiredMSAA(value: MSAA): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.sampleCount === undefined) {\n        value.sampleCount = SampleCount.X4;\n    }\n}\n\nexport interface HBAO {\n    enabled: boolean; /* false */\n    radiusScale: number; /* 1 */\n    angleBiasDegree: number; /* 10 */\n    blurSharpness: number; /* 3 */\n    aoSaturation: number; /* 1 */\n    needBlur: boolean; /* false */\n    [name: string]: unknown;\n}\n\nexport function makeHBAO(): HBAO {\n    return {\n        enabled: false,\n        radiusScale: 1,\n        angleBiasDegree: 10,\n        blurSharpness: 3,\n        aoSaturation: 1,\n        needBlur: false,\n    };\n}\n\nexport function fillRequiredHBAO(value: HBAO): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.radiusScale === undefined) {\n        value.radiusScale = 1;\n    }\n    if (value.angleBiasDegree === undefined) {\n        value.angleBiasDegree = 10;\n    }\n    if (value.blurSharpness === undefined) {\n        value.blurSharpness = 3;\n    }\n    if (value.aoSaturation === undefined) {\n        value.aoSaturation = 1;\n    }\n    if (value.needBlur === undefined) {\n        value.needBlur = false;\n    }\n}\n\nexport interface Bloom {\n    enabled: boolean; /* false */\n    /* refcount */ material: Material | null;\n    enableAlphaMask: boolean; /* false */\n    iterations: number; /* 3 */\n    threshold: number; /* 0.8 */\n    intensity: number; /* 2.3 */\n    [name: string]: unknown;\n}\n\nexport function makeBloom(): Bloom {\n    return {\n        enabled: false,\n        material: null,\n        enableAlphaMask: false,\n        iterations: 3,\n        threshold: 0.8,\n        intensity: 2.3,\n    };\n}\n\nexport function fillRequiredBloom(value: Bloom): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n    if (value.enableAlphaMask === undefined) {\n        value.enableAlphaMask = false;\n    }\n    if (value.iterations === undefined) {\n        value.iterations = 3;\n    }\n    if (value.threshold === undefined) {\n        value.threshold = 0.8;\n    }\n    if (value.intensity === undefined) {\n        value.intensity = 2.3;\n    }\n}\n\nexport interface ColorGrading {\n    enabled: boolean; /* false */\n    /* refcount */ material: Material | null;\n    contribute: number; /* 1 */\n    /* refcount */ colorGradingMap: Texture2D | null;\n    [name: string]: unknown;\n}\n\nexport function makeColorGrading(): ColorGrading {\n    return {\n        enabled: false,\n        material: null,\n        contribute: 1,\n        colorGradingMap: null,\n    };\n}\n\nexport function fillRequiredColorGrading(value: ColorGrading): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n    if (value.contribute === undefined) {\n        value.contribute = 1;\n    }\n    if (value.colorGradingMap === undefined) {\n        value.colorGradingMap = null;\n    }\n}\n\nexport interface FSR {\n    enabled: boolean; /* false */\n    /* refcount */ material: Material | null;\n    sharpness: number; /* 0.8 */\n    [name: string]: unknown;\n}\n\nexport function makeFSR(): FSR {\n    return {\n        enabled: false,\n        material: null,\n        sharpness: 0.8,\n    };\n}\n\nexport function fillRequiredFSR(value: FSR): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n    if (value.sharpness === undefined) {\n        value.sharpness = 0.8;\n    }\n}\n\nexport interface FXAA {\n    enabled: boolean; /* false */\n    /* refcount */ material: Material | null;\n    [name: string]: unknown;\n}\n\nexport function makeFXAA(): FXAA {\n    return {\n        enabled: false,\n        material: null,\n    };\n}\n\nexport function fillRequiredFXAA(value: FXAA): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n}\n\nexport interface ToneMapping {\n    /* refcount */ material: Material | null;\n    [name: string]: unknown;\n}\n\nexport function makeToneMapping(): ToneMapping {\n    return {\n        material: null,\n    };\n}\n\nexport function fillRequiredToneMapping(value: ToneMapping): void {\n    if (value.material === undefined) {\n        value.material = null;\n    }\n}\n\nexport interface PipelineSettings {\n    readonly msaa: MSAA;\n    enableShadingScale: boolean; /* false */\n    shadingScale: number; /* 0.5 */\n    readonly bloom: Bloom;\n    readonly toneMapping: ToneMapping;\n    readonly colorGrading: ColorGrading;\n    readonly fsr: FSR;\n    readonly fxaa: FXAA;\n    [name: string]: unknown;\n}\n\nexport function makePipelineSettings(): PipelineSettings {\n    return {\n        msaa: makeMSAA(),\n        enableShadingScale: false,\n        shadingScale: 0.5,\n        bloom: makeBloom(),\n        toneMapping: makeToneMapping(),\n        colorGrading: makeColorGrading(),\n        fsr: makeFSR(),\n        fxaa: makeFXAA(),\n    };\n}\n\nexport function fillRequiredPipelineSettings(value: PipelineSettings): void {\n    if (!value.msaa) {\n        (value.msaa as MSAA) = makeMSAA();\n    } else {\n        fillRequiredMSAA(value.msaa);\n    }\n    if (value.enableShadingScale === undefined) {\n        value.enableShadingScale = false;\n    }\n    if (value.shadingScale === undefined) {\n        value.shadingScale = 0.5;\n    }\n    if (!value.bloom) {\n        (value.bloom as Bloom) = makeBloom();\n    } else {\n        fillRequiredBloom(value.bloom);\n    }\n    if (!value.toneMapping) {\n        (value.toneMapping as ToneMapping) = makeToneMapping();\n    } else {\n        fillRequiredToneMapping(value.toneMapping);\n    }\n    if (!value.colorGrading) {\n        (value.colorGrading as ColorGrading) = makeColorGrading();\n    } else {\n        fillRequiredColorGrading(value.colorGrading);\n    }\n    if (!value.fsr) {\n        (value.fsr as FSR) = makeFSR();\n    } else {\n        fillRequiredFSR(value.fsr);\n    }\n    if (!value.fxaa) {\n        (value.fxaa as FXAA) = makeFXAA();\n    } else {\n        fillRequiredFXAA(value.fxaa);\n    }\n}\n","/*\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights to\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n of the Software, and to permit persons to whom the Software is furnished to do so,\n subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport {\n    assert, cclegacy, clamp, geometry, gfx, Layers, Material, pipeline,\n    PipelineEventProcessor, PipelineEventType, ReflectionProbeManager, renderer,\n    rendering, sys, Vec2, Vec3, Vec4, warn,\n} from 'cc';\n\nimport { DEBUG, EDITOR } from 'cc/env';\n\nimport {\n    makePipelineSettings,\n    PipelineSettings,\n} from './builtin-pipeline-types';\n\nconst { AABB, Sphere, intersect } = geometry;\nconst { ClearFlagBit, Color, Format, FormatFeatureBit, LoadOp, StoreOp, TextureType, Viewport } = gfx;\nconst { scene } = renderer;\nconst { CameraUsage, CSMLevel, LightType } = scene;\n\nfunction forwardNeedClearColor(camera: renderer.scene.Camera): boolean {\n    return !!(camera.clearFlag & (ClearFlagBit.COLOR | (ClearFlagBit.STENCIL << 1)));\n}\n\nfunction getCsmMainLightViewport(\n    light: renderer.scene.DirectionalLight,\n    w: number,\n    h: number,\n    level: number,\n    vp: gfx.Viewport,\n    screenSpaceSignY: number,\n): void {\n    if (light.shadowFixedArea || light.csmLevel === CSMLevel.LEVEL_1) {\n        vp.left = 0;\n        vp.top = 0;\n        vp.width = Math.trunc(w);\n        vp.height = Math.trunc(h);\n    } else {\n        vp.left = Math.trunc(level % 2 * 0.5 * w);\n        if (screenSpaceSignY > 0) {\n            vp.top = Math.trunc((1 - Math.floor(level / 2)) * 0.5 * h);\n        } else {\n            vp.top = Math.trunc(Math.floor(level / 2) * 0.5 * h);\n        }\n        vp.width = Math.trunc(0.5 * w);\n        vp.height = Math.trunc(0.5 * h);\n    }\n    vp.left = Math.max(0, vp.left);\n    vp.top = Math.max(0, vp.top);\n    vp.width = Math.max(1, vp.width);\n    vp.height = Math.max(1, vp.height);\n}\n\nexport class PipelineConfigs {\n    isWeb = false;\n    isWebGL1 = false;\n    isWebGPU = false;\n    isMobile = false;\n    isHDR = false;\n    useFloatOutput = false;\n    toneMappingType = 0; // 0: ACES, 1: None\n    shadowEnabled = false;\n    shadowMapFormat = Format.R32F;\n    shadowMapSize = new Vec2(1, 1);\n    usePlanarShadow = false;\n    screenSpaceSignY = 1;\n    supportDepthSample = false;\n    mobileMaxSpotLightShadowMaps = 1;\n\n    platform = new Vec4(0, 0, 0, 0);\n}\n\nfunction setupPipelineConfigs(\n    ppl: rendering.BasicPipeline,\n    configs: PipelineConfigs,\n): void {\n    const sampleFeature = FormatFeatureBit.SAMPLED_TEXTURE | FormatFeatureBit.LINEAR_FILTER;\n    const device = ppl.device;\n    // Platform\n    configs.isWeb = !sys.isNative;\n    configs.isWebGL1 = device.gfxAPI === gfx.API.WEBGL;\n    configs.isWebGPU = device.gfxAPI === gfx.API.WEBGPU;\n    configs.isMobile = sys.isMobile;\n\n    // Rendering\n    configs.isHDR = ppl.pipelineSceneData.isHDR; // Has tone mapping\n    configs.useFloatOutput = ppl.getMacroBool('CC_USE_FLOAT_OUTPUT');\n    configs.toneMappingType = ppl.pipelineSceneData.postSettings.toneMappingType;\n    // Shadow\n    const shadowInfo = ppl.pipelineSceneData.shadows;\n    configs.shadowEnabled = shadowInfo.enabled;\n    configs.shadowMapFormat = pipeline.supportsR32FloatTexture(ppl.device) ? Format.R32F : Format.RGBA8;\n    configs.shadowMapSize.set(shadowInfo.size);\n    configs.usePlanarShadow = shadowInfo.enabled && shadowInfo.type === renderer.scene.ShadowType.Planar;\n    // Device\n    configs.screenSpaceSignY = ppl.device.capabilities.screenSpaceSignY;\n    configs.supportDepthSample = (ppl.device.getFormatFeatures(Format.DEPTH_STENCIL) & sampleFeature) === sampleFeature;\n    // Constants\n    const screenSpaceSignY = device.capabilities.screenSpaceSignY;\n    configs.platform.x = configs.isMobile ? 1.0 : 0.0;\n    configs.platform.w = (screenSpaceSignY * 0.5 + 0.5) << 1 | (device.capabilities.clipSpaceSignY * 0.5 + 0.5);\n}\n\nexport interface PipelineSettings2 extends PipelineSettings {\n    _passes?: rendering.PipelinePassBuilder[];\n}\n\nconst defaultSettings = makePipelineSettings();\n\nexport class CameraConfigs {\n    settings: PipelineSettings = defaultSettings;\n    // Window\n    isMainGameWindow = false;\n    renderWindowId = 0;\n    // Camera\n    colorName = '';\n    depthStencilName = '';\n    // Pipeline\n    enableFullPipeline = false;\n    enableProfiler = false;\n    remainingPasses = 0;\n    // Shading Scale\n    enableShadingScale = false;\n    shadingScale = 1.0;\n    nativeWidth = 1;\n    nativeHeight = 1;\n    width = 1; // Scaled width\n    height = 1; // Scaled height\n    // Radiance\n    enableHDR = false;\n    radianceFormat = gfx.Format.RGBA8;\n    // Tone Mapping\n    copyAndTonemapMaterial: Material | null = null;\n    // Depth\n    /** @en mutable */\n    enableStoreSceneDepth = false;\n}\n\nconst sClearColorTransparentBlack = new Color(0, 0, 0, 0);\n\nfunction sortPipelinePassBuildersByConfigOrder(passBuilders: rendering.PipelinePassBuilder[]): void {\n    passBuilders.sort((a, b) => {\n        return a.getConfigOrder() - b.getConfigOrder();\n    });\n}\n\nfunction sortPipelinePassBuildersByRenderOrder(passBuilders: rendering.PipelinePassBuilder[]): void {\n    passBuilders.sort((a, b) => {\n        return a.getRenderOrder() - b.getRenderOrder();\n    });\n}\n\nfunction addCopyToScreenPass(\n    ppl: rendering.BasicPipeline,\n    pplConfigs: Readonly<PipelineConfigs>,\n    cameraConfigs: CameraConfigs,\n    input: string,\n): rendering.BasicRenderPassBuilder {\n    assert(!!cameraConfigs.copyAndTonemapMaterial);\n    const pass = ppl.addRenderPass(\n        cameraConfigs.nativeWidth,\n        cameraConfigs.nativeHeight,\n        'cc-tone-mapping');\n    pass.addRenderTarget(\n        cameraConfigs.colorName,\n        LoadOp.CLEAR, StoreOp.STORE,\n        sClearColorTransparentBlack);\n    pass.addTexture(input, 'inputTexture');\n    pass.setVec4('g_platform', pplConfigs.platform);\n    pass.addQueue(rendering.QueueHint.OPAQUE)\n        .addFullscreenQuad(cameraConfigs.copyAndTonemapMaterial, 1);\n    return pass;\n}\n\nexport function getPingPongRenderTarget(prevName: string, prefix: string, id: number): string {\n    if (prevName.startsWith(prefix)) {\n        return `${prefix}${1 - Number(prevName.charAt(prefix.length))}_${id}`;\n    } else {\n        return `${prefix}0_${id}`;\n    }\n}\n\nexport interface PipelineContext {\n    colorName: string;\n    depthStencilName: string;\n}\n\nclass ForwardLighting {\n    // Active lights\n    private readonly lights: renderer.scene.Light[] = [];\n    // Active spot lights with shadows (Mutually exclusive with `lights`)\n    private readonly shadowEnabledSpotLights: renderer.scene.SpotLight[] = [];\n\n    // Internal cached resources\n    private readonly _sphere = Sphere.create(0, 0, 0, 1);\n    private readonly _boundingBox = new AABB();\n    private readonly _rangedDirLightBoundingBox = new AABB(0.0, 0.0, 0.0, 0.5, 0.5, 0.5);\n\n    // ----------------------------------------------------------------\n    // Interface\n    // ----------------------------------------------------------------\n    public cullLights(scene: renderer.RenderScene, frustum: geometry.Frustum, cameraPos?: Vec3): void {\n        // TODO(zhouzhenglong): Make light culling native\n        this.lights.length = 0;\n        this.shadowEnabledSpotLights.length = 0;\n        // spot lights\n        for (const light of scene.spotLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                if (light.shadowEnabled) {\n                    this.shadowEnabledSpotLights.push(light);\n                } else {\n                    this.lights.push(light);\n                }\n            }\n        }\n        // sphere lights\n        for (const light of scene.sphereLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                this.lights.push(light);\n            }\n        }\n        // point lights\n        for (const light of scene.pointLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                this.lights.push(light);\n            }\n        }\n        // ranged dir lights\n        for (const light of scene.rangedDirLights) {\n            AABB.transform(this._boundingBox, this._rangedDirLightBoundingBox, light.node!.getWorldMatrix());\n            if (intersect.aabbFrustum(this._boundingBox, frustum)) {\n                this.lights.push(light);\n            }\n        }\n\n        if (cameraPos) {\n            this.shadowEnabledSpotLights.sort(\n                (lhs, rhs) => Vec3.squaredDistance(cameraPos, lhs.position) - Vec3.squaredDistance(cameraPos, rhs.position),\n            );\n        }\n    }\n    private _addLightQueues(camera: renderer.scene.Camera, pass: rendering.BasicRenderPassBuilder): void {\n        for (const light of this.lights) {\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            switch (light.type) {\n                case LightType.SPHERE:\n                    queue.name = 'sphere-light';\n                    break;\n                case LightType.SPOT:\n                    queue.name = 'spot-light';\n                    break;\n                case LightType.POINT:\n                    queue.name = 'point-light';\n                    break;\n                case LightType.RANGED_DIRECTIONAL:\n                    queue.name = 'ranged-directional-light';\n                    break;\n                default:\n                    queue.name = 'unknown-light';\n            }\n            queue.addScene(\n                camera,\n                rendering.SceneFlags.BLEND,\n                light,\n            );\n        }\n    }\n    public addSpotlightShadowPasses(\n        ppl: rendering.BasicPipeline,\n        camera: renderer.scene.Camera,\n        maxNumShadowMaps: number,\n    ): void {\n        let i = 0;\n        for (const light of this.shadowEnabledSpotLights) {\n            const shadowMapSize = ppl.pipelineSceneData.shadows.size;\n            const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\n            shadowPass.name = `SpotLightShadowPass${i}`;\n            shadowPass.addRenderTarget(`SpotShadowMap${i}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n            shadowPass.addDepthStencil(`SpotShadowDepth${i}`, LoadOp.CLEAR, StoreOp.DISCARD);\n            shadowPass.addQueue(rendering.QueueHint.NONE, 'shadow-caster')\n                .addScene(camera, rendering.SceneFlags.OPAQUE | rendering.SceneFlags.MASK | rendering.SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light);\n            ++i;\n            if (i >= maxNumShadowMaps) {\n                break;\n            }\n        }\n    }\n    public addLightQueues(pass: rendering.BasicRenderPassBuilder,\n        camera: renderer.scene.Camera, maxNumShadowMaps: number): void {\n        this._addLightQueues(camera, pass);\n        let i = 0;\n        for (const light of this.shadowEnabledSpotLights) {\n            // Add spot-light pass\n            // Save last RenderPass to the `pass` variable\n            // TODO(zhouzhenglong): Fix per queue addTexture\n            pass.addTexture(`SpotShadowMap${i}`, 'cc_spotShadowMap');\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            queue.addScene(camera, rendering.SceneFlags.BLEND, light);\n            ++i;\n            if (i >= maxNumShadowMaps) {\n                break;\n            }\n        }\n    }\n\n    // Notice: ForwardLighting cannot handle a lot of lights.\n    // If there are too many lights, the performance will be very poor.\n    // If many lights are needed, please implement a forward+ or deferred rendering pipeline.\n    public addLightPasses(\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp,\n        id: number, // window id\n        width: number,\n        height: number,\n        camera: renderer.scene.Camera,\n        viewport: gfx.Viewport,\n        ppl: rendering.BasicPipeline,\n        pass: rendering.BasicRenderPassBuilder,\n    ): rendering.BasicRenderPassBuilder {\n        this._addLightQueues(camera, pass);\n\n        let count = 0;\n        const shadowMapSize = ppl.pipelineSceneData.shadows.size;\n        for (const light of this.shadowEnabledSpotLights) {\n            const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\n            shadowPass.name = 'SpotlightShadowPass';\n            // Reuse csm shadow map\n            shadowPass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n            shadowPass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\n            shadowPass.addQueue(rendering.QueueHint.NONE, 'shadow-caster')\n                .addScene(camera, rendering.SceneFlags.OPAQUE | rendering.SceneFlags.MASK | rendering.SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light);\n\n            // Add spot-light pass\n            // Save last RenderPass to the `pass` variable\n            ++count;\n            const storeOp = count === this.shadowEnabledSpotLights.length\n                ? depthStencilStoreOp\n                : StoreOp.STORE;\n\n            pass = ppl.addRenderPass(width, height, 'default');\n            pass.name = 'SpotlightWithShadowMap';\n            pass.setViewport(viewport);\n            pass.addRenderTarget(colorName, LoadOp.LOAD);\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, storeOp);\n            pass.addTexture(`ShadowMap${id}`, 'cc_spotShadowMap');\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            queue.addScene(\n                camera,\n                rendering.SceneFlags.BLEND,\n                light,\n            );\n        }\n        return pass;\n    }\n\n    public isMultipleLightPassesNeeded(): boolean {\n        return this.shadowEnabledSpotLights.length > 0;\n    }\n}\n\nexport interface ForwardPassConfigs {\n    enableMainLightShadowMap: boolean;\n    enableMainLightPlanarShadowMap: boolean;\n    enablePlanarReflectionProbe: boolean;\n    enableMSAA: boolean;\n    enableSingleForwardPass: boolean;\n}\n\nexport class BuiltinForwardPassBuilder implements rendering.PipelinePassBuilder {\n    static ConfigOrder = 100;\n    static RenderOrder = 100;\n    getConfigOrder(): number {\n        return BuiltinForwardPassBuilder.ConfigOrder;\n    }\n    getRenderOrder(): number {\n        return BuiltinForwardPassBuilder.RenderOrder;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pipelineConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ForwardPassConfigs): void {\n        // Shadow\n        cameraConfigs.enableMainLightShadowMap = pipelineConfigs.shadowEnabled\n            && !pipelineConfigs.usePlanarShadow\n            && !!camera.scene\n            && !!camera.scene.mainLight\n            && camera.scene.mainLight.shadowEnabled;\n\n        cameraConfigs.enableMainLightPlanarShadowMap = pipelineConfigs.shadowEnabled\n            && pipelineConfigs.usePlanarShadow\n            && !!camera.scene\n            && !!camera.scene.mainLight\n            && camera.scene.mainLight.shadowEnabled;\n\n        // Reflection Probe\n        cameraConfigs.enablePlanarReflectionProbe = cameraConfigs.isMainGameWindow\n            || camera.cameraUsage === CameraUsage.SCENE_VIEW\n            || camera.cameraUsage === CameraUsage.GAME_VIEW;\n\n        // MSAA\n        cameraConfigs.enableMSAA = cameraConfigs.settings.msaa.enabled\n            && !cameraConfigs.enableStoreSceneDepth // Cannot store MS depth, resolve depth is also not cross-platform\n            && !pipelineConfigs.isWeb // TODO(zhouzhenglong): remove this constraint\n            && !pipelineConfigs.isWebGL1;\n\n        // Forward rendering (Depend on MSAA and TBR)\n        cameraConfigs.enableSingleForwardPass\n            = pipelineConfigs.isMobile || cameraConfigs.enableMSAA;\n\n        ++cameraConfigs.remainingPasses;\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        window: renderer.RenderWindow,\n        camera: renderer.scene.Camera,\n        nativeWidth: number,\n        nativeHeight: number): void {\n        const ResourceFlags = rendering.ResourceFlags;\n        const ResourceResidency = rendering.ResourceResidency;\n        const id = window.renderWindowId;\n        const settings = cameraConfigs.settings;\n\n        const width = cameraConfigs.enableShadingScale\n            ? Math.max(Math.floor(nativeWidth * cameraConfigs.shadingScale), 1)\n            : nativeWidth;\n        const height = cameraConfigs.enableShadingScale\n            ? Math.max(Math.floor(nativeHeight * cameraConfigs.shadingScale), 1)\n            : nativeHeight;\n\n        // MsaaRadiance\n        if (cameraConfigs.enableMSAA) {\n            // Notice: We never store multisample results.\n            // These samples are always resolved and discarded at the end of the render pass.\n            // So the ResourceResidency should be MEMORYLESS.\n            if (cameraConfigs.enableHDR) {\n                ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, cameraConfigs.radianceFormat, width, height, 1, 1, 1,\n                    settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\n            } else {\n                ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, Format.RGBA8, width, height, 1, 1, 1,\n                    settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\n            }\n            ppl.addTexture(`MsaaDepthStencil${id}`, TextureType.TEX2D, Format.DEPTH_STENCIL, width, height, 1, 1, 1,\n                settings.msaa.sampleCount, ResourceFlags.DEPTH_STENCIL_ATTACHMENT, ResourceResidency.MEMORYLESS);\n        }\n\n        // Mainlight ShadowMap\n        ppl.addRenderTarget(\n            `ShadowMap${id}`,\n            pplConfigs.shadowMapFormat,\n            pplConfigs.shadowMapSize.x,\n            pplConfigs.shadowMapSize.y,\n        );\n        ppl.addDepthStencil(\n            `ShadowDepth${id}`,\n            Format.DEPTH_STENCIL,\n            pplConfigs.shadowMapSize.x,\n            pplConfigs.shadowMapSize.y,\n        );\n\n        // Spot-light shadow maps\n        if (cameraConfigs.enableSingleForwardPass) {\n            const count = pplConfigs.mobileMaxSpotLightShadowMaps;\n            for (let i = 0; i !== count; ++i) {\n                ppl.addRenderTarget(\n                    `SpotShadowMap${i}`,\n                    pplConfigs.shadowMapFormat,\n                    pplConfigs.shadowMapSize.x,\n                    pplConfigs.shadowMapSize.y,\n                );\n                ppl.addDepthStencil(\n                    `SpotShadowDepth${i}`,\n                    Format.DEPTH_STENCIL,\n                    pplConfigs.shadowMapSize.x,\n                    pplConfigs.shadowMapSize.y,\n                );\n            }\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ForwardPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext): rendering.BasicRenderPassBuilder | undefined {\n        const id = camera.window.renderWindowId;\n\n        const scene = camera.scene!;\n        const mainLight = scene.mainLight;\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        // Forward Lighting (Light Culling)\n        this.forwardLighting.cullLights(scene, camera.frustum);\n\n        // Main Directional light CSM Shadow Map\n        if (cameraConfigs.enableMainLightShadowMap) {\n            assert(!!mainLight);\n            this._addCascadedShadowMapPass(ppl, pplConfigs, id, mainLight, camera);\n        }\n\n        // Spot light shadow maps (Mobile or MSAA)\n        if (cameraConfigs.enableSingleForwardPass) {\n            // Currently, only support 1 spot light with shadow map on mobile platform.\n            // TODO(zhouzhenglong): Relex this limitation.\n            this.forwardLighting.addSpotlightShadowPasses(\n                ppl, camera, pplConfigs.mobileMaxSpotLightShadowMaps);\n        }\n\n        this._tryAddReflectionProbePasses(ppl, cameraConfigs, id, mainLight, camera.scene);\n\n        if (cameraConfigs.remainingPasses > 0 || cameraConfigs.enableShadingScale) {\n            context.colorName = cameraConfigs.enableShadingScale\n                ? `ScaledRadiance0_${id}`\n                : `Radiance0_${id}`;\n            context.depthStencilName = cameraConfigs.enableShadingScale\n                ? `ScaledSceneDepth_${id}`\n                : `SceneDepth_${id}`;\n        } else {\n            context.colorName = cameraConfigs.colorName;\n            context.depthStencilName = cameraConfigs.depthStencilName;\n        }\n\n        const pass = this._addForwardRadiancePasses(\n            ppl, pplConfigs, cameraConfigs, id, camera,\n            cameraConfigs.width, cameraConfigs.height, mainLight,\n            context.colorName, context.depthStencilName,\n            !cameraConfigs.enableMSAA,\n            cameraConfigs.enableStoreSceneDepth ? StoreOp.STORE : StoreOp.DISCARD);\n\n        if (!cameraConfigs.enableStoreSceneDepth) {\n            context.depthStencilName = '';\n        }\n\n        if (cameraConfigs.remainingPasses === 0 && cameraConfigs.enableShadingScale) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, context.colorName);\n        } else {\n            return pass;\n        }\n    }\n    private _addCascadedShadowMapPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        id: number,\n        light: renderer.scene.DirectionalLight,\n        camera: renderer.scene.Camera,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // ----------------------------------------------------------------\n        // Dynamic states\n        // ----------------------------------------------------------------\n        const shadowSize = ppl.pipelineSceneData.shadows.size;\n        const width = shadowSize.x;\n        const height = shadowSize.y;\n\n        const viewport = this._viewport;\n        viewport.left = viewport.top = 0;\n        viewport.width = width;\n        viewport.height = height;\n\n        // ----------------------------------------------------------------\n        // CSM Shadow Map\n        // ----------------------------------------------------------------\n        const pass = ppl.addRenderPass(width, height, 'default');\n        pass.name = 'CascadedShadowMap';\n        pass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n        pass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\n        const csmLevel = ppl.pipelineSceneData.csmSupported ? light.csmLevel : 1;\n\n        // Add shadow map viewports\n        for (let level = 0; level !== csmLevel; ++level) {\n            getCsmMainLightViewport(light, width, height, level, this._viewport, pplConfigs.screenSpaceSignY);\n            const queue = pass.addQueue(QueueHint.NONE, 'shadow-caster');\n            if (!pplConfigs.isWebGPU) { // Temporary workaround for WebGPU\n                queue.setViewport(this._viewport);\n            }\n            queue\n                .addScene(camera, SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light, level);\n        }\n    }\n    private _tryAddReflectionProbePasses(\n        ppl: rendering.BasicPipeline,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null,\n    ): void {\n        const reflectionProbeManager = cclegacy.internal.reflectionProbeManager as ReflectionProbeManager | undefined;\n        if (!reflectionProbeManager) {\n            return;\n        }\n        const ResourceResidency = rendering.ResourceResidency;\n        const probes = reflectionProbeManager.getProbes();\n        const maxProbeCount = 4;\n        let probeID = 0;\n        for (const probe of probes) {\n            if (!probe.needRender) {\n                continue;\n            }\n            const area = probe.renderArea();\n            const width = Math.max(Math.floor(area.x), 1);\n            const height = Math.max(Math.floor(area.y), 1);\n\n            if (probe.probeType === renderer.scene.ProbeType.PLANAR) {\n                if (!cameraConfigs.enablePlanarReflectionProbe) {\n                    continue;\n                }\n                const window: renderer.RenderWindow = probe.realtimePlanarTexture!.window!;\n                const colorName = `PlanarProbeRT${probeID}`;\n                const depthStencilName = `PlanarProbeDS${probeID}`;\n                // ProbeResource\n                ppl.addRenderWindow(colorName,\n                    cameraConfigs.radianceFormat, width, height, window);\n                ppl.addDepthStencil(depthStencilName,\n                    gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\n\n                // Rendering\n                const probePass = ppl.addRenderPass(width, height, 'default');\n                probePass.name = `PlanarReflectionProbe${probeID}`;\n                this._buildReflectionProbePass(probePass, cameraConfigs, id, probe.camera,\n                    colorName, depthStencilName, mainLight, scene);\n            } else if (EDITOR) {\n                for (let faceIdx = 0; faceIdx < probe.bakedCubeTextures.length; faceIdx++) {\n                    probe.updateCameraDir(faceIdx);\n                    const window: renderer.RenderWindow = probe.bakedCubeTextures[faceIdx].window!;\n                    const colorName = `CubeProbeRT${probeID}${faceIdx}`;\n                    const depthStencilName = `CubeProbeDS${probeID}${faceIdx}`;\n                    // ProbeResource\n                    ppl.addRenderWindow(colorName,\n                        cameraConfigs.radianceFormat, width, height, window);\n                    ppl.addDepthStencil(depthStencilName,\n                        gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\n\n                    // Rendering\n                    const probePass = ppl.addRenderPass(width, height, 'default');\n                    probePass.name = `CubeProbe${probeID}${faceIdx}`;\n                    this._buildReflectionProbePass(probePass, cameraConfigs, id, probe.camera,\n                        colorName, depthStencilName, mainLight, scene);\n                }\n                probe.needRender = false;\n            }\n            ++probeID;\n            if (probeID === maxProbeCount) {\n                break;\n            }\n        }\n    }\n    private _buildReflectionProbePass(\n        pass: rendering.BasicRenderPassBuilder,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        colorName: string,\n        depthStencilName: string,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null = null,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // set viewport\n        const colorStoreOp = cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\n\n        // bind output render target\n        if (forwardNeedClearColor(camera)) {\n            this._reflectionProbeClearColor.x = camera.clearColor.x;\n            this._reflectionProbeClearColor.y = camera.clearColor.y;\n            this._reflectionProbeClearColor.z = camera.clearColor.z;\n            const clearColor = rendering.packRGBE(this._reflectionProbeClearColor);\n            this._clearColor.x = clearColor.x;\n            this._clearColor.y = clearColor.y;\n            this._clearColor.z = clearColor.z;\n            this._clearColor.w = clearColor.w;\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\n        } else {\n            pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\n        }\n\n        // bind depth stencil buffer\n        if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n            pass.addDepthStencil(\n                depthStencilName,\n                LoadOp.CLEAR,\n                StoreOp.DISCARD,\n                camera.clearDepth,\n                camera.clearStencil,\n                camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n            );\n        } else {\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\n        }\n\n        // Set shadow map if enabled\n        if (cameraConfigs.enableMainLightShadowMap) {\n            pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\n        }\n\n        // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\n\n        // add opaque and mask queue\n        pass.addQueue(QueueHint.NONE, 'reflect-map') // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\n            .addScene(camera,\n                SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.REFLECTION_PROBE,\n                mainLight || undefined,\n                scene ? scene : undefined);\n    }\n    private _addForwardRadiancePasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        disableMSAA: boolean = false,\n        depthStencilStoreOp: gfx.StoreOp = StoreOp.DISCARD,\n    ): rendering.BasicRenderPassBuilder {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // ----------------------------------------------------------------\n        // Dynamic states\n        // ----------------------------------------------------------------\n        // Prepare camera clear color\n        const clearColor = camera.clearColor; // Reduce C++/TS interop\n        this._clearColor.x = clearColor.x;\n        this._clearColor.y = clearColor.y;\n        this._clearColor.z = clearColor.z;\n        this._clearColor.w = clearColor.w;\n\n        // Prepare camera viewport\n        const viewport = camera.viewport; // Reduce C++/TS interop\n        this._viewport.left = Math.round(viewport.x * width);\n        this._viewport.top = Math.round(viewport.y * height);\n        // Here we must use camera.viewport.width instead of camera.viewport.z, which\n        // is undefined on native platform. The same as camera.viewport.height.\n        this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\n        this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\n\n        // MSAA\n        const enableMSAA = !disableMSAA && cameraConfigs.enableMSAA;\n        assert(!enableMSAA || cameraConfigs.enableSingleForwardPass);\n\n        // ----------------------------------------------------------------\n        // Forward Lighting (Main Directional Light)\n        // ----------------------------------------------------------------\n        const pass = cameraConfigs.enableSingleForwardPass\n            ? this._addForwardSingleRadiancePass(ppl, pplConfigs, cameraConfigs,\n                id, camera, enableMSAA, width, height, mainLight,\n                colorName, depthStencilName, depthStencilStoreOp)\n            : this._addForwardMultipleRadiancePasses(ppl, cameraConfigs,\n                id, camera, width, height, mainLight,\n                colorName, depthStencilName, depthStencilStoreOp);\n\n        // Planar Shadow\n        if (cameraConfigs.enableMainLightPlanarShadowMap) {\n            this._addPlanarShadowQueue(camera, mainLight, pass);\n        }\n\n        // ----------------------------------------------------------------\n        // Forward Lighting (Blend)\n        // ----------------------------------------------------------------\n        // Add transparent queue\n\n        const sceneFlags = SceneFlags.BLEND |\n            (camera.geometryRenderer\n                ? SceneFlags.GEOMETRY\n                : SceneFlags.NONE);\n\n        pass\n            .addQueue(QueueHint.BLEND)\n            .addScene(camera, sceneFlags, mainLight || undefined);\n\n        return pass;\n    }\n    private _addForwardSingleRadiancePass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        enableMSAA: boolean,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp\n    ): rendering.BasicRenderPassBuilder {\n        assert(cameraConfigs.enableSingleForwardPass);\n        // ----------------------------------------------------------------\n        // Forward Lighting (Main Directional Light)\n        // ----------------------------------------------------------------\n        let pass: rendering.BasicRenderPassBuilder;\n        if (enableMSAA) {\n            const msaaRadianceName = `MsaaRadiance${id}`;\n            const msaaDepthStencilName = `MsaaDepthStencil${id}`;\n            const sampleCount = cameraConfigs.settings.msaa.sampleCount;\n\n            const msPass = ppl.addMultisampleRenderPass(width, height, sampleCount, 0, 'default');\n            msPass.name = 'MsaaForwardPass';\n\n            // MSAA always discards depth stencil\n            this._buildForwardMainLightPass(msPass, cameraConfigs, id, camera,\n                msaaRadianceName, msaaDepthStencilName, StoreOp.DISCARD, mainLight);\n\n            msPass.resolveRenderTarget(msaaRadianceName, colorName);\n\n            pass = msPass;\n        } else {\n            pass = ppl.addRenderPass(width, height, 'default');\n            pass.name = 'ForwardPass';\n\n            this._buildForwardMainLightPass(pass, cameraConfigs, id, camera,\n                colorName, depthStencilName, depthStencilStoreOp, mainLight);\n        }\n        assert(pass !== undefined);\n\n        // Forward Lighting (Additive Lights)\n        this.forwardLighting.addLightQueues(\n            pass,\n            camera,\n            pplConfigs.mobileMaxSpotLightShadowMaps,\n        );\n\n        return pass;\n    }\n    private _addForwardMultipleRadiancePasses(\n        ppl: rendering.BasicPipeline,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp\n    ): rendering.BasicRenderPassBuilder {\n        assert(!cameraConfigs.enableSingleForwardPass);\n\n        // Forward Lighting (Main Directional Light)\n        let pass = ppl.addRenderPass(width, height, 'default');\n        pass.name = 'ForwardPass';\n\n        const firstStoreOp = this.forwardLighting.isMultipleLightPassesNeeded()\n            ? StoreOp.STORE\n            : depthStencilStoreOp;\n\n        this._buildForwardMainLightPass(pass, cameraConfigs,\n            id, camera, colorName, depthStencilName, firstStoreOp, mainLight);\n\n        // Forward Lighting (Additive Lights)\n        pass = this.forwardLighting\n            .addLightPasses(colorName, depthStencilName, depthStencilStoreOp,\n                id, width, height, camera, this._viewport, ppl, pass);\n\n        return pass;\n    }\n    private _buildForwardMainLightPass(\n        pass: rendering.BasicRenderPassBuilder,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null = null,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // set viewport\n        pass.setViewport(this._viewport);\n\n        const colorStoreOp = cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\n\n        // bind output render target\n        if (forwardNeedClearColor(camera)) {\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\n        } else {\n            pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\n        }\n\n        // bind depth stencil buffer\n        if (DEBUG) {\n            if (colorName === cameraConfigs.colorName &&\n                depthStencilName !== cameraConfigs.depthStencilName) {\n                warn('Default framebuffer cannot use custom depth stencil buffer');\n            }\n        }\n\n        if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n            pass.addDepthStencil(\n                depthStencilName,\n                LoadOp.CLEAR,\n                depthStencilStoreOp,\n                camera.clearDepth,\n                camera.clearStencil,\n                camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n            );\n        } else {\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, depthStencilStoreOp);\n        }\n\n        // Set shadow map if enabled\n        if (cameraConfigs.enableMainLightShadowMap) {\n            pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\n        }\n\n        // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\n\n        // add opaque and mask queue\n        pass.addQueue(QueueHint.NONE) // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\n            .addScene(camera,\n                SceneFlags.OPAQUE | SceneFlags.MASK,\n                mainLight || undefined,\n                scene ? scene : undefined);\n    }\n    private _addPlanarShadowQueue(\n        camera: renderer.scene.Camera,\n        mainLight: renderer.scene.DirectionalLight | null,\n        pass: rendering.BasicRenderPassBuilder,\n    ) {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        pass.addQueue(QueueHint.BLEND, 'planar-shadow')\n            .addScene(\n                camera,\n                SceneFlags.SHADOW_CASTER | SceneFlags.PLANAR_SHADOW | SceneFlags.BLEND,\n                mainLight || undefined,\n            );\n    }\n    private readonly forwardLighting = new ForwardLighting();\n    private readonly _viewport = new Viewport();\n    private readonly _clearColor = new Color(0, 0, 0, 1);\n    private readonly _reflectionProbeClearColor = new Vec3(0, 0, 0);\n}\n\nexport interface BloomPassConfigs {\n    enableBloom: boolean;\n}\n\nexport class BuiltinBloomPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 200;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pipelineConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs): void {\n        cameraConfigs.enableBloom\n            = cameraConfigs.settings.bloom.enabled\n            && !!cameraConfigs.settings.bloom.material;\n        if (cameraConfigs.enableBloom) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs,\n        window: renderer.RenderWindow): void {\n        if (cameraConfigs.enableBloom) {\n            const id = window.renderWindowId;\n            let bloomWidth = cameraConfigs.width;\n            let bloomHeight = cameraConfigs.height;\n            for (let i = 0; i !== cameraConfigs.settings.bloom.iterations + 1; ++i) {\n                bloomWidth = Math.max(Math.floor(bloomWidth / 2), 1);\n                bloomHeight = Math.max(Math.floor(bloomHeight / 2), 1);\n                ppl.addRenderTarget(`BloomTex${id}_${i}`,\n                    cameraConfigs.radianceFormat, bloomWidth, bloomHeight);\n            }\n        }\n    }\n\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableBloom) {\n            return prevRenderPass;\n        }\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n        const id = camera.window.renderWindowId;\n        assert(!!cameraConfigs.settings.bloom.material);\n        return this._addKawaseDualFilterBloomPasses(\n            ppl, pplConfigs,\n            cameraConfigs,\n            cameraConfigs.settings,\n            cameraConfigs.settings.bloom.material,\n            id,\n            cameraConfigs.width,\n            cameraConfigs.height,\n            context.colorName);\n    }\n\n    private _addKawaseDualFilterBloomPasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & Readonly<BloomPassConfigs>,\n        settings: PipelineSettings,\n        bloomMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        radianceName: string,\n    ): rendering.BasicRenderPassBuilder {\n        const QueueHint = rendering.QueueHint;\n        // Based on Kawase Dual Filter Blur. Saves bandwidth on mobile devices.\n        // eslint-disable-next-line max-len\n        // https://community.arm.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-20-66/siggraph2015_2D00_mmg_2D00_marius_2D00_slides.pdf\n\n        // Size: [prefilter(1/2), downsample(1/4), downsample(1/8), downsample(1/16), ...]\n        const iterations = settings.bloom.iterations;\n        const sizeCount = iterations + 1;\n        this._bloomWidths.length = sizeCount;\n        this._bloomHeights.length = sizeCount;\n        this._bloomWidths[0] = Math.max(Math.floor(width / 2), 1);\n        this._bloomHeights[0] = Math.max(Math.floor(height / 2), 1);\n        for (let i = 1; i !== sizeCount; ++i) {\n            this._bloomWidths[i] = Math.max(Math.floor(this._bloomWidths[i - 1] / 2), 1);\n            this._bloomHeights[i] = Math.max(Math.floor(this._bloomHeights[i - 1] / 2), 1);\n        }\n\n        // Bloom texture names\n        this._bloomTexNames.length = sizeCount;\n        for (let i = 0; i !== sizeCount; ++i) {\n            this._bloomTexNames[i] = `BloomTex${id}_${i}`;\n        }\n\n        // Setup bloom parameters\n        this._bloomParams.x = pplConfigs.useFloatOutput ? 1 : 0;\n        this._bloomParams.x = 0; // unused\n        this._bloomParams.z = settings.bloom.threshold;\n        this._bloomParams.w = settings.bloom.enableAlphaMask ? 1 : 0;\n\n        // Prefilter pass\n        const prefilterPass = ppl.addRenderPass(this._bloomWidths[0], this._bloomHeights[0], 'cc-bloom-prefilter');\n        prefilterPass.addRenderTarget(\n            this._bloomTexNames[0],\n            LoadOp.CLEAR,\n            StoreOp.STORE,\n            this._clearColorTransparentBlack,\n        );\n        prefilterPass.addTexture(radianceName, 'inputTexture');\n        prefilterPass.setVec4('g_platform', pplConfigs.platform);\n        prefilterPass.setVec4('bloomParams', this._bloomParams);\n        prefilterPass\n            .addQueue(QueueHint.OPAQUE)\n            .addFullscreenQuad(bloomMaterial, 0);\n\n        // Downsample passes\n        for (let i = 1; i !== sizeCount; ++i) {\n            const downPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-downsample');\n            downPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\n            downPass.addTexture(this._bloomTexNames[i - 1], 'bloomTexture');\n            this._bloomTexSize.x = this._bloomWidths[i - 1];\n            this._bloomTexSize.y = this._bloomHeights[i - 1];\n            downPass.setVec4('g_platform', pplConfigs.platform);\n            downPass.setVec4('bloomTexSize', this._bloomTexSize);\n            downPass\n                .addQueue(QueueHint.OPAQUE)\n                .addFullscreenQuad(bloomMaterial, 1);\n        }\n\n        // Upsample passes\n        for (let i = iterations; i-- > 0;) {\n            const upPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-upsample');\n            upPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\n            upPass.addTexture(this._bloomTexNames[i + 1], 'bloomTexture');\n            this._bloomTexSize.x = this._bloomWidths[i + 1];\n            this._bloomTexSize.y = this._bloomHeights[i + 1];\n            upPass.setVec4('g_platform', pplConfigs.platform);\n            upPass.setVec4('bloomTexSize', this._bloomTexSize);\n            upPass\n                .addQueue(QueueHint.OPAQUE)\n                .addFullscreenQuad(bloomMaterial, 2);\n        }\n\n        // Combine pass\n        const combinePass = ppl.addRenderPass(width, height, 'cc-bloom-combine');\n        combinePass.addRenderTarget(radianceName, LoadOp.LOAD, StoreOp.STORE);\n        combinePass.addTexture(this._bloomTexNames[0], 'bloomTexture');\n        combinePass.setVec4('g_platform', pplConfigs.platform);\n        combinePass.setVec4('bloomParams', this._bloomParams);\n        combinePass\n            .addQueue(QueueHint.BLEND)\n            .addFullscreenQuad(bloomMaterial, 3);\n\n        if (cameraConfigs.remainingPasses === 0) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, radianceName);\n        } else {\n            return combinePass;\n        }\n    }\n    // Bloom\n    private readonly _clearColorTransparentBlack = new Color(0, 0, 0, 0);\n    private readonly _bloomParams = new Vec4(0, 0, 0, 0);\n    private readonly _bloomTexSize = new Vec4(0, 0, 0, 0);\n    private readonly _bloomWidths: Array<number> = [];\n    private readonly _bloomHeights: Array<number> = [];\n    private readonly _bloomTexNames: Array<string> = [];\n}\n\nexport interface ToneMappingPassConfigs {\n    enableToneMapping: boolean;\n    enableColorGrading: boolean;\n}\n\nexport class BuiltinToneMappingPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 300;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs): void {\n        const settings = cameraConfigs.settings;\n\n        cameraConfigs.enableColorGrading\n            = settings.colorGrading.enabled\n            && !!settings.colorGrading.material\n            && !!settings.colorGrading.colorGradingMap;\n\n        cameraConfigs.enableToneMapping\n            = cameraConfigs.enableHDR // From Half to RGBA8\n            || cameraConfigs.enableColorGrading; // Color grading\n\n        if (cameraConfigs.enableToneMapping) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs): void {\n        if (cameraConfigs.enableColorGrading) {\n            assert(!!cameraConfigs.settings.colorGrading.material);\n            cameraConfigs.settings.colorGrading.material.setProperty(\n                'colorGradingMap',\n                cameraConfigs.settings.colorGrading.colorGradingMap);\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableToneMapping) {\n            return prevRenderPass;\n        }\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n        if (cameraConfigs.remainingPasses === 0) {\n            return this._addCopyAndTonemapPass(ppl, pplConfigs, cameraConfigs,\n                cameraConfigs.width, cameraConfigs.height,\n                context.colorName, cameraConfigs.colorName);\n        } else {\n            const id = cameraConfigs.renderWindowId;\n            const ldrColorPrefix = cameraConfigs.enableShadingScale\n                ? `ScaledLdrColor`\n                : `LdrColor`;\n\n            const ldrColorName = getPingPongRenderTarget(context.colorName, ldrColorPrefix, id);\n            const radianceName = context.colorName;\n            context.colorName = ldrColorName;\n\n            return this._addCopyAndTonemapPass(ppl, pplConfigs, cameraConfigs,\n                cameraConfigs.width, cameraConfigs.height,\n                radianceName, ldrColorName);\n        }\n    }\n    private _addCopyAndTonemapPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs,\n        width: number,\n        height: number,\n        radianceName: string,\n        colorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        let pass: rendering.BasicRenderPassBuilder;\n        const settings = cameraConfigs.settings;\n        if (cameraConfigs.enableColorGrading) {\n            assert(!!settings.colorGrading.material);\n            assert(!!settings.colorGrading.colorGradingMap);\n\n            const lutTex = settings.colorGrading.colorGradingMap;\n            this._colorGradingTexSize.x = lutTex.width;\n            this._colorGradingTexSize.y = lutTex.height;\n\n            const isSquareMap = lutTex.width === lutTex.height;\n            if (isSquareMap) {\n                pass = ppl.addRenderPass(width, height, 'cc-color-grading-8x8');\n            } else {\n                pass = ppl.addRenderPass(width, height, 'cc-color-grading-nx1');\n            }\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n            pass.addTexture(radianceName, 'sceneColorMap');\n            pass.setVec4('g_platform', pplConfigs.platform);\n            pass.setVec2('lutTextureSize', this._colorGradingTexSize);\n            pass.setFloat('contribute', settings.colorGrading.contribute);\n            pass.addQueue(rendering.QueueHint.OPAQUE)\n                .addFullscreenQuad(settings.colorGrading.material, isSquareMap ? 1 : 0);\n        } else {\n            pass = ppl.addRenderPass(width, height, 'cc-tone-mapping');\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n            pass.addTexture(radianceName, 'inputTexture');\n            pass.setVec4('g_platform', pplConfigs.platform);\n            if (settings.toneMapping.material) {\n                pass.addQueue(rendering.QueueHint.OPAQUE)\n                    .addFullscreenQuad(settings.toneMapping.material, 0);\n            } else {\n                assert(!!cameraConfigs.copyAndTonemapMaterial);\n                pass.addQueue(rendering.QueueHint.OPAQUE)\n                    .addFullscreenQuad(cameraConfigs.copyAndTonemapMaterial, 0);\n            }\n        }\n        return pass;\n    }\n    private readonly _colorGradingTexSize = new Vec2(0, 0);\n}\n\nexport interface FXAAPassConfigs {\n    enableFXAA: boolean;\n}\n\nexport class BuiltinFXAAPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 400;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FXAAPassConfigs): void {\n        cameraConfigs.enableFXAA\n            = cameraConfigs.settings.fxaa.enabled\n            && !!cameraConfigs.settings.fxaa.material;\n        if (cameraConfigs.enableFXAA) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FXAAPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableFXAA) {\n            return prevRenderPass;\n        }\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        const id = cameraConfigs.renderWindowId;\n        const ldrColorPrefix = cameraConfigs.enableShadingScale\n            ? `ScaledLdrColor`\n            : `LdrColor`;\n        const ldrColorName = getPingPongRenderTarget(context.colorName, ldrColorPrefix, id);\n\n        assert(!!cameraConfigs.settings.fxaa.material);\n        if (cameraConfigs.remainingPasses === 0) {\n            if (cameraConfigs.enableShadingScale) {\n                this._addFxaaPass(ppl, pplConfigs,\n                    cameraConfigs.settings.fxaa.material,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName,\n                    ldrColorName);\n                return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, ldrColorName);\n            } else {\n                assert(cameraConfigs.width === cameraConfigs.nativeWidth);\n                assert(cameraConfigs.height === cameraConfigs.nativeHeight);\n                return this._addFxaaPass(ppl, pplConfigs,\n                    cameraConfigs.settings.fxaa.material,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName,\n                    cameraConfigs.colorName);\n            }\n        } else {\n            const inputColorName = context.colorName;\n            context.colorName = ldrColorName;\n            const lastPass = this._addFxaaPass(ppl, pplConfigs,\n                cameraConfigs.settings.fxaa.material,\n                cameraConfigs.width,\n                cameraConfigs.height,\n                inputColorName,\n                ldrColorName);\n            return lastPass;\n        }\n    }\n    private _addFxaaPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        fxaaMaterial: Material,\n        width: number,\n        height: number,\n        ldrColorName: string,\n        colorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        this._fxaaParams.x = width;\n        this._fxaaParams.y = height;\n        this._fxaaParams.z = 1 / width;\n        this._fxaaParams.w = 1 / height;\n\n        const pass = ppl.addRenderPass(width, height, 'cc-fxaa');\n        pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        pass.addTexture(ldrColorName, 'sceneColorMap');\n        pass.setVec4('g_platform', pplConfigs.platform);\n        pass.setVec4('texSize', this._fxaaParams);\n        pass.addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fxaaMaterial, 0);\n        return pass;\n    }\n    // FXAA\n    private readonly _fxaaParams = new Vec4(0, 0, 0, 0);\n}\n\nexport interface FSRPassConfigs {\n    enableFSR: boolean;\n}\n\nexport class BuiltinFsrPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 500;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs): void {\n        // FSR (Depend on Shading scale)\n        cameraConfigs.enableFSR = cameraConfigs.settings.fsr.enabled\n            && !!cameraConfigs.settings.fsr.material\n            && cameraConfigs.enableShadingScale\n            && cameraConfigs.shadingScale < 1.0;\n\n        if (cameraConfigs.enableFSR) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableFSR) {\n            return prevRenderPass;\n        }\n        --cameraConfigs.remainingPasses;\n\n        const inputColorName = context.colorName;\n        const outputColorName\n            = cameraConfigs.remainingPasses === 0\n                ? cameraConfigs.colorName\n                : getPingPongRenderTarget(context.colorName, 'UiColor', cameraConfigs.renderWindowId);\n        context.colorName = outputColorName;\n\n        assert(!!cameraConfigs.settings.fsr.material);\n        return this._addFsrPass(ppl, pplConfigs, cameraConfigs,\n            cameraConfigs.settings,\n            cameraConfigs.settings.fsr.material,\n            cameraConfigs.renderWindowId,\n            cameraConfigs.width,\n            cameraConfigs.height,\n            inputColorName,\n            cameraConfigs.nativeWidth,\n            cameraConfigs.nativeHeight,\n            outputColorName);\n    }\n    private _addFsrPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        settings: PipelineSettings,\n        fsrMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        inputColorName: string,\n        nativeWidth: number,\n        nativeHeight: number,\n        outputColorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        this._fsrTexSize.x = width;\n        this._fsrTexSize.y = height;\n        this._fsrTexSize.z = nativeWidth;\n        this._fsrTexSize.w = nativeHeight;\n        this._fsrParams.x = clamp(1.0 - settings.fsr.sharpness, 0.02, 0.98);\n\n        const uiColorPrefix = 'UiColor';\n\n        const fsrColorName = getPingPongRenderTarget(outputColorName, uiColorPrefix, id);\n\n        const easuPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-easu');\n        easuPass.addRenderTarget(fsrColorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        easuPass.addTexture(inputColorName, 'outputResultMap');\n        easuPass.setVec4('g_platform', pplConfigs.platform);\n        easuPass.setVec4('fsrTexSize', this._fsrTexSize);\n        easuPass\n            .addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fsrMaterial, 0);\n\n        const rcasPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-rcas');\n        rcasPass.addRenderTarget(outputColorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        rcasPass.addTexture(fsrColorName, 'outputResultMap');\n        rcasPass.setVec4('g_platform', pplConfigs.platform);\n        rcasPass.setVec4('fsrTexSize', this._fsrTexSize);\n        rcasPass.setVec4('fsrParams', this._fsrParams);\n        rcasPass\n            .addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fsrMaterial, 1);\n\n        return rcasPass;\n    }\n    // FSR\n    private readonly _fsrParams = new Vec4(0, 0, 0, 0);\n    private readonly _fsrTexSize = new Vec4(0, 0, 0, 0);\n}\n\nexport class BuiltinUiPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 1000;\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        assert(!!prevRenderPass);\n\n        let flags = rendering.SceneFlags.UI;\n        if (cameraConfigs.enableProfiler) {\n            flags |= rendering.SceneFlags.PROFILER;\n            prevRenderPass.showStatistics = true;\n        }\n        prevRenderPass\n            .addQueue(rendering.QueueHint.BLEND, 'default', 'default')\n            .addScene(camera, flags);\n\n        return prevRenderPass;\n    }\n}\n\nif (rendering) {\n\n    const { QueueHint, SceneFlags } = rendering;\n\n    class BuiltinPipelineBuilder implements rendering.PipelineBuilder {\n        private readonly _pipelineEvent: PipelineEventProcessor = cclegacy.director.root.pipelineEvent as PipelineEventProcessor;\n        private readonly _forwardPass = new BuiltinForwardPassBuilder();\n        private readonly _bloomPass = new BuiltinBloomPassBuilder();\n        private readonly _toneMappingPass = new BuiltinToneMappingPassBuilder();\n        private readonly _fxaaPass = new BuiltinFXAAPassBuilder();\n        private readonly _fsrPass = new BuiltinFsrPassBuilder();\n        private readonly _uiPass = new BuiltinUiPassBuilder();\n        // Internal cached resources\n        private readonly _clearColor = new Color(0, 0, 0, 1);\n        private readonly _viewport = new Viewport();\n        private readonly _configs = new PipelineConfigs();\n        private readonly _cameraConfigs = new CameraConfigs();\n        // Materials\n        private readonly _copyAndTonemapMaterial = new Material();\n\n        // Internal States\n        private _initialized = false; // TODO(zhouzhenglong): Make default effect asset loading earlier and remove this flag\n        private _passBuilders: rendering.PipelinePassBuilder[] = [];\n\n        private _setupPipelinePreview(\n            camera: renderer.scene.Camera,\n            cameraConfigs: CameraConfigs) {\n            const isEditorView: boolean\n                = camera.cameraUsage === CameraUsage.SCENE_VIEW\n                || camera.cameraUsage === CameraUsage.PREVIEW;\n\n            if (isEditorView) {\n                const editorSettings = rendering.getEditorPipelineSettings() as PipelineSettings | null;\n                if (editorSettings) {\n                    cameraConfigs.settings = editorSettings;\n                } else {\n                    cameraConfigs.settings = defaultSettings;\n                }\n            } else {\n                if (camera.pipelineSettings) {\n                    cameraConfigs.settings = camera.pipelineSettings as PipelineSettings;\n                } else {\n                    cameraConfigs.settings = defaultSettings;\n                }\n            }\n        }\n\n        private _preparePipelinePasses(cameraConfigs: CameraConfigs): void {\n            const passBuilders = this._passBuilders;\n            passBuilders.length = 0;\n\n            const settings = cameraConfigs.settings as PipelineSettings2;\n            if (settings._passes) {\n                for (const pass of settings._passes) {\n                    passBuilders.push(pass);\n                }\n                assert(passBuilders.length === settings._passes.length);\n            }\n\n            passBuilders.push(this._forwardPass);\n\n            if (settings.bloom.enabled) {\n                passBuilders.push(this._bloomPass);\n            }\n\n            passBuilders.push(this._toneMappingPass);\n\n            if (settings.fxaa.enabled) {\n                passBuilders.push(this._fxaaPass);\n            }\n\n            if (settings.fsr.enabled) {\n                passBuilders.push(this._fsrPass);\n            }\n            passBuilders.push(this._uiPass);\n        }\n\n        private _setupBuiltinCameraConfigs(\n            camera: renderer.scene.Camera,\n            pipelineConfigs: PipelineConfigs,\n            cameraConfigs: CameraConfigs\n        ) {\n            const window = camera.window;\n            const isMainGameWindow: boolean = camera.cameraUsage === CameraUsage.GAME && !!window.swapchain;\n\n            // Window\n            cameraConfigs.isMainGameWindow = isMainGameWindow;\n            cameraConfigs.renderWindowId = window.renderWindowId;\n\n            // Camera\n            cameraConfigs.colorName = window.colorName;\n            cameraConfigs.depthStencilName = window.depthStencilName;\n\n            // Pipeline\n            cameraConfigs.enableFullPipeline = (camera.visibility & (Layers.Enum.DEFAULT)) !== 0;\n            cameraConfigs.enableProfiler = DEBUG && isMainGameWindow;\n            cameraConfigs.remainingPasses = 0;\n\n            // Shading scale\n            cameraConfigs.shadingScale = cameraConfigs.settings.shadingScale;\n            cameraConfigs.enableShadingScale = cameraConfigs.settings.enableShadingScale\n                && cameraConfigs.shadingScale !== 1.0;\n\n            cameraConfigs.nativeWidth = Math.max(Math.floor(window.width), 1);\n            cameraConfigs.nativeHeight = Math.max(Math.floor(window.height), 1);\n\n            cameraConfigs.width = cameraConfigs.enableShadingScale\n                ? Math.max(Math.floor(cameraConfigs.nativeWidth * cameraConfigs.shadingScale), 1)\n                : cameraConfigs.nativeWidth;\n            cameraConfigs.height = cameraConfigs.enableShadingScale\n                ? Math.max(Math.floor(cameraConfigs.nativeHeight * cameraConfigs.shadingScale), 1)\n                : cameraConfigs.nativeHeight;\n\n            // Radiance\n            cameraConfigs.enableHDR = cameraConfigs.enableFullPipeline\n                && pipelineConfigs.useFloatOutput;\n            cameraConfigs.radianceFormat = cameraConfigs.enableHDR\n                ? gfx.Format.RGBA16F : gfx.Format.RGBA8;\n\n            // Tone Mapping\n            cameraConfigs.copyAndTonemapMaterial = this._copyAndTonemapMaterial;\n\n            // Depth\n            cameraConfigs.enableStoreSceneDepth = false;\n        }\n\n        private _setupCameraConfigs(\n            camera: renderer.scene.Camera,\n            pipelineConfigs: PipelineConfigs,\n            cameraConfigs: CameraConfigs\n        ): void {\n            this._setupPipelinePreview(camera, cameraConfigs);\n\n            this._preparePipelinePasses(cameraConfigs);\n\n            sortPipelinePassBuildersByConfigOrder(this._passBuilders);\n\n            this._setupBuiltinCameraConfigs(camera, pipelineConfigs, cameraConfigs);\n\n            for (const builder of this._passBuilders) {\n                if (builder.configCamera) {\n                    builder.configCamera(camera, pipelineConfigs, cameraConfigs);\n                }\n            }\n        }\n\n        // ----------------------------------------------------------------\n        // Interface\n        // ----------------------------------------------------------------\n        windowResize(\n            ppl: rendering.BasicPipeline,\n            window: renderer.RenderWindow,\n            camera: renderer.scene.Camera,\n            nativeWidth: number,\n            nativeHeight: number,\n        ): void {\n            setupPipelineConfigs(ppl, this._configs);\n\n            this._setupCameraConfigs(camera, this._configs, this._cameraConfigs);\n\n            // Render Window (UI)\n            const id = window.renderWindowId;\n\n            ppl.addRenderWindow(this._cameraConfigs.colorName,\n                Format.RGBA8, nativeWidth, nativeHeight, window,\n                this._cameraConfigs.depthStencilName);\n\n            const width = this._cameraConfigs.width;\n            const height = this._cameraConfigs.height;\n\n            if (this._cameraConfigs.enableShadingScale) {\n                ppl.addDepthStencil(`ScaledSceneDepth_${id}`, Format.DEPTH_STENCIL, width, height);\n                ppl.addRenderTarget(`ScaledRadiance0_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`ScaledRadiance1_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`ScaledLdrColor0_${id}`, Format.RGBA8, width, height);\n                ppl.addRenderTarget(`ScaledLdrColor1_${id}`, Format.RGBA8, width, height);\n            } else {\n                ppl.addDepthStencil(`SceneDepth_${id}`, Format.DEPTH_STENCIL, width, height);\n                ppl.addRenderTarget(`Radiance0_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`Radiance1_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`LdrColor0_${id}`, Format.RGBA8, width, height);\n                ppl.addRenderTarget(`LdrColor1_${id}`, Format.RGBA8, width, height);\n            }\n            ppl.addRenderTarget(`UiColor0_${id}`, Format.RGBA8, nativeWidth, nativeHeight);\n            ppl.addRenderTarget(`UiColor1_${id}`, Format.RGBA8, nativeWidth, nativeHeight);\n\n            for (const builder of this._passBuilders) {\n                if (builder.windowResize) {\n                    builder.windowResize(ppl, this._configs, this._cameraConfigs, window, camera, nativeWidth, nativeHeight);\n                }\n            }\n        }\n        setup(cameras: renderer.scene.Camera[], ppl: rendering.BasicPipeline): void {\n            // TODO(zhouzhenglong): Make default effect asset loading earlier and remove _initMaterials\n            if (this._initMaterials(ppl)) {\n                return;\n            }\n            // Render cameras\n            // log(`==================== One Frame ====================`);\n            for (const camera of cameras) {\n                // Skip invalid camera\n                if (!camera.scene || !camera.window) {\n                    continue;\n                }\n                // Setup camera configs\n                this._setupCameraConfigs(camera, this._configs, this._cameraConfigs);\n                // log(`Setup camera: ${camera.node!.name}, window: ${camera.window.renderWindowId}, isFull: ${this._cameraConfigs.enableFullPipeline}, `\n                //     + `size: ${camera.window.width}x${camera.window.height}`);\n\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_BEGIN, camera);\n\n                // Build pipeline\n                if (this._cameraConfigs.enableFullPipeline) {\n                    this._buildForwardPipeline(ppl, camera, camera.scene, this._passBuilders);\n                } else {\n                    this._buildSimplePipeline(ppl, camera);\n                }\n\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_END, camera);\n            }\n        }\n        // ----------------------------------------------------------------\n        // Pipelines\n        // ----------------------------------------------------------------\n        private _buildSimplePipeline(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n        ): void {\n            const width = Math.max(Math.floor(camera.window.width), 1);\n            const height = Math.max(Math.floor(camera.window.height), 1);\n            const colorName = this._cameraConfigs.colorName;\n            const depthStencilName = this._cameraConfigs.depthStencilName;\n\n            const viewport = camera.viewport;  // Reduce C++/TS interop\n            this._viewport.left = Math.round(viewport.x * width);\n            this._viewport.top = Math.round(viewport.y * height);\n            // Here we must use camera.viewport.width instead of camera.viewport.z, which\n            // is undefined on native platform. The same as camera.viewport.height.\n            this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\n            this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\n\n            const clearColor = camera.clearColor;  // Reduce C++/TS interop\n            this._clearColor.x = clearColor.x;\n            this._clearColor.y = clearColor.y;\n            this._clearColor.z = clearColor.z;\n            this._clearColor.w = clearColor.w;\n\n            const pass = ppl.addRenderPass(width, height, 'default');\n\n            // bind output render target\n            if (forwardNeedClearColor(camera)) {\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColor);\n            } else {\n                pass.addRenderTarget(colorName, LoadOp.LOAD, StoreOp.STORE);\n            }\n\n            // bind depth stencil buffer\n            if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n                pass.addDepthStencil(\n                    depthStencilName,\n                    LoadOp.CLEAR,\n                    StoreOp.DISCARD,\n                    camera.clearDepth,\n                    camera.clearStencil,\n                    camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n                );\n            } else {\n                pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\n            }\n\n            pass.setViewport(this._viewport);\n\n            // The opaque queue is used for Reflection probe preview\n            pass.addQueue(QueueHint.OPAQUE)\n                .addScene(camera, SceneFlags.OPAQUE);\n\n            // The blend queue is used for UI and Gizmos\n            let flags = SceneFlags.BLEND | SceneFlags.UI;\n            if (this._cameraConfigs.enableProfiler) {\n                flags |= SceneFlags.PROFILER;\n                pass.showStatistics = true;\n            }\n            pass.addQueue(QueueHint.BLEND)\n                .addScene(camera, flags);\n        }\n\n        private _buildForwardPipeline(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n            scene: renderer.RenderScene,\n            passBuilders: rendering.PipelinePassBuilder[],\n        ): void {\n            sortPipelinePassBuildersByRenderOrder(passBuilders);\n\n            const context: PipelineContext = {\n                colorName: '',\n                depthStencilName: '',\n            };\n\n            let lastPass: rendering.BasicRenderPassBuilder | undefined = undefined;\n\n            for (const builder of passBuilders) {\n                if (builder.setup) {\n                    lastPass = builder.setup(ppl, this._configs, this._cameraConfigs,\n                        camera, context, lastPass);\n                }\n            }\n\n            assert(this._cameraConfigs.remainingPasses === 0);\n        }\n\n        private _initMaterials(ppl: rendering.BasicPipeline): number {\n            if (this._initialized) {\n                return 0;\n            }\n\n            setupPipelineConfigs(ppl, this._configs);\n\n            // When add new effect asset, please add its uuid to the dependentAssets in cc.config.json.\n            this._copyAndTonemapMaterial._uuid = `builtin-pipeline-tone-mapping-material`;\n            this._copyAndTonemapMaterial.initialize({ effectName: 'pipeline/post-process/tone-mapping' });\n\n            if (this._copyAndTonemapMaterial.effectAsset) {\n                this._initialized = true;\n            }\n\n            return this._initialized ? 0 : 1;\n        }\n    }\n\n    rendering.setCustomPipeline('Builtin', new BuiltinPipelineBuilder());\n\n} // if (rendering)\n"]}