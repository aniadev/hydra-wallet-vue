{"version":3,"sources":["../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/AudioControl.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/Avatar.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/utils/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/utils/backgroundRunner.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/base.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/buttons/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/buttons/BaseButton.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/modals/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/modals/BaseModal.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/constants/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/constants/chain.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/chat/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/chat/ChatManager.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/choice.type.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/ChoiceBtnScript.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/ChoiceFrame.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/constants/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/constants/config.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/CountdownController.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/currency.type.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/game.type.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/GamePlayManager.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/index.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/game-apis/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/game-apis/index.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/lobby.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/Lobby.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/LobbyItem.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/prefabs/MessageItem.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/lobby/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/lobby/ModalInputPassword.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/ModalReconnect.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/ModalResult.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/Navigation.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/web-interaction/player.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/Player.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/PlayerManager.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/PrimaryBtn.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/buttons/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/buttons/PrimaryButton.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/request-factory.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/ResultCard.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/gameplay/RoundResultController.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/buttons/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/UI/buttons/SecondaryButton.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/constants/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/constants/socket-client.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/types/socket-client.type.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/core/StartScene.ts","../file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/utils/file:/Users/macbookpro/Rock-Paper-Scissors/assets/Scripts/common/utils/useFormat.ts"],"names":["ccclass","_decorator","property","_dec","_dec2","type","AudioClip","tooltip","_dec3","AudioSource","_descriptor","_applyDecoratedDescriptor","_class2","_Component","AudioControl","_this","_len","arguments","length","args","Array","_key","call","apply","concat","_initializerDefineProperty","_assertThisInitialized","_descriptor2","_inheritsLoose","_proto","prototype","onAudioQueue","index","clip","this","clips","audioSource","playOneShot","onAudioLoop","loop","play","onAudioStop","stop","Component","configurable","enumerable","writable","initializer","_class","_RF","pop","SpriteFrame","_dec4","Sprite","Avatar","_descriptor3","start","update","deltaTime","setAvatar","avatarUrl","_this2","console","log","assetManager","loadRemote","err","imageAsset","error","avatarSprite","spriteFrame","texture","Texture2D","image","defaultAvatarSprite","BackgroundRunner","enableBackgroundRunning","updateCallback","isRunning","game","pause","resume","director","getScheduler","resumeTarget","lastTime","performance","now","updateInterval","window","setInterval","currentTime","dt","Math","min","addEventListener","disableBackgroundRunning","clearInterval","removeEventListener","BaseInteraction","options","emitter","mitt","eventName","onMessage","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","emit","data","_createClass","key","get","Label","Button","group","_dec5","_dec6","_dec7","_dec8","_dec9","BaseButton","_descriptor4","_descriptor5","_descriptor6","_descriptor7","_descriptor8","node","on","Node","EventType","TOUCH_MOVE","interactable","label","color","hoveredColor","TOUCH_END","pressedColor","button","set","value","defaultColor","outlineColor","defaultOutlineColor","disabledColor","disabledOutlineColor","Color","BaseModal","configs","isVisible","_configs","_this$_configs","_this$_configs2","_this$_configs3","buttonClose","showCloseButton","active","hide","overlay","showOverlay","show","_this$_configs4","content","scale","math","v3","self","tween","to","easing","onComplete","target","name","symbol","symbolName","decimals","native","network","networkId","EditBox","ScrollView","Prefab","ChatManager","onLoad","onEnable","_this$chatSendButton","_this$chatInput","chatSendButton","onClickSendButton","chatInput","TEXT_CHANGED","onInputChat","scrollView","removeAllChildren","onDisable","_this$chatSendButton2","_this$chatInput2","off","_this$chatInput3","string","clearInput","_this$chatInput4","addMessage","title","_messageItem$getCompo","messageItem","instantiate","messageItemPrefab","getComponent","MessageItem","setMessage","addChild","Choice","ChoiceBtnScript","isSelected","_interactable","_onClickCallback","_this$button","_this$button2","_this$button3","effectNode","MOUSE_ENTER","MOUSE_LEAVE","setSelected","audioControl","onClick","cb","max","ChoiceFrame","showChoice","choice","isDisabled","sprite","choiceMapper","disabled","enabled","_ref","None","Rock","enabledChoiceSpriteFrames","disabledChoiceSpriteFrames","Paper","Scissors","baseApiUrl","socketioWsUrl","CountdownController","_digitSlots","_isRunning","_startTime","_duration","_timer","_emitter","_onFinishCb","digitSlot1","digitSlot2","digitSlot3","setTime","all","clear","num","updateDisplay","startCoundown","onfinish","schedule","updateTimer","stopCountdown","unschedule","_this$_onFinishCb","elapsed","remainingTime","floor","timeStr","abs","toFixed","toString","countdownText","padStart","i","digit","parseInt","numberNode","getComponentInChildren","digitFrames","onFinish","getCurrentTime","CurrencyBalance","currency","amount","chain","CHAIN","toAda","withSymbol","BigNumber","dividedBy","pow","toFormat","multipliedBy","usdPrice","GameState","PrimaryBtn","Navigation","ModalReconnect","_dec10","_dec11","_dec12","RoundResultController","_dec13","Player","_dec14","GamePlayManager","_this$choiceMapper","_descriptor9","_descriptor10","_descriptor11","_descriptor12","_descriptor13","_gameState","rockBtnNode","paperBtnNode","scissorsBtnNode","socketRoom","currentRoom","currentGame","selectedChoice","readyWatcher","_this$roundResultCont","_this$currentGame","sys","localStorage","getItem","JSON","parse","primaryBtn","onClickPrimaryBtn","initChoiceBtn","roundResultController","gameState","WaitingForPlayers","nav","loadScene","socketClient","roomId","id","action","WaitingForNextRound","pushSystemNoti","chatManager","message","gameRoomId","initPlayerData","updatePlayerData","players","listen","_this2$modalReconnect","modalReconnect","payload","_this2$modalReconnect2","handleSocketEventRoomAction","handleSocketEventGame","handleSocketEventGameStateChange","handleSocketEventGameChat","onDestroy","removeAllListeners","userInfo","playerA","initData","setUserBalance","coin","coinSymbol","playerB","find","user","walletAddress","alias","avatar","_this$getChoiceBtn","_this$getChoiceBtn2","_this$getChoiceBtn3","_this3","getChoiceBtn","onClickChoice","setChoiceBtnInteractive","rockI","paperI","scissorsI","setChoiceBtnSelected","_ref2","setChoice","encryptedChoice","hashedChoice","txId","handleGameStateChange","_this4","table","isReady","WaitingForChoices","hasMadeChoice","setType","countdownController","roundTimeoutMs","onCountdownFinished","CommittingChoices","RevealingChoices","salt","formatString","WaitingForPayout","isRevealed","ShowRoundResult","result","betUnit","betAmount","status","Number","betUnitSymbol","reset","warn","waitAllPlayersReady","checkReadyStatus","_this$chatManager","users","setItem","stringify","_payload$data","state","oldState","currentRound","_this$chatManager2","_payload$data2","from","timestamp","_this5","forEach","player","ready","commit","reveal","_player$reveal","_player$reveal2","GameInteraction","getInstance","lobby","instance","PlayerInteractionImpl","LobbyInteractionImpl","isBrowser","GameApiNsp","_GameApiNsp","GameApi","functions","windowInstance","setFunc","fn","Error","_this$functions","request","_temp","_ref$args","_ref$timeout","timeout","Promise","resolve","reject","protocol","fncName","parent","postMessage","event","_event$data","setTimeout","response","_BaseInteraction","createLobby","joinLobby","setLobbyItems","items","renderLobbyList","setLoading","isLoading","RichText","PlayerManager","ModalInputPassword","Lobby","lobbyItems","lobbyInteraction","_this$lobbyCreateBtn","_this$lobbyTestBtn","_this$lobbyTabBtn","lobbyCreateBtn","lobbyTestBtn","onClickTestBtn","lobbyTabBtn","onClickLobbyTabBtn","_onLoad","RequestFactory","getLobbyList","then","res","_res$data","connected","setAuth","connect","fetchUserInfo","_this$playerManager","playerManager","setUserInfo","_this3$playerManager","onCickJoinLobby","roomData","_this$modalInputPassw","requiredPassword","modalInputPassword","password","handleJoinLobby","_this4$modalInputPass","_this4$modalInputPass2","_this4$modalInputPass3","_this4$modalInputPass4","once","_this4$modalInputPass5","_handleJoinLobby","_callee2","_context2","code","abrupt","room","_x","_x2","lobbyScrollView","lobbyItemPrefab","itemNum","lobbyItem","row","col","setPosition","initLobbyItem","contentHeight","ceil","UITransform","setContentSize","Size","width","setVisibleLobbyList","lobbyItemScript","LobbyItem","loadingText","joinButton","onClickJoinButton","lockedIcon","lobbyShowedName","customName","betAmountText","lobbyBetAmountText","messageTitle","messageContent","PrimaryButton","SecondaryButton","_BaseModal","_this$confirmButton","_this$cancelButton","_this$passwordEditbox","confirmButton","onClickConfirmBtn","_this2$passwordEditbo","passwordEditbox","focus","cancelButton","onClickCancelBtn","onInputPassword","_this$passwordEditbox2","_this$passwordEditbox3","_this$reloadButton","reloadButton","onClickReloadBtn","location","reload","ModalResult","_this$replayButton","replayButton","onClickReplayBtn","navBackBtn","onClickBackBtn","updateRoomData","roomCodeText","x","createdAt","_this$avatar","usernameText","readyLabel","coinAmountText","genSalt","jsSha256","sha256","hmac","makeRandomChoice","random","substring","playerAvatar","onClickAvatar","username","formatAddress","begin","last","splitBy","userCoin","_type","UIOpacity","opacity","isActive","_this$node$getCompone","_this$label$getCompon","_this$node$getCompone2","_this$label$getCompon2","Animation","grayscale","ringNode","_BaseButton","$fetch","url","token","fetch","_extends","headers","Authorization","json","body","method","fetchUserBalance","depositBalance","requestAuthorization","_requestAuthorization","rs","gameApi","sent","ResultCard","messageText","init","_this$choiceFrame","_this$avatarNode","choiceFrame","avatarNode","WIN","LOSE","DRAW","_this$modalResult","modalResult","_this$cardPlayerA","_this$cardPlayerB","playerAChoiceFrame","playerBChoiceFrame","showStatus","betAmountMsg","msgA","toLowerCase","msgB","cardPlayerA","cardPlayerB","statusNode","winSpriteFrame","drawSpriteFrame","loseSpriteFrame","SocketClient","socket","io","transports","autoConnect","emitEvent","EmitEvents","listenEvent","callback","ListenEvents","removeListener","listenOnce","auth","disconnect","SOCKET_EMIT_EVENTS","SOCKET_LISTEN_EVENTS","ROOM_ACTION","GAME","GAME_CHAT","CONNECT","DISCONNECT","GAME_STATE_CHANGED","MESSAGE","ProgressBar","Toggle","StartScene","isAuthenticated","_this$startGameBtn","_this$agreeTermToggle","startGameBtn","initGame","agreeTermToggle","onClickAgreeTerm","isEnableStartBtn","_this$agreeTermToggle2","isChecked","add","preloadAllAssets","accessToken","_this2$modalInfo","_this2$retryBtn","removeItem","modalInfo","retryBtn","_this$agreeTermToggle3","loadingBar","progress","loadingLabel","resources","loadDir","loadedAssets","totalAssets","assets","_this3$loadingLabel$g","_this$agreeTermToggle4","_this$loadingBar","address","_options","_options$begin","_options$last","_options$splitBy","before","after","str"],"mappings":"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","file":"all.js","sourcesContent":["import { _decorator, AudioClip, AudioSource, Component, Node } from 'cc'\nconst { ccclass, property } = _decorator\n\n@ccclass('AudioControl')\nexport class AudioControl extends Component {\n\t@property({\n\t\ttype: [AudioClip],\n\t\ttooltip: 'place audio clip here',\n\t})\n\tpublic clips: AudioClip[] = []\n\n\t@property({\n\t\ttype: AudioSource,\n\t\ttooltip: 'place audio node here',\n\t})\n\tpublic audioSource: AudioSource = null!\n\n\t//place correct audio clip in the audio player and play the audio\n\tonAudioQueue(index: number) {\n\t\t//place audio clip into the the player\n\t\tlet clip: AudioClip = this.clips[index]\n\n\t\t//play the audio just once\n\t\tthis.audioSource.playOneShot(clip)\n\t}\n\n\tonAudioLoop(index: number) {\n\t\t//place audio clip into the the player\n\t\tlet clip: AudioClip = this.clips[index]\n\n\t\t//play the audio loop\n\t\tthis.audioSource.clip = clip\n\t\tthis.audioSource.loop = true\n\t\tthis.audioSource.play()\n\t}\n\n\tonAudioStop() {\n\t\t//stop the audio\n\t\tthis.audioSource.stop()\n\t}\n}\n","import {\n\t_decorator,\n\tassetManager,\n\tComponent,\n\tImageAsset,\n\tNode,\n\tSprite,\n\tSpriteFrame,\n\tTexture2D,\n} from 'cc'\nconst { ccclass, property } = _decorator\n\n@ccclass('Avatar')\nexport class Avatar extends Component {\n\t@property(SpriteFrame)\n\tborderSprite: SpriteFrame | null = null\n\n\t@property(SpriteFrame)\n\tdefaultAvatarSprite: SpriteFrame | null = null\n\n\t@property(Sprite)\n\tavatarSprite: Sprite | null = null\n\n\tstart() {}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic setAvatar(avatarUrl: string): void {\n\t\tconsole.log('Set avatar', avatarUrl)\n\t\tif (!avatarUrl || avatarUrl === '') {\n\t\t\tthis.avatarSprite.spriteFrame = this.defaultAvatarSprite\n\t\t\treturn\n\t\t}\n\t\tassetManager.loadRemote(avatarUrl, (err, imageAsset) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error('Lỗi khi tải avatar:', err)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (this.avatarSprite) {\n\t\t\t\tconst spriteFrame = new SpriteFrame()\n\t\t\t\tconst texture = new Texture2D()\n\t\t\t\ttexture.image = imageAsset as ImageAsset\n\t\t\t\tspriteFrame.texture = texture\n\t\t\t\tthis.avatarSprite.spriteFrame = spriteFrame\n\t\t\t}\n\t\t})\n\t}\n}\n","import { director, game } from 'cc'\n\nexport class BackgroundRunner {\n\tprivate static isRunning: boolean = false\n\tprivate static updateInterval: number = null\n\tprivate static lastTime: number = 0\n\tprivate static updateCallback: (dt: number) => void = null\n\n\t// Khởi tạo chạy nền\n\tpublic static enableBackgroundRunning(updateCallback: (dt: number) => void): void {\n\t\tif (this.isRunning) return\n\n\t\tthis.isRunning = true\n\t\tthis.updateCallback = updateCallback\n\n\t\t// Ghi đè hành vi tạm dừng của Cocos2d-js\n\t\tgame.pause = () => {\n\t\t\tconsole.log('Game pause prevented')\n\t\t}\n\t\tgame.resume = () => {\n\t\t\tconsole.log('Game resume triggered')\n\t\t\t// Đảm bảo scheduler được kích hoạt lại\n\t\t\tdirector.getScheduler().resumeTarget(director.getScheduler())\n\t\t}\n\n\t\t// Sử dụng performance.now() để tính thời gian chính xác hơn\n\t\tthis.lastTime = performance.now()\n\t\tthis.updateInterval = window.setInterval(() => {\n\t\t\tconst currentTime = performance.now()\n\t\t\tconst dt = Math.min((currentTime - this.lastTime) / 1000, 0.1) // Giới hạn dt để tránh nhảy thời gian lớn\n\t\t\tthis.lastTime = currentTime\n\n\t\t\tif (this.updateCallback) {\n\t\t\t\tthis.updateCallback(dt)\n\t\t\t}\n\t\t}, 1000 / 60) // 60 FPS\n\n\t\t// Xử lý sự kiện focus/blur\n\t\twindow.addEventListener('focus', () => {\n\t\t\tconsole.log('Tab focused, syncing time')\n\t\t\tthis.lastTime = performance.now() // Đồng bộ thời gian khi focus lại\n\t\t\tgame.resume()\n\t\t})\n\n\t\twindow.addEventListener('blur', () => {\n\t\t\tconsole.log('Tab blurred, keeping game running')\n\t\t})\n\t}\n\n\t// Tắt chạy nền\n\tpublic static disableBackgroundRunning(): void {\n\t\tif (!this.isRunning) return\n\n\t\tthis.isRunning = false\n\t\tif (this.updateInterval) {\n\t\t\twindow.clearInterval(this.updateInterval)\n\t\t\tthis.updateInterval = null\n\t\t}\n\t\tthis.updateCallback = null\n\n\t\t// Khôi phục hành vi mặc định\n\t\tgame.pause = () => director.pause()\n\t\tgame.resume = () => director.resume()\n\n\t\twindow.removeEventListener('focus', () => {})\n\t\twindow.removeEventListener('blur', () => {})\n\t}\n}\n","import mitt from 'mitt'\n\ntype Options = {\n\teventName?: string\n\tcustomEmitter?: ReturnType<typeof mitt>\n}\n\nexport type BaseEventDataType = {\n\ttype: string\n\tdata?: unknown\n}\n\nexport class BaseInteraction {\n\tpublic emitter = mitt()\n\tpublic options: Options = {\n\t\teventName: 'game-interaction',\n\t}\n\tpublic onMessage: (data: BaseEventDataType) => unknown | Promise<unknown> = async () => {}\n\tconstructor(options?: Options) {\n\t\tthis.options = options ?? this.options\n\t}\n\tget eventName() {\n\t\treturn this.options.eventName\n\t}\n\tpublic emit(data: BaseEventDataType) {\n\t\tthis.emitter.emit(this.eventName, data)\n\t}\n}\n","import { _decorator, Button, Color, Component, Label, Node } from 'cc'\nconst { ccclass, property } = _decorator\n\n@ccclass('BaseButton')\nexport class BaseButton extends Component {\n\t@property(Label)\n\tlabel: Label | null = null\n\n\t@property(Button)\n\tbutton: Button | null = null\n\n\t@property({\n\t\ttooltip: 'default text color',\n\t\tgroup: `Label's color`,\n\t})\n\tdefaultColor: Color = new Color('#256605')\n\t@property({\n\t\ttooltip: 'disabled text color',\n\t\tgroup: `Label's color`,\n\t})\n\tdisabledColor: Color = new Color('#999999')\n\t@property({\n\t\ttooltip: 'hovered text color',\n\t\tgroup: `Label's color`,\n\t})\n\thoveredColor: Color = new Color('#499722')\n\t@property({\n\t\ttooltip: 'pressed text color',\n\t\tgroup: `Label's color`,\n\t})\n\tpressedColor: Color = new Color('#499722')\n\t@property({\n\t\ttooltip: 'default outline color',\n\t\tgroup: `Label's outline color`,\n\t})\n\tdefaultOutlineColor: Color = new Color('#499722')\n\t@property({\n\t\ttooltip: 'disabled outline color',\n\t\tgroup: `Label's outline color`,\n\t})\n\tdisabledOutlineColor: Color = new Color('#999999')\n\n\tstart() {\n\t\tthis.node.on(\n\t\t\tNode.EventType.TOUCH_MOVE,\n\t\t\t() => {\n\t\t\t\tif (this.interactable) {\n\t\t\t\t\tthis.label.color = this.hoveredColor\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis\n\t\t)\n\t\tthis.node.on(\n\t\t\tNode.EventType.TOUCH_END,\n\t\t\t() => {\n\t\t\t\tif (this.interactable) {\n\t\t\t\t\tthis.label.color = this.pressedColor\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis\n\t\t)\n\t\tthis.interactable = this.button.interactable\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic set interactable(value: boolean) {\n\t\tif (value) {\n\t\t\tthis.button.interactable = true\n\t\t\tthis.label.color = this.defaultColor\n\t\t\tthis.label.outlineColor = this.defaultOutlineColor\n\t\t} else {\n\t\t\tthis.button.interactable = false\n\t\t\tthis.label.color = this.disabledColor\n\t\t\tthis.label.outlineColor = this.disabledOutlineColor\n\t\t}\n\t}\n\tpublic get interactable() {\n\t\treturn this.button.interactable\n\t}\n}\n","import { _decorator, Button, Component, math, Node, tween } from 'cc'\nconst { ccclass, property } = _decorator\n\ntype ModalConfig = {\n\t/**\n\t * @default false\n\t */\n\tshowCloseButton?: boolean\n\n\t/**\n\t * @default false\n\t */\n\tshowOverlay?: boolean\n}\n\n@ccclass('BaseModal')\nexport class BaseModal extends Component {\n\t@property(Button)\n\tbuttonClose: Button | null = null\n\n\t@property(Node)\n\toverlay: Node | null = null\n\n\t@property(Node)\n\tcontent: Node | null = null\n\n\tprotected isVisible: boolean = false\n\tprotected _configs: ModalConfig = {}\n\n\tconstructor(configs?: ModalConfig) {\n\t\tsuper()\n\t\tthis._configs = configs\n\t}\n\n\tstart() {\n\t\tconsole.log('BaseModal start', this._configs, this.buttonClose)\n\n\t\tif (this.buttonClose) {\n\t\t\tthis.buttonClose.interactable = !!this._configs?.showCloseButton\n\t\t\tthis.buttonClose.node.active = !!this._configs?.showCloseButton\n\t\t\tthis.buttonClose.node.on(\n\t\t\t\tNode.EventType.TOUCH_END,\n\t\t\t\t() => {\n\t\t\t\t\tthis.hide()\n\t\t\t\t},\n\t\t\t\tthis\n\t\t\t)\n\t\t}\n\t\tif (this.overlay) {\n\t\t\tthis.overlay.active = !!this._configs?.showOverlay\n\t\t}\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic show(): void {\n\t\tthis.node.active = true\n\t\tthis.overlay.active = !!this._configs?.showOverlay\n\t\tthis.content.scale = math.v3(0, 0, 0)\n\t\tconst self = this\n\t\ttween(this.content)\n\t\t\t.to(\n\t\t\t\t0.35,\n\t\t\t\t{ scale: math.v3(1, 1, 1) },\n\t\t\t\t{\n\t\t\t\t\teasing: 'cubicInOut',\n\t\t\t\t\tonComplete(target) {\n\t\t\t\t\t\tself.isVisible = true\n\t\t\t\t\t\tself.node.emit('open')\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t)\n\t\t\t.start()\n\t}\n\n\tpublic hide(): void {\n\t\tconst self = this\n\t\tthis.overlay.active = false\n\t\tthis.content.scale = math.v3(1, 1, 1)\n\t\ttween(this.content)\n\t\t\t.to(\n\t\t\t\t0.35,\n\t\t\t\t{ scale: math.v3(0, 0, 0) },\n\t\t\t\t{\n\t\t\t\t\teasing: 'cubicInOut',\n\t\t\t\t\tonComplete(target) {\n\t\t\t\t\t\tself.node.active = false\n\t\t\t\t\t\tself.isVisible = false\n\t\t\t\t\t\tself.node.emit('close')\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t)\n\t\t\t.start()\n\t}\n\n\tpublic get visible() {\n\t\treturn this.isVisible\n\t}\n}\n","export const CHAIN = {\n\tname: 'cardano',\n\tsymbol: 't₳',\n\tsymbolName: 'tADA',\n\tdecimals: 6,\n\tnative: 'lovelace',\n\tnetwork: 'testnet preprod',\n\tnetworkId: 1,\n}\n","import { _decorator, Button, Component, EditBox, instantiate, Node, Prefab, ScrollView } from 'cc'\nimport { MessageItem } from '../prefabs/MessageItem'\nconst { ccclass, property } = _decorator\n\n@ccclass('ChatManager')\nexport class ChatManager extends Component {\n\t@property(EditBox)\n\tchatInput: EditBox | null = null\n\n\t@property(Button)\n\tchatSendButton: Button | null = null\n\n\t@property(ScrollView)\n\tscrollView: ScrollView | null = null\n\n\t@property(Prefab)\n\tmessageItemPrefab: Prefab | null = null\n\n\tstart() {}\n\n\tupdate(deltaTime: number) {}\n\n\tprotected onLoad(): void {\n\t\t//\n\t}\n\n\tprotected onEnable(): void {\n\t\tthis.chatSendButton?.node?.on(Node.EventType.TOUCH_END, this.onClickSendButton, this)\n\t\tthis.chatInput?.node?.on(EditBox.EventType.TEXT_CHANGED, this.onInputChat, this)\n\n\t\tthis.scrollView.content.removeAllChildren()\n\t}\n\n\tprotected onDisable(): void {\n\t\tthis.chatSendButton?.node?.off(Node.EventType.TOUCH_END, this.onClickSendButton, this)\n\t\tthis.chatInput?.node?.off(EditBox.EventType.TEXT_CHANGED, this.onInputChat, this)\n\t}\n\n\tprotected onClickSendButton(): void {\n\t\tif (!this.chatInput?.string) return\n\t\tthis.node.emit('send-message', this.chatInput.string)\n\t\tthis.clearInput()\n\t}\n\n\tpublic clearInput() {\n\t\tthis.chatInput.string = ''\n\t\tthis.chatSendButton.interactable = false\n\t}\n\n\tprotected onInputChat(): void {\n\t\tif (!this.chatInput?.string) {\n\t\t\tthis.chatSendButton.interactable = false\n\t\t} else {\n\t\t\tthis.chatSendButton.interactable = true\n\t\t}\n\t}\n\n\tpublic addMessage(title: string, content: string) {\n\t\tconst messageItem = instantiate(this.messageItemPrefab)\n\t\tmessageItem.getComponent(MessageItem)?.setMessage(title, content)\n\t\tthis.scrollView.content.addChild(messageItem)\n\t}\n}\n","export enum Choice {\n\tNone = 'NONE',\n\tRock = 'ROCK',\n\tPaper = 'PAPER',\n\tScissors = 'SCISSORS',\n}\n","import { _decorator, Button, Component, math, Node, tween } from 'cc'\nimport { AudioControl } from '../AudioControl'\nconst { ccclass, property } = _decorator\n\n@ccclass('ChoiceBtnScript')\nexport class ChoiceBtnScript extends Component {\n\t@property(Button)\n\tbutton: Button | null = null\n\n\t@property(Node)\n\teffectNode: Node | null = null\n\t@property({\n\t\ttype: AudioControl,\n\t\ttooltip: 'add audio controller',\n\t})\n\tpublic audioControl: AudioControl\n\n\tisSelected: boolean = false\n\tprivate _interactable: boolean = true\n\tprivate _onClickCallback: () => void\n\n\tstart() {}\n\n\tonLoad() {\n\t\tconsole.log('onLoad ')\n\t}\n\n\tprotected onEnable(): void {\n\t\tif (!this.effectNode) return\n\t\tthis.effectNode.active = this.isSelected\n\n\t\tthis.button?.node?.on(Node.EventType.TOUCH_END, this._onClickCallback, this)\n\t\tthis.button?.node?.on(\n\t\t\tNode.EventType.MOUSE_ENTER,\n\t\t\t() => {\n\t\t\t\t// this.button.node.setScale(1.1, 1.1, 1)\n\t\t\t\ttween(this.button.node)\n\t\t\t\t\t.to(0.1, { scale: math.v3(1.1, 1.1, 1.1) })\n\t\t\t\t\t.start()\n\t\t\t},\n\t\t\tthis\n\t\t)\n\t\tthis.button?.node?.on(\n\t\t\tNode.EventType.MOUSE_LEAVE,\n\t\t\t() => {\n\t\t\t\ttween(this.button.node)\n\t\t\t\t\t.to(0.1, { scale: math.v3(1, 1, 1) })\n\t\t\t\t\t.start()\n\t\t\t},\n\t\t\tthis\n\t\t)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic setSelected(value: boolean) {\n\t\tthis.isSelected = value\n\t\tif (!this.effectNode) return\n\t\tthis.effectNode.active = this.isSelected\n\t\tif (this.isSelected) {\n\t\t\tthis.audioControl.onAudioQueue(3) // swoosh\n\t\t}\n\t}\n\n\tonClick(cb: () => void) {\n\t\tthis._onClickCallback = cb\n\t}\n\n\tpublic set interactable(value: boolean) {\n\t\tthis._interactable = value\n\t\tif (!this.button) return\n\t\tthis.button.interactable = value\n\t}\n\tpublic get interactable() {\n\t\treturn this._interactable\n\t}\n}\n","import { _decorator, Component, Node, Sprite, SpriteFrame } from 'cc'\nimport { Choice } from '../../common/types/choice.type'\nconst { ccclass, property } = _decorator\n\n@ccclass('ChoiceFrame')\nexport class ChoiceFrame extends Component {\n\t@property({\n\t\ttype: [SpriteFrame],\n\t\ttooltip: 'add sprite frames: [rock, paper, scissors]',\n\t\tmax: 3,\n\t\tmin: 3,\n\t})\n\tenabledChoiceSpriteFrames: SpriteFrame[] = []\n\n\t@property({\n\t\ttype: [SpriteFrame],\n\t\ttooltip: 'add disabled sprite frames: [rock, paper, scissors]',\n\t\tmax: 3,\n\t\tmin: 3,\n\t})\n\tdisabledChoiceSpriteFrames: SpriteFrame[] = []\n\n\tget choiceMapper(): Record<\n\t\tChoice,\n\t\t{ enabled: SpriteFrame | null; disabled: SpriteFrame | null }\n\t> {\n\t\treturn {\n\t\t\t[Choice.None]: {\n\t\t\t\tenabled: null,\n\t\t\t\tdisabled: null,\n\t\t\t},\n\t\t\t[Choice.Rock]: {\n\t\t\t\tenabled: this.enabledChoiceSpriteFrames[0],\n\t\t\t\tdisabled: this.disabledChoiceSpriteFrames[0],\n\t\t\t},\n\t\t\t[Choice.Paper]: {\n\t\t\t\tenabled: this.enabledChoiceSpriteFrames[1],\n\t\t\t\tdisabled: this.disabledChoiceSpriteFrames[1],\n\t\t\t},\n\t\t\t[Choice.Scissors]: {\n\t\t\t\tenabled: this.enabledChoiceSpriteFrames[2],\n\t\t\t\tdisabled: this.disabledChoiceSpriteFrames[2],\n\t\t\t},\n\t\t}\n\t}\n\n\tonEnable() {}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic showChoice(choice: Choice, isDisabled: boolean = false) {\n\t\tif (!this.node) return\n\t\tconst sprite = this.node.getComponent(Sprite)\n\t\tif (!sprite) return\n\t\tsprite.spriteFrame = isDisabled\n\t\t\t? this.choiceMapper[choice].disabled\n\t\t\t: this.choiceMapper[choice].enabled\n\t}\n}\n","const configs = {\n\tbaseApiUrl: 'https://rps-api.hexcore.io.vn',\n\tsocketioWsUrl: 'wss://rps-api.hexcore.io.vn/game',\n}\n\nexport default configs\n","import { _decorator, Component, Node, Prefab, resources, Sprite, SpriteFrame } from 'cc'\nconst { ccclass, property } = _decorator\n\nimport { default as mitt } from 'mitt'\nimport { AudioControl } from './AudioControl'\n\n@ccclass('CountdownController')\nexport class CountdownController extends Component {\n\t@property(Node)\n\tNumberLayout: Node | null = null\n\n\t@property(Prefab)\n\tnumberPrefab: Prefab | null = null\n\n\t@property([SpriteFrame])\n\tdigitFrames: SpriteFrame[] = [] // Gán 10 sprite frame (0-9) trong editor\n\n\t@property(Node)\n\tdigitSlot1: Node | null = null\n\t@property(Node)\n\tdigitSlot2: Node | null = null\n\t@property(Node)\n\tdigitSlot3: Node | null = null\n\n\t@property({\n\t\ttype: AudioControl,\n\t\ttooltip: 'add audio controller',\n\t})\n\tpublic clip: AudioControl\n\n\tprivate _digitSlots: Node[] = []\n\tprivate _isRunning: boolean = false\n\tprivate _startTime: number = performance.now() // milliseconds\n\tprivate _duration: number = 30 // Thời gian đếm ngược ban đầu: seconds\n\tprivate _timer: any = null // Biến đếm thời gian\n\tprivate _emitter = mitt()\n\tprivate _onFinishCb: () => void\n\n\tstart() {}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic show() {\n\t\tthis.node.active = true\n\t}\n\n\tpublic hide() {\n\t\tthis.node.active = false\n\t}\n\n\tprotected onEnable(): void {\n\t\tconsole.log('onEnabled')\n\t\tthis._digitSlots = [this.digitSlot1, this.digitSlot2, this.digitSlot3]\n\t\tthis.setTime(30) // Set default time to 30s\n\t}\n\n\tprotected onDisable(): void {\n\t\tthis._emitter.all.clear()\n\t}\n\n\tpublic setTime(num: number) {\n\t\tif (num > 999) {\n\t\t\tconsole.log('Time is too long, max is 999')\n\t\t\treturn\n\t\t}\n\t\tthis._startTime = performance.now()\n\t\tthis._duration = num\n\t\tthis.updateDisplay()\n\t}\n\n\tpublic startCoundown(onfinish?: () => void) {\n\t\tif (!this._isRunning) {\n\t\t\tthis._isRunning = true\n\t\t\tthis.clip.onAudioLoop(4) // loop tictac\n\t\t\tthis._startTime = performance.now()\n\t\t\tthis.schedule(this.updateTimer, 0.1) // Cập nhật mỗi giây\n\t\t\tthis._onFinishCb = onfinish\n\t\t}\n\t}\n\n\tprotected updateTimer(dt: number): void {\n\t\tthis.updateDisplay()\n\t}\n\n\tpublic stopCountdown() {\n\t\tthis._isRunning = false\n\t\tthis.clip.onAudioStop()\n\t\tthis.unschedule(this.updateTimer)\n\t}\n\n\tprotected updateDisplay() {\n\t\tconst elapsed = (performance.now() - this._startTime) / 1000\n\t\tconst remainingTime = Math.max(0, Math.floor(this._duration - elapsed))\n\t\tconst timeStr = Math.abs(remainingTime).toFixed(0).toString()\n\t\tlet countdownText = ''\n\n\t\tif (this._duration < 100) {\n\t\t\tcountdownText = timeStr.padStart(2, '0')\n\t\t\tthis.digitSlot3.active = false\n\t\t} else {\n\t\t\tcountdownText = timeStr.padStart(3, '0')\n\t\t\tthis.digitSlot3.active = true\n\t\t}\n\t\tfor (let i = 0; i < countdownText.length; i++) {\n\t\t\tconst digit = parseInt(countdownText[i])\n\t\t\tconst numberNode = this._digitSlots[i]\n\t\t\tif (numberNode) {\n\t\t\t\tconst sprite = numberNode.getComponentInChildren(Sprite)\n\t\t\t\tif (sprite) {\n\t\t\t\t\tsprite.spriteFrame = this.digitFrames[digit]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (remainingTime <= 0) {\n\t\t\tthis.stopCountdown()\n\t\t\tthis._emitter.emit('countdown', { type: 'onCountdownEnd' })\n\t\t\tthis._onFinishCb?.()\n\t\t}\n\t}\n\n\tpublic onFinish(cb: () => void) {\n\t\tthis._onFinishCb = cb\n\t}\n\n\t// Lấy thời gian hiện tại\n\tpublic getCurrentTime(): number {\n\t\tconst elapsed = (performance.now() - this._startTime) / 1000\n\t\treturn Math.max(0, this._duration - elapsed)\n\t}\n}\n","import BigNumber from 'bignumber.js'\n\nimport { CHAIN } from '../constants/chain'\n\nexport type Currency = {\n\tid: number\n\tname: string\n\tsymbol: string\n\tdecimals: number\n\tusdPrice: number\n\tassetName: string | null\n\tpolicyId: string | null\n\tcreatedAt?: string\n\ticon?: string\n}\n\nexport class CurrencyBalance {\n\tchain = CHAIN\n\tconstructor(public currency: Currency, public amount: number | string) {\n\t\tthis.currency = currency\n\t\tthis.amount = amount\n\t}\n\n\tget valueInUsd() {\n\t\treturn BigNumber(this.amount).multipliedBy(this.currency.usdPrice)\n\t}\n\n\ttoAda(withSymbol = false) {\n\t\tlet value = null\n\t\tif (this.currency.symbol === CHAIN.native) {\n\t\t\tvalue = BigNumber(this.amount).dividedBy(1_000_000)\n\t\t} else {\n\t\t\tvalue = BigNumber(this.amount).dividedBy(Math.pow(10, this.currency.decimals))\n\t\t}\n\t\treturn withSymbol ? value.toFormat() + ' ' + CHAIN.symbol : value.toFormat()\n\t}\n}\n","import { Choice } from './choice.type'\n\nexport enum GameState {\n\tWaitingForPlayers = 'WaitingForPlayers',\n\tWaitingForChoices = 'WaitingForChoices',\n\tCommittingChoices = 'CommittingChoices',\n\tRevealingChoices = 'RevealingChoices',\n\tWaitingForPayout = 'WaitingForPayout',\n\tShowRoundResult = 'ShowRoundResult',\n\tWaitingForNextRound = 'WaitingForNextRound',\n}\n\nexport type GamePlayer = {\n\tchoice: Choice | null\n\tscore: number\n\tcommit: {\n\t\tencryptedChoice: string\n\t\ttxId: string\n\t} | null\n\treveal: {\n\t\tchoice: Choice\n\t\tsalt: string\n\t\ttxId: string\n\t} | null\n\tpayout: {\n\t\ttxId: string\n\t\tcborHex: string\n\t} | null\n\tisReady: boolean\n\tid: string // wallet address\n\tname: string // username/alias\n}\n\nexport type SocketGame = {\n\tstate: GameState\n\tplayers: GamePlayer[]\n\tcurrentRound: unknown\n\troundNumber: number\n\tmaxPlayers: number\n\thistory: unknown[]\n\troundTimeoutMs: number\n}\n","import {\n\t_decorator,\n\tButton,\n\tComponent,\n\tdirector,\n\tinstantiate,\n\tNode,\n\tPrefab,\n\tsys,\n\tUIOpacityComponent,\n} from 'cc'\nconst { ccclass, property } = _decorator\n\nimport { default as jsSha256 } from 'js-sha256'\nimport { Choice } from '../common/types/choice.type'\nimport { PrimaryBtn } from './gameplay/PrimaryBtn'\nimport { AudioControl } from './AudioControl'\nimport { ChoiceBtnScript } from './gameplay/ChoiceBtnScript'\nimport { CountdownController } from './CountdownController'\nimport { Navigation } from './gameplay/Navigation'\nimport { RoundResultController } from './gameplay/RoundResultController'\nimport { Player } from './gameplay/Player'\nimport { BackgroundRunner } from '../common/utils/backgroundRunner'\nimport { socketClient } from '../common/constants/socket-client'\nimport { Room } from '../common/types/room.type'\nimport { ModalReconnect } from './ModalReconnect'\nimport { GamePlayer, GameState, SocketGame } from '../common/types/game.type'\nimport {\n\tEmitMessageType,\n\tGameChatResponseMessage,\n\tGameResponseMessage,\n\tGameStateChangedResponseMessage,\n\tRoomActionResponse,\n} from '../common/types/socket-client.type'\nimport { User } from '../common/types/user.type'\nimport { CurrencyBalance } from '../common/types/currency.type'\nimport { ChatManager } from './chat/ChatManager'\nimport { formatString } from '../common/utils/useFormat'\n\n@ccclass('GamePlayManager')\nexport class GamePlayManager extends Component {\n\t@property({\n\t\ttype: PrimaryBtn,\n\t\ttooltip: 'add primary btn',\n\t})\n\tprimaryBtn: PrimaryBtn\n\n\t@property({\n\t\ttype: Navigation,\n\t\ttooltip: 'add navigation',\n\t})\n\tnav: Navigation\n\n\t@property(Node)\n\tuiController: Node | null = null\n\n\t@property(ModalReconnect)\n\tmodalReconnect: ModalReconnect | null = null\n\n\t@property({\n\t\ttype: ChatManager,\n\t\ttooltip: 'add chat manager',\n\t})\n\tchatManager: ChatManager | null = null\n\n\t@property({\n\t\ttype: AudioControl,\n\t\ttooltip: 'add audio controller',\n\t})\n\tpublic clip: AudioControl\n\n\t@property(Node)\n\trockBtnNode: Node | null = null\n\t@property(Node)\n\tpaperBtnNode: Node | null = null\n\t@property(Node)\n\tscissorsBtnNode: Node | null = null\n\n\t@property({\n\t\ttype: CountdownController,\n\t\ttooltip: 'add countdown controller',\n\t})\n\tcountdownController: CountdownController\n\t@property({\n\t\ttype: RoundResultController,\n\t\ttooltip: 'add round result controller',\n\t})\n\troundResultController: RoundResultController | null = null\n\n\t//\n\t@property({\n\t\ttype: Player,\n\t\ttooltip: 'add player A',\n\t})\n\tplayerA: Player\n\t@property({\n\t\ttype: Player,\n\t\ttooltip: 'add player B',\n\t})\n\tplayerB: Player\n\n\tprivate _gameState: GameState\n\tchoiceMapper: Record<Choice, Node> = {\n\t\t[Choice.None]: null,\n\t\t[Choice.Rock]: this.rockBtnNode,\n\t\t[Choice.Paper]: this.paperBtnNode,\n\t\t[Choice.Scissors]: this.scissorsBtnNode,\n\t}\n\tsocketRoom = ''\n\tcurrentRoom: Room | null = null\n\tcurrentGame: SocketGame | null = null\n\tselectedChoice: Choice = Choice.Rock\n\n\tprotected start() {\n\t\tconsole.log('[GamePlayManager][start]')\n\t}\n\tprotected onLoad() {\n\t\tBackgroundRunner.enableBackgroundRunning((dt: number) => {\n\t\t\t// Cập nhật logic game, ví dụ: timer hoặc trạng thái\n\t\t\tdirector.getScheduler().update(dt)\n\t\t})\n\t}\n\n\tprotected onEnable() {\n\t\tconsole.log('[GamePlayManager][onEnable]')\n\t\t// Load data from local storage\n\t\tthis.socketRoom = sys.localStorage.getItem('socket-room') || ''\n\t\tif (!this.socketRoom) {\n\t\t\tconsole.error('Not found socket room in localstorage')\n\t\t\treturn\n\t\t}\n\t\tthis.currentRoom = JSON.parse(sys.localStorage.getItem('currentRoom') || 'null') as Room | null\n\t\tif (!this.currentRoom) {\n\t\t\tconsole.error('Not found currentRomm in localstorage')\n\t\t\treturn\n\t\t}\n\t\tthis.currentGame = JSON.parse(\n\t\t\tsys.localStorage.getItem('currentGame') || 'null'\n\t\t) as SocketGame | null\n\t\tif (!this.currentGame) {\n\t\t\tconsole.error('Not found currentGame in localstorage')\n\t\t\treturn\n\t\t}\n\t\tconsole.log(\n\t\t\t'[GamePlayManager][localStorage]',\n\t\t\tthis.socketRoom,\n\t\t\tthis.currentRoom,\n\t\t\tthis.currentGame\n\t\t)\n\t\t// init event listeners\n\t\tthis.primaryBtn.node.on(\n\t\t\tNode.EventType.TOUCH_END,\n\t\t\t() => {\n\t\t\t\tthis.onClickPrimaryBtn(this.primaryBtn)\n\t\t\t},\n\t\t\tthis\n\t\t)\n\t\tthis.initChoiceBtn()\n\t\tthis.roundResultController?.node.on('replay', () => {\n\t\t\t// NOTE: Do not use socket event\n\t\t\tthis.gameState = GameState.WaitingForPlayers\n\t\t})\n\t\tthis.nav.node.on('back', () => {\n\t\t\tdirector.loadScene('game-lobby')\n\n\t\t\tsocketClient.emit('ROOM_ACTION', {\n\t\t\t\troomId: this.currentRoom.id,\n\t\t\t\taction: 'LEAVE',\n\t\t\t\tsocketRoom: this.socketRoom || '',\n\t\t\t})\n\t\t})\n\n\t\t// init game state\n\t\tthis.gameState = GameState.WaitingForNextRound\n\t\tthis.pushSystemNoti(`Welcome to Rock Paper Scissors!`)\n\t\tthis.chatManager.node.on('send-message', (message: string) => {\n\t\t\tsocketClient.emit('GAME_CHAT', {\n\t\t\t\tsocketRoom: this.socketRoom,\n\t\t\t\tgameRoomId: this.currentRoom.id,\n\t\t\t\tmessage,\n\t\t\t})\n\t\t})\n\t\t// init player data\n\t\tthis.initPlayerData()\n\t\t// init socket event\n\t\tthis.updatePlayerData(this.currentGame?.players || [])\n\n\t\tsocketClient.listen('MESSAGE', (message) => {\n\t\t\tconsole.log('MESSAGE', message)\n\t\t\tif (message === 'ANOTHER_SESSION_LOGIN') {\n\t\t\t\tthis.modalReconnect?.show()\n\t\t\t}\n\t\t})\n\t\tsocketClient.listen('DISCONNECT', (payload) => {\n\t\t\tconsole.log('ROOM_ACTION', payload)\n\t\t\tthis.modalReconnect?.show()\n\t\t})\n\n\t\tsocketClient.listen('ROOM_ACTION', (payload) => {\n\t\t\tthis.handleSocketEventRoomAction(payload)\n\t\t})\n\t\tsocketClient.listen('GAME', (payload) => {\n\t\t\tthis.handleSocketEventGame(payload)\n\t\t})\n\t\tsocketClient.listen('GAME_STATE_CHANGED', (payload) => {\n\t\t\tthis.handleSocketEventGameStateChange(payload)\n\t\t})\n\t\tsocketClient.listen('GAME_CHAT', (payload) => {\n\t\t\tthis.handleSocketEventGameChat(payload)\n\t\t})\n\t}\n\n\tprotected update(deltaTime: number) {}\n\n\tonDestroy() {\n\t\t// Tắt chạy nền khi scene bị hủy\n\t\tBackgroundRunner.disableBackgroundRunning()\n\n\t\tsocketClient.removeAllListeners()\n\t}\n\n\tprivate initPlayerData() {\n\t\tconst userInfo = JSON.parse(sys.localStorage.getItem('user-info') || 'null') as User\n\t\tthis.playerA.initData(userInfo)\n\t\tthis.playerA.setUserBalance({\n\t\t\tcoin: 100,\n\t\t\tcoinSymbol: 'tADA',\n\t\t})\n\t\t// get playerB from current users\n\t\tconst currentUsers = JSON.parse(sys.localStorage.getItem('currentUsers') || '[]') as User[]\n\t\tconst playerB = currentUsers.find((user) => user.walletAddress !== userInfo.walletAddress)\n\t\tif (playerB) {\n\t\t\tthis.playerB.initData(playerB)\n\t\t} else {\n\t\t\tconsole.log('player B do not in room')\n\t\t\tthis.playerB.initData({\n\t\t\t\tid: 0,\n\t\t\t\talias: '---',\n\t\t\t\twalletAddress: 'addr_test1a...000',\n\t\t\t\tavatar: '',\n\t\t\t})\n\t\t}\n\t\tthis.playerB.setUserBalance({\n\t\t\tcoin: 0,\n\t\t\tcoinSymbol: 'tADA',\n\t\t})\n\t}\n\n\tprotected initChoiceBtn() {\n\t\tthis.getChoiceBtn(this.rockBtnNode)?.onClick(() => {\n\t\t\tthis.onClickChoice(Choice.Rock)\n\t\t})\n\t\tthis.getChoiceBtn(this.paperBtnNode)?.onClick(() => {\n\t\t\tthis.onClickChoice(Choice.Paper)\n\t\t})\n\t\tthis.getChoiceBtn(this.scissorsBtnNode)?.onClick(() => {\n\t\t\tthis.onClickChoice(Choice.Scissors)\n\t\t})\n\t}\n\n\tprotected getChoiceBtn(node: Node) {\n\t\tconst button = node?.getComponent(ChoiceBtnScript)\n\t\tif (!button) return null\n\t\treturn button\n\t}\n\n\tprotected setChoiceBtnInteractive([rockI, paperI, scissorsI]: boolean[]) {\n\t\tthis.getChoiceBtn(this.rockBtnNode).interactable = rockI\n\t\tthis.getChoiceBtn(this.paperBtnNode).interactable = paperI\n\t\tthis.getChoiceBtn(this.scissorsBtnNode).interactable = scissorsI\n\t}\n\tprotected setChoiceBtnSelected([rockI, paperI, scissorsI]: boolean[]) {\n\t\tthis.getChoiceBtn(this.rockBtnNode).setSelected(rockI)\n\t\tthis.getChoiceBtn(this.paperBtnNode).setSelected(paperI)\n\t\tthis.getChoiceBtn(this.scissorsBtnNode).setSelected(scissorsI)\n\t}\n\n\tprotected onClickPrimaryBtn(primaryBtn: PrimaryBtn): void {\n\t\tconsole.log('Click Ready Btn')\n\t\tif (primaryBtn.type === 'READY') {\n\t\t\tthis.clip.onAudioQueue(3) // button click\n\t\t\tprimaryBtn.interactable = false\n\t\t\tthis.nav.interactable = false\n\n\t\t\tsocketClient.emit('GAME', {\n\t\t\t\taction: 'READY',\n\t\t\t\tsocketRoom: this.socketRoom,\n\t\t\t\tgameRoomId: this.currentRoom.id,\n\t\t\t})\n\t\t} else if (primaryBtn.type === 'CONFIRM') {\n\t\t\tprimaryBtn.interactable = false\n\t\t\tthis.clip.onAudioQueue(3) // button click\n\n\t\t\tthis.playerA.setChoice(this.selectedChoice)\n\t\t\tsocketClient.emit('GAME', {\n\t\t\t\taction: 'COMMIT',\n\t\t\t\tsocketRoom: this.socketRoom,\n\t\t\t\tgameRoomId: this.currentRoom.id,\n\t\t\t\tdata: {\n\t\t\t\t\tencryptedChoice: this.playerA.hashedChoice,\n\t\t\t\t\ttxId: 'tx_id_commit_from_client_test_' + this.playerA.choice,\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t}\n\n\tget gameState() {\n\t\treturn this._gameState\n\t}\n\tset gameState(value: GameState) {\n\t\tthis._gameState = value\n\t\tthis.handleGameStateChange()\n\t}\n\n\tprotected handleGameStateChange() {\n\t\tconsole.log('[🎮] Game state change', this.gameState)\n\t\tconsole.table([\n\t\t\t{\n\t\t\t\tplayerA: this.playerA,\n\t\t\t\tplayerB: this.playerB,\n\t\t\t},\n\t\t])\n\t\tswitch (this.gameState) {\n\t\t\tcase GameState.WaitingForPlayers: {\n\t\t\t\tconsole.log('Waiting for players', this.playerA)\n\t\t\t\tthis.primaryBtn.interactable = !this.playerA.isReady\n\t\t\t\tthis.nav.interactable = !this.playerA.isReady\n\t\t\t\tthis.roundResultController.hide()\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase GameState.WaitingForChoices: {\n\t\t\t\tthis.primaryBtn.interactable = !this.playerA.hasMadeChoice\n\t\t\t\tthis.primaryBtn.setType('CONFIRM')\n\t\t\t\tthis.setChoiceBtnInteractive(\n\t\t\t\t\tthis.playerA.hasMadeChoice ? [false, false, false] : [true, true, true]\n\t\t\t\t)\n\t\t\t\tthis.onClickChoice(this.selectedChoice)\n\t\t\t\tthis.countdownController.show()\n\t\t\t\tthis.countdownController.setTime(this.currentGame.roundTimeoutMs / 1000 + 1) // add 1 second for network delay\n\t\t\t\tthis.countdownController.startCoundown(() => {\n\t\t\t\t\t// when countdown finish\n\t\t\t\t\tthis.onCountdownFinished()\n\t\t\t\t})\n\t\t\t\tthis.nav.interactable = false\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase GameState.CommittingChoices: {\n\t\t\t\tthis.primaryBtn.setType('CONFIRM')\n\t\t\t\tthis.primaryBtn.interactable = !this.playerA.hasMadeChoice\n\t\t\t\tthis.setChoiceBtnInteractive(\n\t\t\t\t\tthis.playerA.hasMadeChoice ? [false, false, false] : [true, true, true]\n\t\t\t\t)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase GameState.RevealingChoices:\n\t\t\t\tthis.primaryBtn.interactable = false\n\t\t\t\tthis.setChoiceBtnInteractive([false, false, false])\n\t\t\t\tsocketClient.emit('GAME', {\n\t\t\t\t\taction: 'REVEAL',\n\t\t\t\t\tsocketRoom: this.socketRoom,\n\t\t\t\t\tgameRoomId: this.currentRoom.id,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttxId: 'tx_id_reveal_from_client_test_' + this.playerA.choice,\n\t\t\t\t\t\tchoice: this.playerA.choice,\n\t\t\t\t\t\tsalt: this.playerA.salt,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tthis.pushSystemNoti(\n\t\t\t\t\t`${this.playerA.userInfo.alias} commited [${formatString(\n\t\t\t\t\t\tthis.playerA.hashedChoice,\n\t\t\t\t\t\t3,\n\t\t\t\t\t\t3\n\t\t\t\t\t)}]`\n\t\t\t\t)\n\t\t\t\tthis.playerB.hashedChoice &&\n\t\t\t\t\tthis.pushSystemNoti(\n\t\t\t\t\t\t`${this.playerB.userInfo.alias} commited [${formatString(\n\t\t\t\t\t\t\tthis.playerB.hashedChoice,\n\t\t\t\t\t\t\t3,\n\t\t\t\t\t\t\t3\n\t\t\t\t\t\t)}]`\n\t\t\t\t\t)\n\t\t\t\tbreak\n\t\t\tcase GameState.WaitingForPayout:\n\t\t\t\tthis.playerA.isRevealed &&\n\t\t\t\t\tthis.pushSystemNoti(`${this.playerA.userInfo.alias} revealed [${this.playerA.salt}]`)\n\t\t\t\tthis.playerB.isRevealed &&\n\t\t\t\t\tthis.pushSystemNoti(`${this.playerB.userInfo.alias} revealed [${this.playerB.salt}]`)\n\t\t\t\tthis.pushSystemNoti('Waiting for payout...')\n\t\t\t\tbreak\n\t\t\tcase GameState.ShowRoundResult: {\n\t\t\t\tthis.countdownController.hide()\n\t\t\t\tthis.primaryBtn.interactable = false\n\t\t\t\tthis.nav.interactable = false\n\t\t\t\tthis.roundResultController.hide()\n\t\t\t\tthis.setChoiceBtnInteractive([false, false, false])\n\t\t\t\tthis.setChoiceBtnSelected([false, false, false])\n\n\t\t\t\tconsole.log(\n\t\t\t\t\t`[GamePlayManager][handleGameStateChange][ShowRoundResult]`,\n\t\t\t\t\tthis.playerA,\n\t\t\t\t\tthis.playerB\n\t\t\t\t)\n\t\t\t\tif (this.playerA.choice !== Choice.None && this.playerB.choice !== Choice.None) {\n\t\t\t\t\tlet result: 'WIN' | 'LOSE' | 'DRAW' = 'WIN'\n\t\t\t\t\tif (this.playerA.choice === this.playerB.choice) {\n\t\t\t\t\t\tresult = 'DRAW'\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t(this.playerA.choice === Choice.Rock && this.playerB.choice === Choice.Paper) ||\n\t\t\t\t\t\t(this.playerA.choice === Choice.Paper && this.playerB.choice === Choice.Scissors) ||\n\t\t\t\t\t\t(this.playerA.choice === Choice.Scissors && this.playerB.choice === Choice.Rock)\n\t\t\t\t\t) {\n\t\t\t\t\t\tresult = 'LOSE'\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = 'WIN'\n\t\t\t\t\t}\n\n\t\t\t\t\tconst amount = new CurrencyBalance(this.currentRoom.betUnit, this.currentRoom.betAmount)\n\t\t\t\t\tthis.roundResultController.show({\n\t\t\t\t\t\tplayerA: this.playerA,\n\t\t\t\t\t\tplayerB: this.playerB,\n\t\t\t\t\t\tstatus: result,\n\t\t\t\t\t\tbetAmount: Number(amount.toAda()),\n\t\t\t\t\t\tbetUnitSymbol: amount.chain.symbol,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase GameState.WaitingForNextRound:\n\t\t\t\tthis.primaryBtn.setType('READY')\n\t\t\t\tthis.primaryBtn.interactable = true\n\t\t\t\tthis.countdownController.hide()\n\t\t\t\tthis.countdownController.stopCountdown()\n\t\t\t\tthis.setChoiceBtnSelected([false, false, false])\n\t\t\t\tthis.setChoiceBtnInteractive([false, false, false])\n\t\t\t\tthis.playerA.reset()\n\t\t\t\tthis.playerB.reset()\n\n\t\t\t\tthis.pushSystemNoti('Preparing for next round...')\n\t\t\t\tbreak\n\t\t}\n\t}\n\n\tprotected onClickChoice(choice: Choice): void {\n\t\tif (!this.playerA.isReady) {\n\t\t\tconsole.log('Player A not ready')\n\t\t\treturn\n\t\t}\n\t\tif (this.playerA.hasMadeChoice) {\n\t\t\tconsole.log('Player A has made choice')\n\t\t\treturn\n\t\t}\n\t\tif (\n\t\t\tthis.gameState !== GameState.WaitingForChoices &&\n\t\t\tthis.gameState !== GameState.CommittingChoices\n\t\t) {\n\t\t\tconsole.warn('Game state not allow choice')\n\t\t\treturn\n\t\t}\n\t\tthis.selectedChoice = choice\n\t\tif (choice === Choice.None) return\n\t\telse if (choice === Choice.Rock) {\n\t\t\tthis.setChoiceBtnSelected([true, false, false])\n\t\t} else if (choice === Choice.Paper) {\n\t\t\tthis.setChoiceBtnSelected([false, true, false])\n\t\t} else if (choice === Choice.Scissors) {\n\t\t\tthis.setChoiceBtnSelected([false, false, true])\n\t\t}\n\t}\n\n\tprivate readyWatcher: any\n\t/**\n\t * @deprecated use socket event instead\n\t */\n\tprotected waitAllPlayersReady() {\n\t\tif (!this.readyWatcher) {\n\t\t\tthis.readyWatcher = true\n\t\t\tthis.schedule(this.checkReadyStatus, 0.1) // Kiểm tra mỗi 0.1 giây\n\t\t}\n\t}\n\t/**\n\t * @deprecated use socket event instead\n\t */\n\tprotected checkReadyStatus() {\n\t\tif (this.playerA.isReady && this.playerB.isReady) {\n\t\t\tthis.gameState = GameState.WaitingForChoices\n\t\t\tthis.unschedule(this.checkReadyStatus)\n\t\t\tthis.readyWatcher = null\n\t\t}\n\t}\n\n\t/**\n\t * @deprecated use socket event instead\n\t */\n\tprotected onCountdownFinished() {\n\t\t// if (this.playerA.choice === Choice.None) {\n\t\t// \tconsole.log('Player A not choose')\n\t\t// \t// Randowm select\n\t\t// \tthis.onClickChoice(this.playerA.makeRandomChoice())\n\t\t// }\n\t\t// // TODO: Mock data for player B, remove this later\n\t\t// if (this.playerB.choice === Choice.None) {\n\t\t// \tconsole.log('Player B not choose')\n\t\t// \t// Randowm select\n\t\t// \tthis.playerB.setChoice(this.playerB.makeRandomChoice())\n\t\t// \tconsole.log('Player B choice', this.playerB)\n\t\t// }\n\t\t// this.gameState = GameState.ShowRoundResult // Use socket event instead\n\t}\n\n\tprotected pushSystemNoti(message: string) {\n\t\tif (!this.chatManager) {\n\t\t\tconsole.log('Chat manager is not initialized')\n\t\t\treturn\n\t\t}\n\t\tthis.chatManager?.addMessage('Noti: ', message)\n\t}\n\n\t// Socket event handler\n\n\tprivate handleSocketEventGame(payload: GameResponseMessage) {\n\t\tconst { action, data } = payload\n\t\tif (action === 'GET_STATE') {\n\t\t\tconst { players } = data.game\n\t\t\t// Update player data:\n\t\t\tthis.updatePlayerData(players)\n\t\t}\n\t\tconsole.log(`[GamePlayManager][handleSocketEventGame]: | ${action} | `, data)\n\t}\n\n\tprivate handleSocketEventRoomAction(payload: RoomActionResponse) {\n\t\tconst { action, data } = payload\n\t\tif (data?.users) {\n\t\t\tsys.localStorage.setItem('currentUsers', JSON.stringify(data?.users || []))\n\t\t}\n\t\tthis.initPlayerData()\n\t\tconsole.log(`[GamePlayManager][handleSocketEventRoomAction]: | ${action} | `, data)\n\t}\n\n\tprivate handleSocketEventGameStateChange(payload: GameStateChangedResponseMessage) {\n\t\tconst { state, oldState, players, currentRound } = payload.data\n\t\tconsole.log(`[GamePlayManager][handleSocketEventGameStateChange]: | ${state} | `, payload)\n\t\tthis.updatePlayerData(players)\n\t\tthis.gameState = state\n\t}\n\n\tprivate handleSocketEventGameChat(payload: GameChatResponseMessage) {\n\t\tconst { message, from, to, timestamp } = payload.data\n\t\tthis.chatManager?.addMessage(from.alias, message)\n\t}\n\n\tprivate updatePlayerData(players: GamePlayer[]) {\n\t\tplayers.forEach((player) => {\n\t\t\tif (player.id === this.playerA.userInfo.walletAddress) {\n\t\t\t\tif (player.isReady) {\n\t\t\t\t\tthis.playerA.ready()\n\t\t\t\t} else {\n\t\t\t\t\tthis.playerA.reset()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (player.choice) {\n\t\t\t\t\tthis.playerA.setChoice(player.choice)\n\t\t\t\t}\n\t\t\t\tif (player.commit) {\n\t\t\t\t\tconst { encryptedChoice } = player.commit\n\t\t\t\t\tthis.playerA.hashedChoice = encryptedChoice\n\t\t\t\t}\n\t\t\t\tif (player.reveal) {\n\t\t\t\t\tconst { choice, salt } = player.reveal\n\t\t\t\t\tthis.playerA.choice = choice\n\t\t\t\t\tthis.playerA.salt = salt\n\t\t\t\t\tthis.playerA.isRevealed = true\n\t\t\t\t}\n\t\t\t} else if (player.id === this.playerB.userInfo.walletAddress) {\n\t\t\t\tif (player.isReady) {\n\t\t\t\t\tthis.playerB.ready()\n\t\t\t\t} else {\n\t\t\t\t\tthis.playerB.reset()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (player.choice) {\n\t\t\t\t\tthis.playerB.setChoice(player.choice)\n\t\t\t\t}\n\t\t\t\tif (player.commit) {\n\t\t\t\t\tconst { encryptedChoice } = player.commit\n\t\t\t\t\tthis.playerB.hashedChoice = encryptedChoice\n\t\t\t\t}\n\t\t\t\tif (player.reveal) {\n\t\t\t\t\tconst { choice, salt } = player.reveal\n\t\t\t\t\tthis.playerB.choice = choice\n\t\t\t\t\tthis.playerB.salt = salt\n\t\t\t\t\tthis.playerB.isRevealed = true\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n}\n","import { sys } from 'cc'\nimport { LobbyInteractionImpl } from './lobby'\nimport { PlayerInteraction, PlayerInteractionImpl } from './player'\n\ntype InteractionInstance = {\n\tlobby: LobbyInteractionImpl\n\tplayer: PlayerInteraction\n}\n\nexport type InstanceType = PlayerInteraction | LobbyInteractionImpl | null\n\nexport class GameInteraction implements InteractionInstance {\n\tstatic getInstance(key: keyof InteractionInstance): InstanceType {\n\t\tconst instanceMapper = {\n\t\t\tplayer: new PlayerInteractionImpl(),\n\t\t\tlobby: new LobbyInteractionImpl(),\n\t\t}\n\t\tconst instance = instanceMapper[key]\n\t\tif (!instance) return null\n\n\t\tif (!(window as any)[key]) {\n\t\t\t;(window as any)[key] = instance\n\t\t}\n\t\treturn sys.isBrowser ? (window as any)[key] : null\n\t}\n\n\tplayer = GameInteraction.getInstance('player') as PlayerInteraction\n\tlobby = GameInteraction.getInstance('lobby') as LobbyInteractionImpl\n}\n","import { sys } from 'cc'\nimport { Room } from '../types/room.type'\n\n/**\n * Game APIs\n * from WEB to GAME:\n * - initGame\n * - createLobby\n * - joinLobby\n * - setLobbyItems\n * - renderLobbyList\n * - setLoading\n * - setAvatar\n * - setUserInfo\n * - setChoice\n * - setGameState\n * - setRoundResult\n * - setPayout\n * - setNextRound\n * - setWaitingForPlayers\n * - setWaitingForChoices\n * - setCommittingChoices\n * - setRevealingChoices\n * - setWaitingForPayout\n * - setWaitingForNextRound\n *\n *\n * from GAME to WEB:\n * - onReady\n * - onChoice\n * - onRevealChoice\n * - onConfirm\n */\n\n// Define a global object to store functions\n\nexport namespace GameApiNsp {\n\texport type InteractFunction = (\n\t\t...args: unknown[]\n\t) => void | Promise<void> | unknown | Promise<unknown>\n\n\texport type RequestFncName =\n\t\t// Player\n\t\t| 'fetchAuthorization'\n\t\t| 'fetchUserInfo'\n\t\t| 'fetchUserBalance'\n\t\t| 'depositBalance'\n\t\t// Lobby\n\t\t| 'fetchLobbyList'\n\t\t| 'createLobby'\n\t\t| 'joinLobby'\n\t\t| 'leaveLobby'\n\t\t// Game\n\t\t| 'startGame'\n\t\t| 'commitChoice'\n\t\t| 'revealChoice'\n\t\t| 'createPayout'\n\t\t| 'ready'\n\t\t| 'leaveGame'\n\t\t// Blockchain\n\t\t| 'buildTransaction'\n\t\t| 'signTransaction'\n\t\t| 'submitTransaction'\n\n\texport type InteractionMessage = {\n\t\tprotocol: 'game-api'\n\t\ttype: 'request' | 'response'\n\t\tpayload: {\n\t\t\tfncName: RequestFncName\n\t\t\targs: any[]\n\t\t\tresult?: any\n\t\t\terror?: any\n\t\t}\n\t}\n\n\texport class GameApi {\n\t\tfunctions: Record<string, InteractFunction> = {}\n\t\twindowInstance: Window\n\t\tconstructor(window: Window) {\n\t\t\tthis.windowInstance = window\n\t\t\t// this.functions = (window as any).GAME_API.functions as any\n\t\t}\n\t\tsetFunc(name: string, fn: InteractFunction) {\n\t\t\tif (typeof fn === 'function') {\n\t\t\t\tthis.functions[name] = fn\n\t\t\t\treturn this\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Provided value for \"${name}\" is not a function`)\n\t\t\t}\n\t\t}\n\n\t\tcall<T = InteractFunction>(name: string, ...args: any[]) {\n\t\t\tif (typeof this.functions[name] === 'function') {\n\t\t\t\tconsole.log('[GameApi][call]: ', `Function [${name}] `, `Args: `, args)\n\t\t\t\treturn this.functions[name](...args) as T\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Function \"${name}\" does not exist`)\n\t\t\t}\n\t\t}\n\n\t\trequest<T>(\n\t\t\tname: RequestFncName,\n\t\t\t{ args = null, timeout = 60000 }: { args?: any; timeout?: number } = {}\n\t\t) {\n\t\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst data: InteractionMessage = {\n\t\t\t\t\t\tprotocol: 'game-api',\n\t\t\t\t\t\ttype: 'request',\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\tfncName: name,\n\t\t\t\t\t\t\targs,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t\tthis.windowInstance.parent.postMessage(data, '*')\n\t\t\t\t\tthis.windowInstance.addEventListener(\n\t\t\t\t\t\t'message',\n\t\t\t\t\t\t(event: MessageEvent<InteractionMessage>) => {\n\t\t\t\t\t\t\tif (event.data.protocol !== 'game-api') return\n\t\t\t\t\t\t\tconsole.log('[GameApi][listen-message]: ', event.data)\n\t\t\t\t\t\t\tconst { type, payload } = event.data\n\t\t\t\t\t\t\tif (type === 'response' && payload.fncName === name) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tif (payload.error) {\n\t\t\t\t\t\t\t\t\t\treject(new Error(`[GameApi][request]: ${payload.error}`))\n\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tconst result = JSON.parse(payload.result)\n\t\t\t\t\t\t\t\t\tresolve(result)\n\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\treject(new Error(`[GameApi][request]: Error parsing response: ${error}`))\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// { once: true}\n\t\t\t\t\t)\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\treject(new Error(`[GameApi][request]: Request \"${name}\" timed out`))\n\t\t\t\t\t}, timeout)\n\t\t\t\t} catch (error) {\n\t\t\t\t\treject(error)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tresponse(data: InteractionMessage) {\n\t\t\tconsole.log('[GameApi][mock-response]: ', data)\n\t\t\tthis.windowInstance.postMessage(data, '*')\n\t\t}\n\t}\n}\n\nexport const gameApi = new GameApiNsp.GameApi(window)\n","import { Room } from '../types/room.type'\nimport { BaseEventDataType, BaseInteraction } from './base'\n\nexport class LobbyInteractionImpl extends BaseInteraction {\n\tconstructor() {\n\t\tsuper({\n\t\t\teventName: 'lobby',\n\t\t})\n\n\t\tthis.emitter.on(this.eventName, (data: BaseEventDataType) => {\n\t\t\tthis.onMessage(data)\n\t\t})\n\t}\n\n\tcreateLobby() {\n\t\tconsole.log('[Default Interaction]')\n\t}\n\tjoinLobby() {\n\t\tconsole.log('[Default Interaction]')\n\t}\n\tsetLobbyItems(items: Room[]) {\n\t\tconsole.log('[Default Interaction]', items)\n\t}\n\trenderLobbyList() {\n\t\tconsole.log('[Default Interaction]')\n\t}\n\tsetLoading(isLoading: boolean) {\n\t\tconsole.log('[Default Interaction]', isLoading)\n\t}\n}\n","import {\n\t_decorator,\n\tComponent,\n\tdirector,\n\tEditBox,\n\tinstantiate,\n\tNode,\n\tPrefab,\n\tRichText,\n\tScrollView,\n\tSize,\n\tsys,\n\tUITransform,\n} from 'cc'\nconst { ccclass, property } = _decorator\n\nimport { GameInteraction } from '../common/web-interaction'\nimport { Room } from '../common/types/room.type'\nimport { LobbyItem } from './prefabs/LobbyItem'\nimport { AudioControl } from './AudioControl'\nimport { PlayerManager } from './PlayerManager'\nimport { RequestFactory } from '../common/request-factory'\nimport { ModalInputPassword } from './lobby/ModalInputPassword'\nimport { socketClient } from '../common/constants/socket-client'\nimport { ModalReconnect } from './ModalReconnect'\n\n@ccclass('Lobby')\nexport class Lobby extends Component {\n\t@property({\n\t\ttype: AudioControl,\n\t\ttooltip: 'add audio controller',\n\t})\n\tpublic clip: AudioControl\n\n\t@property(Node)\n\tlobbyCreateBtn: Node | null = null\n\n\t@property(Node)\n\tlobbyTestBtn: Node | null = null\n\n\t@property(Node)\n\tlobbyTabBtn: Node | null = null\n\n\t@property(ScrollView)\n\tlobbyScrollView: ScrollView | null = null\n\n\t@property(Prefab)\n\tlobbyItemPrefab: Prefab | null = null\n\n\t@property(RichText)\n\tloadingText: RichText | null = null\n\n\t@property({\n\t\ttype: PlayerManager,\n\t\ttooltip: 'add player manager',\n\t})\n\tplayerManager: PlayerManager | null = null\n\n\t@property(ModalInputPassword)\n\tmodalInputPassword: ModalInputPassword | null = null\n\n\t@property(ModalReconnect)\n\tmodalReconnect: ModalReconnect | null = null\n\n\t@property(EditBox)\n\tpasswordEditbox: EditBox | null = null\n\n\t//\n\tlobbyItems: Room[] = []\n\tlobbyInteraction = new GameInteraction().lobby\n\tisLoading = false\n\n\tstart() {\n\t\tthis.lobbyCreateBtn?.on(Node.EventType.TOUCH_END, this.createLobby, this)\n\t\tthis.lobbyTestBtn?.on(Node.EventType.TOUCH_END, this.onClickTestBtn, this)\n\t\tthis.lobbyTabBtn?.on(Node.EventType.TOUCH_END, this.onClickLobbyTabBtn, this)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tasync onLoad() {\n\t\tthis.setLoading(true)\n\t\tRequestFactory.getLobbyList()\n\t\t\t.then((res) => {\n\t\t\t\tconsole.log('fetchLobbyList', res)\n\t\t\t\tthis.setLobbyItems(res.data?.items)\n\t\t\t\tthis.renderLobbyList()\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.log('fetchLobbyList', err)\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.setLoading(false)\n\t\t\t})\n\n\t\t// TODO: Remove this\n\t\tif (socketClient.connected) {\n\t\t\tconsole.log('socket connected')\n\t\t} else {\n\t\t\tsocketClient.setAuth(sys.localStorage.getItem('accessToken') || '')\n\t\t\tsocketClient.connect()\n\t\t}\n\n\t\tsocketClient.listen('MESSAGE', (message) => {\n\t\t\tconsole.log('MESSAGE', message)\n\t\t\tif (message === 'ANOTHER_SESSION_LOGIN') {\n\t\t\t\tthis.modalReconnect?.show()\n\t\t\t}\n\t\t})\n\t\tsocketClient.listen('DISCONNECT', (payload) => {\n\t\t\tconsole.log('ROOM_ACTION', payload)\n\t\t\tthis.modalReconnect?.show()\n\t\t})\n\t}\n\n\tprotected onEnable() {\n\t\tthis.fetchUserInfo()\n\t}\n\n\tprotected fetchUserInfo() {\n\t\t// get user info from local storage\n\t\tconst userInfo = JSON.parse(sys.localStorage.getItem('user-info') || 'null')\n\t\tif (userInfo && userInfo?.id) {\n\t\t\tthis.playerManager?.setUserInfo(userInfo)\n\t\t} else {\n\t\t\tRequestFactory.fetchUserInfo()\n\t\t\t\t.then((res) => {\n\t\t\t\t\tconsole.log('fetchUserInfo', res)\n\t\t\t\t\tif (res?.data) {\n\t\t\t\t\t\tsys.localStorage.setItem('user-info', JSON.stringify(res.data))\n\t\t\t\t\t\tthis.playerManager?.setUserInfo(res.data)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.log('fetchUserInfo', err)\n\t\t\t\t\tdirector.loadScene('start-scene')\n\t\t\t\t})\n\t\t}\n\t}\n\n\tprotected createLobby(): void {\n\t\tconsole.log('Create Lobby')\n\t}\n\n\tprotected onCickJoinLobby(roomData: Room): void {\n\t\tif (!roomData.requiredPassword) {\n\t\t\tthis.handleJoinLobby(roomData)\n\t\t\t\t.then(() => {\n\t\t\t\t\tdirector.loadScene('game-play')\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.log('handleJoinLobby', err)\n\t\t\t\t})\n\t\t\treturn\n\t\t}\n\t\tthis.modalInputPassword?.show()\n\t\tthis.modalInputPassword.node.on('confirm', (password: string) => {\n\t\t\tthis.handleJoinLobby(roomData, password)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.modalInputPassword?.hide()\n\t\t\t\t\tdirector.loadScene('game-play')\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tif (err === 'WRONG_PASSWORD') {\n\t\t\t\t\t\tthis.modalInputPassword?.setMessage('Password incorrect')\n\t\t\t\t\t} else if (err === 'ROOM_IS_FULL') {\n\t\t\t\t\t\tthis.modalInputPassword?.setMessage('Room is full')\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.modalInputPassword?.setMessage(\n\t\t\t\t\t\t\terr?.message || err || 'Something went wrong. Please try again.'\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t})\n\t\tthis.modalInputPassword.node.once('cancel', () => {\n\t\t\tconsole.log('cancel')\n\t\t\tthis.modalInputPassword?.hide()\n\t\t})\n\t}\n\n\tprotected async handleJoinLobby(roomData: Room, password?: string) {\n\t\t// TODO: remove this\n\t\tsocketClient.emit('ROOM_ACTION', {\n\t\t\troomId: roomData.id,\n\t\t\taction: 'LEAVE',\n\t\t\tsocketRoom: `GAME.${roomData.code}`,\n\t\t})\n\n\t\tsocketClient.emit('ROOM_ACTION', {\n\t\t\troomId: roomData.id,\n\t\t\taction: 'JOIN',\n\t\t\tpassword,\n\t\t})\n\t\treturn new Promise<{\n\t\t\tsocketRoom: string\n\t\t\troom: Room\n\t\t}>((resolve, reject) => {\n\t\t\tsocketClient.listen('ROOM_ACTION', (payload) => {\n\t\t\t\tif (payload.status === 'success' && payload.action === 'JOIN') {\n\t\t\t\t\tsys.localStorage.setItem('socket-room', payload.data.socketRoom)\n\t\t\t\t\tsys.localStorage.setItem('currentRoom', JSON.stringify(payload.data.room))\n\t\t\t\t\tsys.localStorage.setItem('currentGame', JSON.stringify(payload.data.game))\n\t\t\t\t\tsys.localStorage.setItem('currentUsers', JSON.stringify(payload.data.users))\n\t\t\t\t\tresolve(payload.data)\n\t\t\t\t}\n\t\t\t\tif (payload.status === 'error') {\n\t\t\t\t\treject(payload.message)\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\trenderLobbyList(): void {\n\t\tconsole.log('[Cocos Script] Render Lobby List')\n\t\tif (!this.lobbyScrollView || !this.lobbyItemPrefab) {\n\t\t\treturn\n\t\t}\n\t\t// Xóa các node cũ trong content\n\t\tconst content = this.lobbyScrollView.content\n\t\tcontent.removeAllChildren()\n\n\t\t// W: 197 H: 240\n\t\t// Align to grid width 3 items in first row, 4 items in second row\n\t\tconst itemNum = this.lobbyItems.length + 1\n\t\tconst itemWidth = 197\n\t\tconst itemHeight = 240\n\t\tconst itemPerRow = 4\n\t\tconst itemSpacing = 24\n\t\tfor (let i = 0; i < itemNum; i++) {\n\t\t\tif (i == 0) {\n\t\t\t\tcontent.addChild(this.lobbyCreateBtn)\n\t\t\t\tthis.lobbyCreateBtn.setPosition(0, 0, 0)\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tconst lobbyItem = instantiate(this.lobbyItemPrefab)\n\t\t\tconst row = Math.floor(i / itemPerRow)\n\t\t\tconst col = i % itemPerRow\n\t\t\tlobbyItem.setPosition(\n\t\t\t\tcol * itemWidth + col * itemSpacing,\n\t\t\t\t-row * itemHeight - row * itemSpacing,\n\t\t\t\t0\n\t\t\t)\n\t\t\tthis.initLobbyItem(lobbyItem, this.lobbyItems[i - 1])\n\t\t\tcontent.addChild(lobbyItem)\n\t\t}\n\n\t\tconst contentHeight =\n\t\t\titemHeight * Math.ceil(itemNum / itemPerRow) + itemSpacing * Math.ceil(itemNum / itemPerRow)\n\t\tcontent\n\t\t\t.getComponent(UITransform)\n\t\t\t.setContentSize(new Size(content.getComponent(UITransform).width, contentHeight))\n\t}\n\n\tprotected setLobbyItems(items: Room[]): void {\n\t\tthis.lobbyItems = items\n\t}\n\n\tprotected setVisibleLobbyList(isVisible: boolean): void {\n\t\tif (!this.lobbyScrollView) {\n\t\t\treturn\n\t\t}\n\t\tthis.lobbyScrollView.node.active = isVisible\n\t}\n\n\tprotected initLobbyItem(node: Node, data: Room): void {\n\t\tconst lobbyItemScript = node.getComponent(LobbyItem)\n\t\tif (lobbyItemScript) {\n\t\t\tlobbyItemScript.roomData = data\n\t\t\tlobbyItemScript.node.on('join-lobby', this.onCickJoinLobby, this)\n\t\t}\n\t}\n\n\tprotected setLoading(isLoading: boolean): void {\n\t\tconsole.log('[Cocos Script] Set loading', isLoading)\n\t\tthis.isLoading = isLoading\n\t\tif (!this.loadingText) {\n\t\t\treturn\n\t\t}\n\t\tthis.setVisibleLobbyList(!isLoading)\n\t\tthis.loadingText.node.active = isLoading\n\t}\n\n\tprotected onClickLobbyTabBtn(): void {\n\t\tthis.lobbyInteraction.emitter.emit('lobby', { type: 'onClickLobbyTabBtn' })\n\t}\n\n\tprotected onClickTestBtn(): void {\n\t\tthis.lobbyInteraction.emitter.emit('lobby', { type: 'onClickTestBtn' })\n\t}\n}\n","import { _decorator, Button, Component, Node, RichText, UIOpacity, UITransform } from 'cc'\nimport { Room } from '../../common/types/room.type'\nimport { formatString } from '../../common/utils/useFormat'\nimport { CHAIN } from '../../common/constants/chain'\nimport { CurrencyBalance } from '../../common/types/currency.type'\nconst { ccclass, property } = _decorator\n\n@ccclass('LobbyItem')\nexport class LobbyItem extends Component {\n\t@property(Node)\n\tlockedIcon: Node | null = null\n\n\t@property(RichText)\n\tlobbyShowedName: RichText | null = null\n\n\t@property(RichText)\n\tlobbyBetAmountText: RichText | null = null\n\n\t@property(Button)\n\tjoinButton: Button | null = null\n\n\t// Internal data\n\troomData: Room | null = null\n\n\tprotected onEnable(): void {\n\t\tif (!this.joinButton) {\n\t\t\treturn\n\t\t}\n\t\tthis.joinButton.node.on(Node.EventType.TOUCH_END, this.onClickJoinButton, this)\n\t}\n\n\tonLoad() {\n\t\tif (!this.roomData) {\n\t\t\treturn\n\t\t}\n\t\tif (this.roomData.requiredPassword && this.lockedIcon) {\n\t\t\tthis.lockedIcon.active = true\n\t\t} else {\n\t\t\tthis.lockedIcon.active = false\n\t\t}\n\n\t\t// Showed name's max length is 20\n\t\tthis.lobbyShowedName &&\n\t\t\t(this.lobbyShowedName.string = formatString(this.roomData.customName, 20, 0))\n\t\t// Bet amount\n\t\tlet betAmountText = new CurrencyBalance(this.roomData.betUnit, this.roomData.betAmount).toAda(\n\t\t\ttrue\n\t\t)\n\t\t// if (this.roomData.betUnit.symbol === 'lovelace') {\n\t\t// \tbetAmountText = this.roomData.betAmount / 1000000 + ' ' + CHAIN.symbol\n\t\t// } else {\n\t\t// \t// TODO: Check if asset is token\n\t\t// \tbetAmountText = this.roomData.betAmount + ' ' + this.roomData.betUnit.symbol\n\t\t// }\n\t\tthis.lobbyBetAmountText && (this.lobbyBetAmountText.string = betAmountText)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tprotected onClickJoinButton(): void {\n\t\tthis.node.emit('join-lobby', this.roomData)\n\t}\n}\n","import { _decorator, Component, Label, Node } from 'cc'\nconst { ccclass, property } = _decorator\n\n@ccclass('MessageItem')\nexport class MessageItem extends Component {\n\t@property(Label)\n\tmessageTitle: Label | null = null\n\n\t@property(Label)\n\tmessageContent: Label | null = null\n\n\tdata = {\n\t\ttitle: '',\n\t\tcontent: '',\n\t}\n\n\tstart() {}\n\n\tupdate(deltaTime: number) {}\n\n\tonLoad() {\n\t\tthis.messageTitle.string = this.data.title\n\t\tthis.messageContent.string = this.data.content\n\t}\n\n\tpublic setMessage(title: string, content: string) {\n\t\tthis.messageTitle.string = title\n\t\tthis.messageContent.string = content\n\t\tthis.data.title = title\n\t\tthis.data.content = content\n\t}\n}\n","import { PrimaryButton } from '../../UI/buttons/PrimaryButton'\nimport { SecondaryButton } from '../../UI/buttons/SecondaryButton'\nimport { BaseModal } from '../../UI/modals/BaseModal'\nimport { _decorator, EditBox, Input, Label, Node, RichText } from 'cc'\nconst { ccclass, property } = _decorator\n\n@ccclass('ModalInputPassword')\nexport class ModalInputPassword extends BaseModal {\n\t@property(PrimaryButton)\n\tconfirmButton: PrimaryButton | null = null\n\n\t@property(SecondaryButton)\n\tcancelButton: SecondaryButton | null = null\n\n\t@property(EditBox)\n\tpasswordEditbox: EditBox | null = null\n\n\t@property(Label)\n\tinputLabel: Label | null = null\n\n\t@property(RichText)\n\tmessage: RichText | null = null\n\n\tconstructor() {\n\t\tsuper({ showCloseButton: false, showOverlay: true })\n\t}\n\n\tstart() {\n\t\tsuper.start()\n\t\tthis.confirmButton?.node?.on(Node.EventType.TOUCH_END, this.onClickConfirmBtn, this)\n\t\tthis.node.on('open', () => {\n\t\t\tthis.message && (this.message.string = '')\n\t\t\tthis.confirmButton.interactable = false\n\t\t\tthis.passwordEditbox?.focus()\n\t\t})\n\n\t\tthis.cancelButton?.node?.on(Node.EventType.TOUCH_END, this.onClickCancelBtn, this)\n\t\tthis.passwordEditbox?.node?.on(EditBox.EventType.TEXT_CHANGED, this.onInputPassword, this)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tprotected onClickConfirmBtn() {\n\t\tthis.node.emit('confirm', this.passwordEditbox?.string || '')\n\t}\n\n\tprotected onClickCancelBtn() {\n\t\tthis.node.emit('cancel')\n\t}\n\n\tprotected onInputPassword() {\n\t\tif (this.passwordEditbox?.string && this.passwordEditbox.string.length > 0) {\n\t\t\tthis.confirmButton.interactable = true\n\t\t} else {\n\t\t\tthis.confirmButton.interactable = false\n\t\t}\n\t}\n\n\tpublic setMessage(message: string) {\n\t\tthis.message && (this.message.string = message)\n\t}\n}\n","import { _decorator, Node } from 'cc'\nimport { BaseModal } from '../UI/modals/BaseModal'\nimport { PrimaryButton } from '../UI/buttons/PrimaryButton'\nconst { ccclass, property } = _decorator\n\n@ccclass('ModalReconnect')\nexport class ModalReconnect extends BaseModal {\n\t@property(PrimaryButton)\n\treloadButton: PrimaryButton | null = null\n\n\tstart() {\n\t\tsuper.start()\n\n\t\tthis.reloadButton?.node?.on(Node.EventType.TOUCH_END, this.onClickReloadBtn, this)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tprotected onClickReloadBtn() {\n\t\twindow.location.reload()\n\t}\n}\n","import { PrimaryButton } from '../../UI/buttons/PrimaryButton'\nimport { BaseModal } from '../../UI/modals/BaseModal'\nimport { _decorator, Button, Node, Vec3 } from 'cc'\nconst { ccclass, property } = _decorator\n\n@ccclass('ModalResult')\nexport class ModalResult extends BaseModal {\n\t@property(PrimaryButton)\n\treplayButton: PrimaryButton | null = null\n\n\tconstructor() {\n\t\tsuper({ showCloseButton: false, showOverlay: true })\n\t}\n\n\tstart() {\n\t\tsuper.start()\n\t\tthis.replayButton?.node?.on(Node.EventType.TOUCH_END, this.onClickReplayBtn, this)\n\t\tthis.node.on('open', () => {\n\t\t\tthis.replayButton.interactable = true\n\t\t})\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tprotected onClickReplayBtn() {\n\t\tthis.node.emit('replay')\n\t}\n}\n","import { _decorator, Button, Component, director, math, Node, RichText, sys, tween } from 'cc'\nimport { Room } from '../../common/types/room.type'\nimport { CurrencyBalance } from '../../common/types/currency.type'\nconst { ccclass, property } = _decorator\n\n@ccclass('Navigation')\nexport class Navigation extends Component {\n\t@property(Button)\n\tnavBackBtn: Button | null = null\n\n\t@property(RichText)\n\tbetAmountText: RichText | null = null\n\n\t@property(RichText)\n\troomCodeText: RichText | null = null\n\n\tstart() {}\n\n\tprotected onLoad(): void {\n\t\tthis.navBackBtn.node.on(Node.EventType.TOUCH_END, this.onClickBackBtn, this)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tprotected updateRoomData() {\n\t\ttry {\n\t\t\tconst room = JSON.parse(sys.localStorage.getItem('currentRoom') || 'null') as Room\n\t\t\tif (!room) return\n\t\t\tthis.betAmountText.string =\n\t\t\t\t'Bet Amount: ' + new CurrencyBalance(room.betUnit, room.betAmount).toAda(true)\n\t\t\tthis.roomCodeText.string = 'Room Code: ' + room.code\n\t\t} catch (error) {\n\t\t\tconsole.log('updateRoomData', error)\n\t\t}\n\t}\n\n\tprotected onClickBackBtn(): void {\n\t\tthis.node.emit('back')\n\t}\n\n\tpublic set interactable(value: boolean) {\n\t\tif (!this.navBackBtn) return\n\t\tthis.navBackBtn.interactable = value\n\n\t\tif (value) {\n\t\t\tthis.updateRoomData()\n\t\t\ttween(this.node)\n\t\t\t\t.to(1, { x: -616, scale: math.v3(1, 1, 1) })\n\t\t\t\t.start()\n\t\t} else {\n\t\t\ttween(this.node)\n\t\t\t\t.to(1, { x: -616 - 424 - 100, scale: math.v3(0.9, 0.9, 0.9) })\n\t\t\t\t.start()\n\t\t}\n\t}\n\n\tpublic get interactable() {\n\t\tif (!this.navBackBtn) return false\n\t\treturn this.navBackBtn.interactable\n\t}\n}\n","import { User } from '../types/user.type'\n\nexport interface PlayerInteraction {\n\tsetAvatar(avatarUrl: string): void\n\tsetUserInfo(data: User): void\n}\n\nexport class PlayerInteractionImpl implements PlayerInteraction {\n\tsetAvatar(avatarUrl: string) {\n\t\tconsole.log('[Default Interaction]', avatarUrl)\n\t}\n\tsetUserInfo(data: User) {\n\t\tconsole.log('[Default Interaction]', data)\n\t}\n}\n","import {\n\t_decorator,\n\tassetManager,\n\tComponent,\n\tImageAsset,\n\tLabel,\n\tNode,\n\tRichText,\n\tSprite,\n\tSpriteFrame,\n\tTexture2D,\n} from 'cc'\nconst { ccclass, property } = _decorator\n\nimport { Choice } from '../../common/types/choice.type'\nimport { default as jsSha256 } from 'js-sha256'\nimport { Avatar } from '../prefabs/Avatar'\nimport { User, UserBalance } from '../../common/types/user.type'\n\n@ccclass('Player')\nexport class Player extends Component {\n\t@property(RichText)\n\tusernameText: RichText | null = null\n\t@property(RichText)\n\tcoinAmountText: RichText | null = null\n\t@property(Avatar)\n\tavatar: Avatar | null = null\n\t@property(Label)\n\treadyLabel: Label | null = null\n\n\tuserInfo: User = {\n\t\tid: 0,\n\t\talias: '',\n\t\twalletAddress: '',\n\t\tavatar: '',\n\t\tcreatedAt: '',\n\t}\n\n\tchoice: Choice = Choice.None\n\tsalt: string\n\thashedChoice: string\n\tisRevealed: boolean = false\n\tisReady: boolean = false\n\n\tstart() {}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic initData(user: User) {\n\t\tconst { alias, walletAddress, avatar } = user\n\t\tthis.userInfo = user\n\t\tthis.usernameText.string = alias\n\t\tthis.avatar?.setAvatar(avatar)\n\t\tthis.readyLabel.string = 'Waiting for ready...'\n\t\tthis.coinAmountText.string = ``\n\t}\n\n\tpublic setUserBalance(data: UserBalance): void {\n\t\tthis.coinAmountText.string = `${data.coin} ${data.coinSymbol}`\n\t}\n\n\tpublic reset() {\n\t\tthis.choice = Choice.None\n\t\tthis.salt = ''\n\t\tthis.hashedChoice = ''\n\t\tthis.isRevealed = false\n\t\tthis.isReady = false\n\t\tthis.readyLabel.string = 'Waiting for ready...'\n\t}\n\n\tpublic setChoice(choice: Choice) {\n\t\tthis.choice = choice\n\t\tthis.genSalt()\n\t\tthis.hashedChoice = jsSha256.sha256.hmac(this.salt, choice.toString())\n\t}\n\n\tpublic makeRandomChoice() {\n\t\tconst choices = [Choice.Rock, Choice.Paper, Choice.Scissors]\n\t\tconst choice = choices[Math.floor(Math.random() * 3)]\n\t\treturn choice\n\t}\n\n\tget hasMadeChoice() {\n\t\treturn this.hashedChoice && this.choice !== Choice.None\n\t}\n\n\tprotected genSalt() {\n\t\tthis.salt =\n\t\t\tMath.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)\n\t}\n\n\tready() {\n\t\tthis.isReady = true\n\t\tthis.readyLabel.string = 'Ready'\n\t}\n}\n","import {\n\t_decorator,\n\tComponent,\n\tresources,\n\tSprite,\n\tSpriteFrame,\n\tNode,\n\tassetManager,\n\tTexture2D,\n\tImageAsset,\n\tRichText,\n} from 'cc'\nimport { GameInteraction } from '../common/web-interaction/index'\nimport { User, UserBalance } from '../common/types/user.type'\nimport { RequestFactory } from '../common/request-factory'\nimport { formatAddress, formatString } from '../common/utils/useFormat'\nconst { ccclass, property } = _decorator\n\n@ccclass('PlayerManager')\nexport class PlayerManager extends Component {\n\t@property(Sprite)\n\tplayerAvatar: Sprite | null = null\n\n\t@property(RichText)\n\tusername: RichText | null = null\n\t@property(RichText)\n\twalletAddress: RichText | null = null\n\t@property(RichText)\n\tuserCoin: RichText | null = null\n\n\tuserInfo: User = {\n\t\twalletAddress: '',\n\t\tavatar: '',\n\t\tid: 0,\n\t\talias: '',\n\t\tcreatedAt: '',\n\t}\n\n\tstart() {}\n\n\tonLoad() {\n\t\tthis.playerAvatar.node.on(Node.EventType.TOUCH_END, this.onClickAvatar, this)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tprotected setAvatar(avatarUrl: string): void {\n\t\tassetManager.loadRemote(avatarUrl, (err, imageAsset) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error('Lỗi khi tải avatar:', err)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (this.playerAvatar) {\n\t\t\t\tconst spriteFrame = new SpriteFrame()\n\t\t\t\tconst texture = new Texture2D()\n\t\t\t\ttexture.image = imageAsset as ImageAsset\n\t\t\t\tspriteFrame.texture = texture\n\t\t\t\tthis.playerAvatar.spriteFrame = spriteFrame\n\t\t\t}\n\t\t})\n\t}\n\n\tprotected onClickAvatar(): void {\n\t\tconsole.log('Click avatar')\n\t}\n\n\tpublic setUserInfo(data: User): void {\n\t\tthis.userInfo = data\n\n\t\tthis.username.string = data.alias\n\t\tthis.walletAddress.string = formatAddress(data.walletAddress, {\n\t\t\tbegin: 6,\n\t\t\tlast: 4,\n\t\t\tsplitBy: '...',\n\t\t})\n\t\tthis.setAvatar(data.avatar)\n\t}\n\n\tpublic setUserBalance(data: UserBalance): void {\n\t\tthis.userCoin.string = `${data.coin} ${data.coinSymbol}`\n\t}\n}\n","import {\n\t_decorator,\n\tAnimation,\n\tColor,\n\tComponent,\n\tLabel,\n\tmath,\n\tNode,\n\tSprite,\n\ttween,\n\tUIOpacity,\n} from 'cc'\nconst { ccclass, property } = _decorator\n\n@ccclass('PrimaryBtn')\nexport class PrimaryBtn extends Component {\n\t@property(Label)\n\tlabel: Label | null = null\n\n\t@property(Node)\n\teffectNode: Node | null = null\n\n\t@property(Node)\n\tringNode: Node | null = null\n\n\tprivate _type: 'DEFAULT' | 'READY' | 'CONFIRM' = 'DEFAULT'\n\tprivate _interactable: boolean = true\n\n\tstart() {}\n\n\tonEnable() {\n\t\t// if (!this.effectNode) return\n\t\t// tween(this.effectNode)\n\t\t// \t.to(15, { scale: math.v3(1.05, 1.05, 1.05), angle: 360 }, { easing: 'linear' })\n\t\t// \t.repeatForever()\n\t\t// \t.start()\n\t}\n\tonDisable() {\n\t\t// Dừng tween khi node bị ẩn\n\t\t// tween(this.effectNode).stop()\n\t}\n\n\tupdate(deltaTime: number) {\n\t\t//\n\t}\n\n\tpublic setType(type: typeof this._type) {\n\t\tconsole.log('PrimaryBtnScript setType', type)\n\t\tthis._type = type\n\t\tif (!this.label) return\n\t\tif (type === 'DEFAULT') {\n\t\t\tthis.label.string = ''\n\t\t\tthis.node.getComponent(UIOpacity).opacity = 80\n\t\t\treturn\n\t\t} else if (type === 'READY') {\n\t\t\tthis.label.string = 'READY'\n\t\t\tthis.effectNode.getComponent(UIOpacity).opacity = 255\n\t\t\treturn\n\t\t} else if (type === 'CONFIRM') {\n\t\t\tthis.label.string = 'CONFIRM'\n\t\t\tthis.effectNode.getComponent(UIOpacity).opacity = 255\n\t\t\treturn\n\t\t}\n\t}\n\n\tpublic get type(): Readonly<typeof this._type> {\n\t\treturn this._type\n\t}\n\tpublic set interactable(isActive: boolean) {\n\t\tif (isActive === this._interactable) return // No change, do nothing\n\t\tthis._interactable = isActive\n\t\tif (!this.effectNode) return\n\t\tif (isActive) {\n\t\t\tthis.node.getComponent(Animation)?.play()\n\t\t\tthis.label.getComponent(Animation)?.play()\n\t\t\tthis.label.color = new Color('#C5FFF2')\n\t\t\tthis.label.outlineColor = new Color('#05624E')\n\n\t\t\tthis.effectNode.getComponent(Sprite).grayscale = false\n\t\t\tthis.ringNode.getComponent(Sprite).grayscale = false\n\t\t} else {\n\t\t\tthis.node.getComponent(Animation)?.stop()\n\t\t\tthis.label.getComponent(Animation)?.stop()\n\t\t\tthis.label.color = new Color('#D9D9D9')\n\t\t\tthis.label.outlineColor = new Color('#777777')\n\t\t\tthis.effectNode.getComponent(Sprite).grayscale = true\n\t\t\tthis.ringNode.getComponent(Sprite).grayscale = true\n\t\t}\n\t}\n\tpublic get interactable() {\n\t\treturn this._interactable\n\t}\n}\n","import { _decorator, Button, Color, Component, Label, Node } from 'cc'\nimport { BaseButton } from './BaseButton'\nconst { ccclass, property } = _decorator\n\n@ccclass('PrimaryButton')\nexport class PrimaryButton extends BaseButton {\n\tconstructor() {\n\t\tsuper()\n\t\tthis.defaultColor = new Color('#C5FFF2')\n\t\tthis.disabledColor = new Color('#999999')\n\t\tthis.hoveredColor = new Color('#C5FFF2')\n\t\tthis.pressedColor = new Color('#C5FFF2')\n\t\tthis.defaultOutlineColor = new Color('#05624E')\n\t\tthis.disabledOutlineColor = new Color('#999999')\n\t}\n\n\tstart() {\n\t\tthis.node.on(\n\t\t\tNode.EventType.TOUCH_MOVE,\n\t\t\t() => {\n\t\t\t\tif (this.interactable) {\n\t\t\t\t\tthis.label.color = this.hoveredColor\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis\n\t\t)\n\t\tthis.node.on(\n\t\t\tNode.EventType.TOUCH_END,\n\t\t\t() => {\n\t\t\t\tif (this.interactable) {\n\t\t\t\t\tthis.label.color = this.pressedColor\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis\n\t\t)\n\t\tthis.interactable = this.button.interactable\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic set interactable(value: boolean) {\n\t\tif (value) {\n\t\t\tthis.button.interactable = true\n\t\t\tthis.label.color = this.defaultColor\n\t\t\tthis.label.outlineColor = this.defaultOutlineColor\n\t\t} else {\n\t\t\tthis.button.interactable = false\n\t\t\tthis.label.color = this.disabledColor\n\t\t\tthis.label.outlineColor = this.disabledOutlineColor\n\t\t}\n\t}\n\tpublic get interactable() {\n\t\treturn this.button.interactable\n\t}\n}\n","import { sys } from 'cc'\nimport { gameApi } from './game-apis'\nimport configs from './constants/config'\n\nexport const $fetch = async (url: string, options?: RequestInit) => {\n\treturn new Promise<any>((resolve, reject) => {\n\t\tconst token = sys.localStorage.getItem('accessToken')\n\t\tfetch(url, {\n\t\t\t...options,\n\t\t\theaders: {\n\t\t\t\t...options?.headers,\n\t\t\t\tAuthorization: token ? `Bearer ${token}` : '',\n\t\t\t},\n\t\t})\n\t\t\t.then((response: Response) => {\n\t\t\t\treturn response.json()\n\t\t\t})\n\t\t\t.then((value) => {\n\t\t\t\tresolve(value)\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\treject(error)\n\t\t\t})\n\t})\n}\n\nexport class RequestFactory {\n\tstatic baseApiUrl = configs.baseApiUrl\n\n\tstatic getLobbyList() {\n\t\treturn $fetch(`${this.baseApiUrl}/rooms`)\n\t}\n\n\tstatic createLobby(body: Record<string, any>) {\n\t\treturn $fetch(`${this.baseApiUrl}/rooms`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify(body),\n\t\t})\n\t}\n\n\t// User\n\tstatic fetchUserInfo() {\n\t\treturn $fetch(`${this.baseApiUrl}/auth`)\n\t}\n\tstatic fetchUserBalance() {\n\t\treturn $fetch(`${this.baseApiUrl}/auth/balance`)\n\t}\n\tstatic depositBalance(body: Record<string, any>) {\n\t\treturn $fetch(`${this.baseApiUrl}/auth/deposit`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify(body),\n\t\t})\n\t}\n\tstatic async requestAuthorization() {\n\t\tconst rs = await (gameApi.request('fetchAuthorization') as Promise<{ accessToken: string }>)\n\t\treturn rs\n\t}\n}\n","import { _decorator, Color, Component, Label, Node, RichText } from 'cc'\nimport { Choice } from '../../common/types/choice.type'\nimport { Avatar } from '../prefabs/Avatar'\nimport { ChoiceFrame } from '../prefabs/ChoiceFrame'\nconst { ccclass, property } = _decorator\n\n@ccclass('ResultCard')\nexport class ResultCard extends Component {\n\t@property({\n\t\ttype: Avatar,\n\t\ttooltip: 'add avatar',\n\t})\n\tavatarNode: Avatar | null = null\n\t@property(Label)\n\tmessage: Label | null = null\n\t@property(RichText)\n\tusername: RichText | null = null\n\t@property(RichText)\n\twalletAddress: RichText | null = null\n\n\t@property({\n\t\ttype: ChoiceFrame,\n\t\ttooltip: 'add choice frame',\n\t})\n\tchoiceFrame: ChoiceFrame | null = null\n\n\tplayer = {\n\t\tavatarUrl: '',\n\t\tusername: '',\n\t\twalletAddress: '',\n\t\tchoice: Choice.None as Choice,\n\t\tmessageText: '',\n\t}\n\n\tstart() {\n\t\t// this.choiceFrame?.showChoice(Choice.Paper, false)\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tinit(player: ResultCard['player'], status: 'WIN' | 'LOSE' | 'DRAW') {\n\t\tthis.player = player\n\t\tthis.username.string = player.username\n\t\tthis.walletAddress.string = player.walletAddress\n\t\tthis.choiceFrame?.showChoice(player.choice, status === 'LOSE')\n\t\tthis.avatarNode?.setAvatar(player.avatarUrl)\n\n\t\tconst color = {\n\t\t\tWIN: new Color('#0E881C'),\n\t\t\tLOSE: new Color('#DD3E0D'),\n\t\t\tDRAW: new Color('#6B2E1B'),\n\t\t}\n\t\tthis.message.color = color[status]\n\t\tthis.message.string = player.messageText\n\t}\n}\n","import { _decorator, Component, math, Node, Sprite, SpriteFrame, tween } from 'cc'\nimport { Choice } from '../../common/types/choice.type'\nimport { AudioControl } from '../AudioControl'\nimport { ModalResult } from './ModalResult'\nimport { ResultCard } from './ResultCard'\nimport { ChoiceFrame } from '../prefabs/ChoiceFrame'\nimport { Player } from './Player'\nimport { formatAddress } from '../../common/utils/useFormat'\nconst { ccclass, property } = _decorator\n\ntype ChoiceType = Choice.Rock | Choice.Paper | Choice.Scissors\ntype ShowOptions = {\n\tplayerA: Player\n\tplayerB: Player\n\tstatus: 'WIN' | 'LOSE' | 'DRAW'\n\tbetAmount: number\n\tbetUnitSymbol: string\n}\n\n@ccclass('RoundResultController')\nexport class RoundResultController extends Component {\n\t@property({\n\t\ttype: [SpriteFrame],\n\t\ttooltip: 'add sprite frames: [rock, paper, scissors]',\n\t\tmax: 3,\n\t\tmin: 3,\n\t})\n\tchoiceSpriteFrames: SpriteFrame[] = []\n\n\t@property({\n\t\ttype: [SpriteFrame],\n\t\ttooltip: 'add sprite frames: [rock, paper, scissors]',\n\t\tmax: 3,\n\t\tmin: 3,\n\t})\n\tdisabledChoiceSpriteFrames: SpriteFrame[] = []\n\n\t@property(SpriteFrame)\n\twinSpriteFrame: SpriteFrame\n\t@property(SpriteFrame)\n\tloseSpriteFrame: SpriteFrame\n\t@property(SpriteFrame)\n\tdrawSpriteFrame: SpriteFrame\n\n\t@property({\n\t\ttype: ChoiceFrame,\n\t\ttooltip: 'add choice frame for player A',\n\t})\n\tplayerAChoiceFrame: ChoiceFrame | null = null\n\t@property({\n\t\ttype: ChoiceFrame,\n\t\ttooltip: 'add choice frame for player B',\n\t})\n\tplayerBChoiceFrame: ChoiceFrame | null = null\n\t@property(Node)\n\tstatusNode: Node | null = null\n\n\t@property({\n\t\ttype: ModalResult,\n\t\ttooltip: 'add modal result node',\n\t})\n\tmodalResult: ModalResult | null = null\n\n\t@property({\n\t\ttype: ResultCard,\n\t\ttooltip: 'add card player A node',\n\t})\n\tcardPlayerA: ResultCard | null = null\n\t@property({\n\t\ttype: ResultCard,\n\t\ttooltip: 'add card player B node',\n\t})\n\tcardPlayerB: ResultCard | null = null\n\n\t@property({\n\t\ttype: AudioControl,\n\t\ttooltip: 'add audio controller',\n\t})\n\tpublic clip: AudioControl\n\n\tonEnable() {\n\t\tthis.modalResult && (this.modalResult.node.active = false)\n\t\tthis.modalResult?.node.on('replay', () => {\n\t\t\tthis.node.emit('replay')\n\t\t})\n\t}\n\n\tupdate(deltaTime: number) {}\n\n\tpublic show(options: ShowOptions) {\n\t\tthis.node.active = true\n\t\tthis.node.scale = math.v3(0, 0, 0)\n\t\ttween(this.node)\n\t\t\t.to(0.35, { scale: math.v3(1, 1, 1) }, { easing: 'cubicInOut' })\n\t\t\t.start()\n\t\tif (options.status === 'WIN') {\n\t\t\tthis.clip.onAudioQueue(0) // win\n\t\t\tthis.playerAChoiceFrame.showChoice(options.playerA.choice, false)\n\t\t\tthis.playerBChoiceFrame.showChoice(options.playerB.choice, true)\n\t\t} else if (options.status === 'DRAW') {\n\t\t\tthis.clip.onAudioQueue(1) // draw\n\t\t\tthis.playerAChoiceFrame.showChoice(options.playerA.choice, false)\n\t\t\tthis.playerBChoiceFrame.showChoice(options.playerB.choice, false)\n\t\t} else {\n\t\t\tthis.clip.onAudioQueue(2) // lose\n\t\t\tthis.playerAChoiceFrame.showChoice(options.playerA.choice, true)\n\t\t\tthis.playerBChoiceFrame.showChoice(options.playerB.choice, false)\n\t\t}\n\t\tthis.showStatus(options.status)\n\n\t\t// Example: win => 'win 5 tADA'\n\t\t// Example: lose => 'lose 5 tADA'\n\t\t// Example: draw => 'draw'\n\t\tconst betAmountMsg = `${options.betAmount} ${options.betUnitSymbol}`\n\t\tconst msgA =\n\t\t\toptions.status === 'DRAW' ? 'draw' : options.status.toLowerCase() + ' ' + betAmountMsg\n\t\tconst msgB =\n\t\t\toptions.status === 'WIN'\n\t\t\t\t? 'lose ' + betAmountMsg\n\t\t\t\t: options.status === 'LOSE'\n\t\t\t\t? 'win ' + betAmountMsg\n\t\t\t\t: 'draw'\n\t\tthis.cardPlayerA?.init(\n\t\t\t{\n\t\t\t\tusername: options.playerA.userInfo.alias,\n\t\t\t\twalletAddress: formatAddress(options.playerA.userInfo.walletAddress, { begin: 6, last: 4 }),\n\t\t\t\tchoice: options.playerA.choice,\n\t\t\t\tmessageText: `${msgA}`,\n\t\t\t\tavatarUrl: options.playerA.userInfo.avatar,\n\t\t\t},\n\t\t\toptions.status\n\t\t)\n\t\tthis.cardPlayerB?.init(\n\t\t\t{\n\t\t\t\tusername: options.playerB.userInfo.alias,\n\t\t\t\twalletAddress: formatAddress(options.playerB.userInfo.walletAddress, { begin: 6, last: 4 }),\n\t\t\t\tchoice: options.playerB.choice,\n\t\t\t\tmessageText: `${msgB}`,\n\t\t\t\tavatarUrl: options.playerB.userInfo.avatar,\n\t\t\t},\n\t\t\toptions.status === 'WIN' ? 'LOSE' : options.status === 'LOSE' ? 'WIN' : 'DRAW'\n\t\t)\n\t\tsetTimeout(() => {\n\t\t\tthis.modalResult.show()\n\t\t}, 3000)\n\t\t//==========================================================================================\n\t}\n\n\tprotected showStatus(status: ShowOptions['status']) {\n\t\tif (!this.statusNode) return\n\t\tconst sprite = this.statusNode.getComponent(Sprite)\n\t\tif (!sprite) return\n\t\tif (status === 'WIN') {\n\t\t\tsprite.spriteFrame = this.winSpriteFrame\n\t\t} else if (status === 'DRAW') {\n\t\t\tsprite.spriteFrame = this.drawSpriteFrame\n\t\t} else {\n\t\t\tsprite.spriteFrame = this.loseSpriteFrame\n\t\t}\n\t}\n\n\tpublic hide() {\n\t\tthis.node.active = false\n\t}\n}\n","import { _decorator, Button, Color, Component, Label, Node } from 'cc'\nimport { BaseButton } from './BaseButton'\nconst { ccclass, property } = _decorator\n\n@ccclass('SecondaryButton')\nexport class SecondaryButton extends BaseButton {\n\tconstructor() {\n\t\tsuper()\n\t\tthis.defaultColor = new Color('#652615')\n\t\tthis.disabledColor = new Color('#999999')\n\t\tthis.hoveredColor = new Color('#913820')\n\t\tthis.pressedColor = new Color('#652615')\n\t\tthis.defaultOutlineColor = new Color('#652615')\n\t\tthis.disabledOutlineColor = new Color('#999999')\n\t}\n}\n","//@ts-ignore\nimport io from 'socket.io-client/dist/socket.io.js'\n\nimport {\n\tEmitMessageType,\n\tListenMessageType,\n\tSOCKET_EMIT_EVENTS,\n\tSOCKET_LISTEN_EVENTS,\n} from '../types/socket-client.type'\nimport configs from './config'\n\nclass SocketClient {\n\tprivate socket: Socket\n\tconstructor() {\n\t\tthis.socket = io(configs.socketioWsUrl, {\n\t\t\ttransports: ['websocket', 'polling'],\n\t\t\tautoConnect: false,\n\t\t}) as Socket\n\t}\n\n\tget EmitEvents() {\n\t\treturn SOCKET_EMIT_EVENTS\n\t}\n\tget ListenEvents() {\n\t\treturn SOCKET_LISTEN_EVENTS\n\t}\n\n\temit<Ev extends keyof EmitMessageType>(emitEvent: Ev, data: EmitMessageType[typeof emitEvent]) {\n\t\tconst event = this.EmitEvents[emitEvent]\n\t\tthis.socket.emit(event, data)\n\t}\n\n\tlisten<Ev extends keyof ListenMessageType>(\n\t\tlistenEvent: Ev,\n\t\tcallback: (data: ListenMessageType[typeof listenEvent]) => void\n\t) {\n\t\tconst event = this.ListenEvents[listenEvent] as string\n\t\tthis.socket.on(event, callback)\n\t}\n\n\tremoveListener<Ev extends keyof ListenMessageType>(\n\t\tlistenEvent: Ev,\n\t\tcallback: (data: ListenMessageType[typeof listenEvent]) => void\n\t) {\n\t\tconst event = this.ListenEvents[listenEvent] as string\n\t\tthis.socket.off(event, callback)\n\t}\n\n\tremoveAllListeners() {\n\t\tthis.socket.removeAllListeners()\n\t}\n\n\tlistenOnce<Ev extends keyof ListenMessageType>(\n\t\tlistenEvent: Ev,\n\t\tcallback: (data: ListenMessageType[typeof listenEvent]) => void\n\t) {\n\t\tconst event = this.ListenEvents[listenEvent] as string\n\t\tthis.socket.once(event, callback)\n\t}\n\n\tsetAuth(token: string) {\n\t\tthis.socket.auth = { token }\n\t}\n\n\tconnect() {\n\t\tthis.socket.connect()\n\t}\n\n\tdisconnect() {\n\t\tthis.socket.disconnect()\n\t}\n\n\tget connected() {\n\t\treturn this.socket.connected\n\t}\n}\n\nexport const socketClient = new SocketClient()\n","import { Choice } from './choice.type'\nimport { GamePlayer, GameState, SocketGame } from './game.type'\nimport { Room } from './room.type'\nimport { User } from './user.type'\n\nexport const SOCKET_EMIT_EVENTS = {\n\tROOM_ACTION: 'room_action',\n\tGAME: 'game',\n\tGAME_CHAT: 'game_chat',\n}\nexport const SOCKET_LISTEN_EVENTS = {\n\tCONNECT: 'connect',\n\tDISCONNECT: 'disconnect',\n\tROOM_ACTION: 'room_action',\n\tGAME: 'game',\n\tGAME_STATE_CHANGED: 'game_state_changed',\n\tMESSAGE: 'message',\n\tGAME_CHAT: 'game_chat',\n}\n\n// ============================================= EMITS =================================================================================\n\ntype GameMessageType = {\n\tgameRoomId: number\n\tsocketRoom: string\n} & (\n\t| {\n\t\t\taction: 'READY'\n\t  }\n\t| {\n\t\t\taction: 'COMMIT'\n\t\t\tdata: {\n\t\t\t\tencryptedChoice: string\n\t\t\t\ttxId: string\n\t\t\t}\n\t  }\n\t| {\n\t\t\taction: 'REVEAL'\n\t\t\tdata: {\n\t\t\t\tchoice: Choice\n\t\t\t\tsalt: string\n\t\t\t\ttxId: string\n\t\t\t}\n\t  }\n\t| {\n\t\t\t/**\n\t\t\t * @deprecated\n\t\t\t */\n\t\t\taction: 'PAYOUT'\n\t\t\tdata: {\n\t\t\t\ttxId: string\n\t\t\t}\n\t  }\n\t| {\n\t\t\taction: 'GET_STATE'\n\t  }\n)\nexport interface EmitMessageType extends Record<keyof typeof SOCKET_EMIT_EVENTS, any> {\n\tROOM_ACTION:\n\t\t| {\n\t\t\t\troomId: number\n\t\t\t\taction: 'JOIN'\n\t\t\t\tpassword?: string\n\t\t  }\n\t\t| {\n\t\t\t\troomId: number\n\t\t\t\taction: 'LEAVE'\n\t\t\t\t/**\n\t\t\t\t * Socket room: = `GAME.${roomId}`\n\t\t\t\t */\n\t\t\t\tsocketRoom: string\n\t\t  }\n\tGAME: GameMessageType\n}\n// ============================================= EMITS =================================================================================\n\n// ===========================================================================================================================================================\n\n// ============================================= RESPONSE =================================================================================\nexport type BaseSocketResponseMessage<T> = {\n\tstatus: 'success' | 'error'\n\tmessage: string\n\tdata: T\n}\n\nexport type RoomActionResponse = BaseSocketResponseMessage<{\n\tsocketRoom: string\n\troom: Room\n\tusers: User[]\n\tgame: SocketGame\n}> & { action: 'JOIN' | 'LEAVE' }\n\nexport type GameStateResponseMessage = BaseSocketResponseMessage<{\n\tgame: SocketGame\n}> & { action: 'GET_STATE' }\n\nexport type GameActionResponseMessage = BaseSocketResponseMessage<{\n\tgame: SocketGame\n}> & { action: 'READY' | 'COMMIT' | 'REVEAL' }\n\nexport type GameResponseMessage = GameStateResponseMessage | GameActionResponseMessage\n\nexport type GameStateChangedResponseMessage = BaseSocketResponseMessage<{\n\tstate: GameState\n\toldState: GameState\n\tplayers: GamePlayer[]\n\tcurrentRound: unknown\n}>\n\nexport type GameChatResponseMessage = BaseSocketResponseMessage<{\n\tmessage: string\n\tfrom: User\n\tto: {\n\t\troom: Room['id']\n\t\tsocketRoom: string\n\t}\n\ttimestamp: string | number\n}>\n// ============================================= RESPONSE =================================================================================\n\nexport interface ListenMessageType extends Record<keyof typeof SOCKET_LISTEN_EVENTS, any> {\n\tCONNECT: any\n\tDISCONNECT: any\n\tROOM_ACTION: RoomActionResponse\n\tMESSAGE: any\n\tGAME: GameResponseMessage\n\tGAME_STATE_CHANGED: GameStateChangedResponseMessage\n\tGAME_CHAT: GameChatResponseMessage\n}\n","import {\n\t_decorator,\n\tAnimation,\n\tassetManager,\n\tButton,\n\tComponent,\n\tdirector,\n\tLabel,\n\tNode,\n\tProgressBar,\n\tresources,\n\tsys,\n\tToggle,\n} from 'cc'\nimport { add } from 'lodash-es'\nimport { AudioControl } from './AudioControl'\nimport { PrimaryButton } from '../UI/buttons/PrimaryButton'\nimport { GameInteraction } from '../common/web-interaction'\nimport { BaseModal } from '../UI/modals/BaseModal'\nimport { RequestFactory } from '../common/request-factory'\nimport { gameApi } from '../common/game-apis'\nimport configs from '../common/constants/config'\nimport { socketClient } from '../common/constants/socket-client'\nconst { ccclass, property } = _decorator\n\n@ccclass('StartScene')\nexport class StartScene extends Component {\n\t@property(PrimaryButton)\n\tstartGameBtn: PrimaryButton | null = null\n\n\t@property({\n\t\ttype: AudioControl,\n\t\ttooltip: 'add audio controller',\n\t})\n\tpublic clip: AudioControl\n\n\t@property({\n\t\ttype: ProgressBar,\n\t\ttooltip: 'loading progress bar',\n\t})\n\tloadingBar: ProgressBar | null = null\n\n\t@property({\n\t\ttype: Label,\n\t\ttooltip: 'loading bar label',\n\t})\n\tloadingLabel: Label | null = null\n\n\t@property({\n\t\ttype: Toggle,\n\t\ttooltip: 'agree term toggle',\n\t})\n\tagreeTermToggle: Toggle | null = null\n\n\t@property({\n\t\ttype: BaseModal,\n\t\ttooltip: 'add modal info',\n\t})\n\tmodalInfo: BaseModal | null = null\n\n\t@property(Button)\n\tretryBtn: Button | null = null\n\n\tisAuthenticated: boolean = false\n\n\tstart() {\n\t\tthis.startGameBtn?.node.on(Node.EventType.TOUCH_END, this.initGame, this)\n\t\tthis.agreeTermToggle?.node?.on(Node.EventType.TOUCH_END, this.onClickAgreeTerm, this)\n\t\tnew GameInteraction()\n\t}\n\n\tupdate(deltaTime: number) {\n\t\t// console.log('Update', deltaTime)\n\t\tif (this.startGameBtn) {\n\t\t\tthis.startGameBtn.interactable = this.isEnableStartBtn\n\t\t}\n\t}\n\n\tget isEnableStartBtn() {\n\t\treturn (\n\t\t\tthis.agreeTermToggle?.isChecked && this.loadingBar?.progress === 1 && this.isAuthenticated\n\t\t)\n\t}\n\n\tprotected onClickAgreeTerm(): void {\n\t\tconsole.log('Click agree term', this.agreeTermToggle?.isChecked)\n\t}\n\n\tprotected onLoad(): void {\n\t\tconsole.log('OnLoad', add(1, 2)) // test lodash\n\t\tthis.clip.onAudioLoop(0) // background music\n\t}\n\tprotected onEnable(): void {\n\t\tthis.preloadAllAssets()\n\n\t\tRequestFactory.requestAuthorization()\n\t\t\t.then((res) => {\n\t\t\t\tconsole.log('fetchAuthorization', res)\n\t\t\t\tsys.localStorage.setItem('accessToken', res.accessToken)\n\t\t\t\tsocketClient.setAuth(res.accessToken)\n\t\t\t\tsocketClient.connect()\n\t\t\t\treturn RequestFactory.fetchUserInfo()\n\t\t\t})\n\t\t\t.then((rs) => {\n\t\t\t\tconsole.log('fetchUserInfo', rs)\n\t\t\t\tif (rs?.data) {\n\t\t\t\t\tsys.localStorage.setItem('user-info', JSON.stringify(rs.data))\n\t\t\t\t\tthis.isAuthenticated = true\n\t\t\t\t} else {\n\t\t\t\t\tthis.isAuthenticated = false\n\t\t\t\t\tconsole.log('fetchUserInfo error', rs)\n\t\t\t\t\tthrow new Error('fetchUserInfo error')\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.log('fetchAuthorization', err)\n\t\t\t\tsys.localStorage.removeItem('accessToken')\n\t\t\t\tsys.localStorage.removeItem('user-info')\n\t\t\t\tthis.isAuthenticated = false\n\n\t\t\t\tconsole.log('this.modalInfo', this.modalInfo)\n\t\t\t\tthis.modalInfo?.show()\n\t\t\t\tthis.retryBtn?.node.on(Node.EventType.TOUCH_END, () => {\n\t\t\t\t\t// reload page\n\t\t\t\t\twindow.location.reload()\n\t\t\t\t})\n\t\t\t})\n\n\t\t// Mock response data\n\t\t// TODO: Remove this\n\t\tsetTimeout(() => {\n\t\t\tgameApi.response({\n\t\t\t\tprotocol: 'game-api',\n\t\t\t\ttype: 'response',\n\t\t\t\tpayload: {\n\t\t\t\t\tfncName: 'fetchAuthorization',\n\t\t\t\t\targs: [],\n\t\t\t\t\tresult: JSON.stringify({\n\t\t\t\t\t\taccessToken:\n\t\t\t\t\t\t\t'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ3YWxsZXRBZGRyZXNzIjoiYWRkcl90ZXN0MXFyc3g3MmhydjhlbnM5MGh3a2V6Zzd5c3lod3Zjam15emR2ZXlmODhwcHE3YTBsd3U3Z3Ywd3V1ZjlsaHptN3djbHZqNW50Z2NmYTUzajBycXhtdTIzN3gyMHhzbmU1NnEzIiwiaWQiOjEsImFsaWFzIjoiSm9obkRvZSIsInJvbGVzIjpbInVzZXIiLCJhZG1pbiJdLCJpYXQiOjE3NDkwMjY0OTQsImV4cCI6MTc0OTg5MDQ5NH0.KqRAJx_BZztXPiM5w_SV_r52S18RtcAYgmlD2UiHaFo',\n\t\t\t\t\t}),\n\t\t\t\t\terror: null,\n\t\t\t\t},\n\t\t\t})\n\t\t}, 1000)\n\t}\n\n\tprotected initGame(): void {\n\t\tif (!this.agreeTermToggle?.isChecked) {\n\t\t\tconsole.log('Please agree to the term')\n\t\t\treturn\n\t\t}\n\t\tif (this.loadingBar.progress !== 1) {\n\t\t\treturn\n\t\t}\n\t\tdirector.loadScene('game-lobby')\n\t}\n\n\tprivate preloadAllAssets() {\n\t\t// Tải toàn bộ assets trong thư mục resources\n\t\tthis.loadingBar.progress = 0\n\t\tthis.loadingLabel.string = 'Loading... 0%'\n\t\tresources.loadDir(\n\t\t\t'',\n\t\t\t(loadedAssets, totalAssets, assets) => {\n\t\t\t\t// Cập nhật tiến trình tải\n\t\t\t\tconst progress = loadedAssets / totalAssets\n\t\t\t\tthis.loadingBar.progress = progress\n\t\t\t\tthis.loadingLabel.string = `Loading... ${Math.floor(progress * 100)}%`\n\t\t\t},\n\t\t\t(error, assets) => {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.error('Failed to preload assets:', error)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.loadingLabel.string = 'Click start now to play'\n\t\t\t\tthis.loadingLabel.getComponent(Animation)?.play()\n\t\t\t\tthis.loadingBar.progress = 1\n\t\t\t}\n\t\t)\n\t}\n}\n","export function formatString(str: string | null, begin = 5, last = 5): string {\n\tif (!str) return ''\n\tif (str.length <= begin + last) return str\n\tconst before = str.substring(0, begin)\n\tconst after = str.substring(str.length - last)\n\treturn before + '...' + after\n}\n\nexport function formatAddress(\n\taddress: string | null,\n\toptions: { begin?: number; last?: number; splitBy?: string } = {\n\t\tbegin: 5,\n\t\tlast: 5,\n\t\tsplitBy: '...',\n\t}\n): string {\n\tif (!address) return ''\n\tconst { begin = 5, last = 5, splitBy = '...' } = options\n\tif (address.length <= begin + last) return address\n\tconst before = address.substring(0, begin)\n\tconst after = address.substring(address.length - last)\n\treturn before + splitBy + after\n}\n"]}